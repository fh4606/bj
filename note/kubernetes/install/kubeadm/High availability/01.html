<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.13" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.49" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vuepress-theme-hope-docs-demo.netlify.app/note/kubernetes/install/kubeadm/High%20availability/01.html"><meta property="og:site_name" content="é£å"><meta property="og:title" content="01-éƒ¨ç½²3ä¸»3ä»çš„é«˜å¯ç”¨é›†ç¾¤"><meta property="og:description" content="éƒ¨ç½²3ä¸»3ä»çš„kubernetes1.21.0é«˜å¯ç”¨é›†ç¾¤ç¯å¢ƒ å‚è€ƒåœ°å€ï¼šhttps://www.cnblogs.com/superlinux/p/14676959.html 1ã€ä¸»æœºæ“ä½œç³»ç»Ÿè¯´æ˜ 2ã€ä¸»æœºç¡¬ä»¶é…ç½®è¯´æ˜ èŠ±é‡Œèƒ¡å“¨çš„ç¾åŒ–é…ç½® 3ã€ä¸»æœºé…ç½® 3.1ã€é…ç½®yumæºï¼Œæ‰€æœ‰ä¸»æœºéƒ½é…ç½® é‡‡ç”¨é˜¿é‡Œäº‘æº ä¸‹è½½å®‰è£…æ‰€æœ‰çš„æºç æ–‡ä»¶ï¼Œåé¢éœ€è¦ç”¨åˆ° 3.2ã€ä¿®æ”¹..."><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="article:author" content="é£å"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"01-éƒ¨ç½²3ä¸»3ä»çš„é«˜å¯ç”¨é›†ç¾¤","image":[""],"dateModified":null,"author":[{"@type":"Person","name":"é£å","url":"/portfolio"}]}</script><title>01-éƒ¨ç½²3ä¸»3ä»çš„é«˜å¯ç”¨é›†ç¾¤ | é£å</title><meta name="description" content="éƒ¨ç½²3ä¸»3ä»çš„kubernetes1.21.0é«˜å¯ç”¨é›†ç¾¤ç¯å¢ƒ å‚è€ƒåœ°å€ï¼šhttps://www.cnblogs.com/superlinux/p/14676959.html 1ã€ä¸»æœºæ“ä½œç³»ç»Ÿè¯´æ˜ 2ã€ä¸»æœºç¡¬ä»¶é…ç½®è¯´æ˜ èŠ±é‡Œèƒ¡å“¨çš„ç¾åŒ–é…ç½® 3ã€ä¸»æœºé…ç½® 3.1ã€é…ç½®yumæºï¼Œæ‰€æœ‰ä¸»æœºéƒ½é…ç½® é‡‡ç”¨é˜¿é‡Œäº‘æº ä¸‹è½½å®‰è£…æ‰€æœ‰çš„æºç æ–‡ä»¶ï¼Œåé¢éœ€è¦ç”¨åˆ° 3.2ã€ä¿®æ”¹...">
    <link rel="preload" href="/assets/style-MBsnZ0dF.css" as="style"><link rel="stylesheet" href="/assets/style-MBsnZ0dF.css">
    <link rel="modulepreload" href="/assets/app-mt04-1UL.js"><link rel="modulepreload" href="/assets/01.html-fAheivnX.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/index.html-aJXlqhpM.js" as="script"><link rel="prefetch" href="/assets/portfolio.html-unmMviKI.js" as="script"><link rel="prefetch" href="/assets/index.html-ql453sK3.js" as="script"><link rel="prefetch" href="/assets/disable.html-BlIXe2lH.js" as="script"><link rel="prefetch" href="/assets/encrypt.html-BfP3JLS5.js" as="script"><link rel="prefetch" href="/assets/layout.html-CJH_BNrj.js" as="script"><link rel="prefetch" href="/assets/markdown.html-CAjmdeI7.js" as="script"><link rel="prefetch" href="/assets/page.html-B_0JnG6M.js" as="script"><link rel="prefetch" href="/assets/index.html-ClpqjsMz.js" as="script"><link rel="prefetch" href="/assets/index.html-BLcTW89Q.js" as="script"><link rel="prefetch" href="/assets/index.html-CDcH23KR.js" as="script"><link rel="prefetch" href="/assets/index.html-C8AbvD_c.js" as="script"><link rel="prefetch" href="/assets/baz.html-DeqNrmeB.js" as="script"><link rel="prefetch" href="/assets/index.html-ovQOoASz.js" as="script"><link rel="prefetch" href="/assets/ray.html--3Jlem3U.js" as="script"><link rel="prefetch" href="/assets/1.1.å®‰è£…vmwareåŠvmwareå®‰è£…ubuntu.html-BRl9f2Rp.js" as="script"><link rel="prefetch" href="/assets/1.2.å®‰è£…Xshell7å’Œä½¿ç”¨Xshellè¿œç¨‹è¿æ¥ubuntu.html-DlnEX9je.js" as="script"><link rel="prefetch" href="/assets/1.3.Prometheusç›‘æ§ä»‹ç».html-RjndnKM1.js" as="script"><link rel="prefetch" href="/assets/1.4.äºŒè¿›åˆ¶å®‰è£…prometheus.html-6Q4TuTBH.js" as="script"><link rel="prefetch" href="/assets/1.5.dockerå®‰è£…prometheus.html-BcCEe8zx.js" as="script"><link rel="prefetch" href="/assets/1.6.Prometheusç›¸å…³æ¦‚å¿µ.html-Bom2cyDc.js" as="script"><link rel="prefetch" href="/assets/2.1.Exporteræ¦‚è¿°.html-CJtJb0y2.js" as="script"><link rel="prefetch" href="/assets/2.10.ç›‘æ§mysql.html-C1_oFmgA.js" as="script"><link rel="prefetch" href="/assets/2.11.ç›‘æ§springboot2.x.html-B1BgSj3Q.js" as="script"><link rel="prefetch" href="/assets/2.12.è¿›ç¨‹ç›‘æ§.html-DhtUoiP-.js" as="script"><link rel="prefetch" href="/assets/2.14.åŸŸåè¿‡æœŸç›‘æ§.html-D8O_0Ou4.js" as="script"><link rel="prefetch" href="/assets/2.15.ç›‘æ§æ€»ç»“.html-E3Pw67Cl.js" as="script"><link rel="prefetch" href="/assets/2.16.pushgatewayè‡ªå®šä¹‰ç›‘æ§.html-VeW4SLWD.js" as="script"><link rel="prefetch" href="/assets/2.17.ç›‘æ§åä¸ºäº¤æ¢æœº.html-BxUtGVqi.js" as="script"><link rel="prefetch" href="/assets/2.2.ç›‘æ§linuxæœåŠ¡å™¨.html-dZY5zla-.js" as="script"><link rel="prefetch" href="/assets/2.3.ç›‘æ§tengineï¼ˆæ–°å¢ï¼‰.html-Cg1BQ_rd.js" as="script"><link rel="prefetch" href="/assets/2.4.ç›‘æ§nginx.html-DccV5juF.js" as="script"><link rel="prefetch" href="/assets/2.6.ç›‘æ§redis.html-9gZs1Zx-.js" as="script"><link rel="prefetch" href="/assets/2.7.ç›‘æ§rabbitmq.html-BFYDVij8.js" as="script"><link rel="prefetch" href="/assets/2.8.ç›‘æ§mongodb.html-NaAAWXT6.js" as="script"><link rel="prefetch" href="/assets/2.9.ç›‘æ§docker.html-QkdRB8aF.js" as="script"><link rel="prefetch" href="/assets/3.1.æœåŠ¡å‘ç°_åŸºäºæ–‡ä»¶çš„æœåŠ¡å‘ç°.html-KHzRW7hZ.js" as="script"><link rel="prefetch" href="/assets/3.2.åŸºäº Consul çš„æœåŠ¡å‘ç°.html-C3z-Ixeo.js" as="script"><link rel="prefetch" href="/assets/3.3.Relabelingæœºåˆ¶.html-Dj7wPbg5.js" as="script"><link rel="prefetch" href="/assets/4.1.PromQL åŸºç¡€ä½¿ç”¨.html-kOOEP1xR.js" as="script"><link rel="prefetch" href="/assets/4.2.PromQL æ“ä½œç¬¦.html-CKbqESfS.js" as="script"><link rel="prefetch" href="/assets/4.3.PromQL å†…ç½®å‡½æ•°.html-ChnMYlZ8.js" as="script"><link rel="prefetch" href="/assets/5.1.Prometheuså‘Šè­¦ç®€ä»‹.html-D6RKJH3Q.js" as="script"><link rel="prefetch" href="/assets/5.2.Alertmanageré…ç½®æ¦‚è¿°åŠå‘Šè­¦è§„åˆ™.html-Cva2EM4e.js" as="script"><link rel="prefetch" href="/assets/5.3.163é‚®ç®±å‘Šè­¦.html-DgOWUeMx.js" as="script"><link rel="prefetch" href="/assets/5.4.ä¼ä¸šé’‰é’‰å‘Šè­¦.html-CU-q5SBv.js" as="script"><link rel="prefetch" href="/assets/5.5.ä¼ä¸šå¾®ä¿¡å‘Šè­¦.html-H6aQqFzk.js" as="script"><link rel="prefetch" href="/assets/5.6.æ‰‹æœºç”µè¯ã€çŸ­ä¿¡å‘Šè­¦.html-wG5BcPa7.js" as="script"><link rel="prefetch" href="/assets/5.7.PrometheusAlertï¼ˆæ–°å¢ï¼‰.html-Czp181iB.js" as="script"><link rel="prefetch" href="/assets/5.8.AlertmanageræŠ‘åˆ¶ã€é™é»˜ã€è·¯ç”±ã€å‘Šè­¦åˆ†ç»„.html-DPRUF7v5.js" as="script"><link rel="prefetch" href="/assets/5.9.å‘Šè­¦é€šçŸ¥æ€»ç»“.html-DqGwCDPS.js" as="script"><link rel="prefetch" href="/assets/6.1.Grafana ä»‹ç».html-Cqz5cIuI.js" as="script"><link rel="prefetch" href="/assets/6.2.Grafanaæ·»åŠ æ—¶é—´åºåˆ—é¢æ¿.html-BXGBHpkb.js" as="script"><link rel="prefetch" href="/assets/6.3.Grafanaæ·»åŠ è¡¨æ ¼é¢æ¿.html-D3RGGTV-.js" as="script"><link rel="prefetch" href="/assets/6.4.ä»ªè¡¨ç›˜å’Œç»Ÿè®¡é¢æ¿.html-4A8XipCA.js" as="script"><link rel="prefetch" href="/assets/6.5.Grafanaç”¨æˆ·å’Œè§’è‰².html-DMPILvVU.js" as="script"><link rel="prefetch" href="/assets/6.6.Grafanaå‘Šè­¦åŠŸèƒ½ï¼ˆäº†è§£ï¼‰.html-C5U-JQvL.js" as="script"><link rel="prefetch" href="/assets/7.1.Prometheuså’Œalertmanageré«˜å¯ç”¨.html-DBHIarwH.js" as="script"><link rel="prefetch" href="/assets/8.1.Prometheus Operator.html-YYuvN44x.js" as="script"><link rel="prefetch" href="/assets/8.2.k8sé›†ç¾¤ç›‘æ§.html-D4Tq5hlt.js" as="script"><link rel="prefetch" href="/assets/8.3.etcdç›‘æ§.html-CPuN6noD.js" as="script"><link rel="prefetch" href="/assets/8.4.åœ¨k8sä¸­ç›‘æ§redis.html-0oihzT0P.js" as="script"><link rel="prefetch" href="/assets/8.5.åœ¨k8sä¸­ç›‘æ§MySQL.html-CbwNc95M.js" as="script"><link rel="prefetch" href="/assets/8.6.åœ¨k8sä¸­é»‘ç›’ç›‘æ§.html-wDsHVW0x.js" as="script"><link rel="prefetch" href="/assets/8.7.åœ¨k8sä¸­ä½¿ç”¨é’‰é’‰ï¼Œé‚®ä»¶ï¼Œä¼ä¸šå¾®ä¿¡æ¥æ”¶å‘Šè­¦é€šçŸ¥.html-COdaX9Dh.js" as="script"><link rel="prefetch" href="/assets/index.html-CyJ-tcnv.js" as="script"><link rel="prefetch" href="/assets/index.html-Dr2caqsk.js" as="script"><link rel="prefetch" href="/assets/01.html-C0GQP12y.js" as="script"><link rel="prefetch" href="/assets/02.html-DBg1dI0G.js" as="script"><link rel="prefetch" href="/assets/03.html-y4IiZ3wf.js" as="script"><link rel="prefetch" href="/assets/04.html-IDMNH7bA.js" as="script"><link rel="prefetch" href="/assets/05.html-Y6mR9X3M.js" as="script"><link rel="prefetch" href="/assets/06.html-DWCimW-D.js" as="script"><link rel="prefetch" href="/assets/07.html-DhISmMdB.js" as="script"><link rel="prefetch" href="/assets/08.html-YY2J5GxJ.js" as="script"><link rel="prefetch" href="/assets/09.html-ctlgwEuP.js" as="script"><link rel="prefetch" href="/assets/index.html-B_hTTcWj.js" as="script"><link rel="prefetch" href="/assets/index.html-Dq_cDEHJ.js" as="script"><link rel="prefetch" href="/assets/01.html-DugU8eKO.js" as="script"><link rel="prefetch" href="/assets/02.html-DyfBMJ2w.js" as="script"><link rel="prefetch" href="/assets/03.html-EHTF6qk_.js" as="script"><link rel="prefetch" href="/assets/04.html-CdA5wGDK.js" as="script"><link rel="prefetch" href="/assets/05.html-CjCW8EkH.js" as="script"><link rel="prefetch" href="/assets/06.html-CBPrugTt.js" as="script"><link rel="prefetch" href="/assets/index.html-94pnOWPP.js" as="script"><link rel="prefetch" href="/assets/index.html-BfgSF74v.js" as="script"><link rel="prefetch" href="/assets/foråµŒå¥—.html-CFS1FRYz.js" as="script"><link rel="prefetch" href="/assets/ifè¯­å¥ä¸shellè¿ç®—.html-DNAcekjl.js" as="script"><link rel="prefetch" href="/assets/ifé«˜çº§ç”¨æ³•.html-DPKWrBd_.js" as="script"><link rel="prefetch" href="/assets/shell æ•°ç»„è¯¦è§£.html-C3EzmSma.js" as="script"><link rel="prefetch" href="/assets/shellå‡½æ•°.html-Brnnsq-0.js" as="script"><link rel="prefetch" href="/assets/shellå˜é‡è¯¦è§£.html-CvlIeffj.js" as="script"><link rel="prefetch" href="/assets/shellå¯¹æ–‡ä»¶çš„æ“ä½œ.html-BQ_5Y7hb.js" as="script"><link rel="prefetch" href="/assets/shellæ•°æ®ç­›é€‰ä¸å¤„ç†.html-CcnrIwqC.js" as="script"><link rel="prefetch" href="/assets/shellæµç¨‹æ§åˆ¶-ifåˆ¤æ–­è¯­å¥.html-y5tkYJcQ.js" as="script"><link rel="prefetch" href="/assets/shellè„šæœ¬ä¸­å¸¸ç”¨å‘½ä»¤å¤ä¹ .html-C9YxcqEr.js" as="script"><link rel="prefetch" href="/assets/shellè„šæœ¬ä»‹ç».html-Ccs8sXm6.js" as="script"><link rel="prefetch" href="/assets/shellè„šæœ¬å®æˆ˜æ¡ˆä¾‹-æ•°æ®ç£ç›˜åˆå§‹åŒ–.html-BQm9l3A-.js" as="script"><link rel="prefetch" href="/assets/shellè„šæœ¬æ ¼å¼åŒ–è¾“å‡º.html-CIYVgUG9.js" as="script"><link rel="prefetch" href="/assets/shellè„šæœ¬æ¡ˆä¾‹-Pythonå®‰è£…è„šæœ¬.html-89qiN80o.js" as="script"><link rel="prefetch" href="/assets/shellè„šæœ¬æ¡ˆä¾‹-mysqlå¤‡ä»½è„šæœ¬.html-DAS9gAmy.js" as="script"><link rel="prefetch" href="/assets/shellè„šæœ¬æ¡ˆä¾‹-nginxå®‰è£…è„šæœ¬.html-DhtMj4LA.js" as="script"><link rel="prefetch" href="/assets/shellè„šæœ¬æ¡ˆä¾‹-ä¸»æœºçŠ¶æ€ç›‘æ§è„šæœ¬.html-BXFKWyw2.js" as="script"><link rel="prefetch" href="/assets/shellè„šæœ¬æ¡ˆä¾‹-åˆ¤æ–­æœåŠ¡çŠ¶æ€.html-DfV-a2JL.js" as="script"><link rel="prefetch" href="/assets/shellè„šæœ¬æ¡ˆä¾‹-åˆ¤æ–­é—°å¹´.html-hqJYuNeb.js" as="script"><link rel="prefetch" href="/assets/shellè„šæœ¬æ¡ˆä¾‹-ç›‘æ§å†…å­˜ä½¿ç”¨ç‡.html-D3npWz_P.js" as="script"><link rel="prefetch" href="/assets/shellè„šæœ¬æ¡ˆä¾‹-ç›‘æ§æ¥å£.html-C95LYoD8.js" as="script"><link rel="prefetch" href="/assets/shellè„šæœ¬æ¡ˆä¾‹-ç›‘æ§ç£ç›˜ä½¿ç”¨ç‡.html-DbFUJhxt.js" as="script"><link rel="prefetch" href="/assets/shellè„šæœ¬æ¡ˆä¾‹-ç›‘æ§ç½‘å¡æµé‡.html-jCw1nV14.js" as="script"><link rel="prefetch" href="/assets/shellè„šæœ¬æ¡ˆä¾‹-ç›®å½•åˆ¤æ–­.html-B-G0D-Gg.js" as="script"><link rel="prefetch" href="/assets/shellè„šæœ¬ç”¨æˆ·äº¤äº’.html-BmDw9s4E.js" as="script"><link rel="prefetch" href="/assets/shellè¿ç®—å®æˆ˜æ¡ˆä¾‹-KFCç‚¹é¤ç³»ç»Ÿ.html-CYiMXkKU.js" as="script"><link rel="prefetch" href="/assets/shellè¿ç®—è¯¦è§£.html-Cac8wgzH.js" as="script"><link rel="prefetch" href="/assets/å¾ªç¯æ§åˆ¶è¯­å¥.html-jYsHgOCC.js" as="script"><link rel="prefetch" href="/assets/å¾ªç¯è¯­å¥ç»ƒä¹ æ¡ˆä¾‹.html-CcX5SZCy.js" as="script"><link rel="prefetch" href="/assets/æ­£åˆ™è¡¨è¾¾å¼.html-nXwjS_xj.js" as="script"><link rel="prefetch" href="/assets/æµç¨‹æ§åˆ¶-caseè¯­å¥.html-yVKj9lcB.js" as="script"><link rel="prefetch" href="/assets/æµç¨‹æ§åˆ¶-forå¾ªç¯è¯­å¥.html-rIlk6Aeg.js" as="script"><link rel="prefetch" href="/assets/æµç¨‹æ§åˆ¶-untilè¯­å¥.html-DamPwC_t.js" as="script"><link rel="prefetch" href="/assets/æµç¨‹æ§åˆ¶-whileå¾ªç¯.html-ClOPvD56.js" as="script"><link rel="prefetch" href="/assets/ç¼–ç¨‹è¯­è¨€ä¸shellè„šæœ¬.html-DsOtq-KT.js" as="script"><link rel="prefetch" href="/assets/1ã€è®¤è¯†åŠ¨æ€ä¸»æœºé…ç½®åè®®.html-DlmqoEVw.js" as="script"><link rel="prefetch" href="/assets/2ã€æ­å»ºç®€å•çš„dhcpæœåŠ¡å™¨.html-BShvbaZN.js" as="script"><link rel="prefetch" href="/assets/3ã€dhcpæœåŠ¡é…ç½®ipä¸macåœ°å€ç»‘å®š.html-CV868r_f.js" as="script"><link rel="prefetch" href="/assets/1ã€è®¤è¯†ç”µå­é‚®ä»¶ç³»ç»Ÿ.html-BUwkdkOO.js" as="script"><link rel="prefetch" href="/assets/2ã€éƒ¨ç½²åŸºç¡€ç”µå­é‚®ä»¶ç³»ç»Ÿ.html-CIwBVumd.js" as="script"><link rel="prefetch" href="/assets/1ã€é…ç½®CAè®¤è¯ä¸­å¿ƒå®ç°httpå–è¯.html-BonEDe2D.js" as="script"><link rel="prefetch" href="/assets/1ã€ä½¿ç”¨VMware Workstation Proå®‰è£…éƒ¨ç½² centos7ç³»ç»Ÿ.html-DbVlmL6E.js" as="script"><link rel="prefetch" href="/assets/2ã€ä½¿ç”¨Oracle VM VirtualBoxå®‰è£…éƒ¨ç½²centos7ç³»ç»Ÿ.html-Aq4jsh8x.js" as="script"><link rel="prefetch" href="/assets/3ã€é‡ç½®rootå¯†ç .html-Bmd-u0EA.js" as="script"><link rel="prefetch" href="/assets/4ã€é…ç½®æœ¬åœ°yumæº.html-c_N24FLx.js" as="script"><link rel="prefetch" href="/assets/5ã€é…ç½®ç½‘ç»œyumæº.html-C9hCw1FT.js" as="script"><link rel="prefetch" href="/assets/6ã€systemdåˆå§‹åŒ–è¿›ç¨‹.html-BsfdoLd_.js" as="script"><link rel="prefetch" href="/assets/7ã€telnetç®¡ç†ä¸»æœº.html-Clz3p2-l.js" as="script"><link rel="prefetch" href="/assets/8ã€centos7ä¸­ç»‘å®šåŒç½‘å¡é…ç½®.html-DCNsUr3A.js" as="script"><link rel="prefetch" href="/assets/9ã€centos7ä¸­ç½‘å¡æ·»åŠ å¤šä¸ªipåœ°å€.html-DsZQdDpn.js" as="script"><link rel="prefetch" href="/assets/1ã€è®¤è¯†æ•°æ®åº“ç®¡ç†ç³»ç»Ÿ.html-ChMKPyRX.js" as="script"><link rel="prefetch" href="/assets/2ã€å®‰è£…åˆå§‹åŒ–mariadbæ•°æ®åº“ç³»ç»Ÿ.html-B60c2SKV.js" as="script"><link rel="prefetch" href="/assets/3ã€ä¿®æ”¹æ•°æ®åº“rootç”¨æˆ·å¯†ç .html-DlYcTHhR.js" as="script"><link rel="prefetch" href="/assets/4ã€ç®¡ç†è´¦æˆ·ä»¥åŠæˆæƒ.html-ClU3i3Wf.js" as="script"><link rel="prefetch" href="/assets/5ã€åˆ›å»ºæ•°æ®åº“ä¸è¡¨å•.html-Nit_uu4i.js" as="script"><link rel="prefetch" href="/assets/6ã€ç®¡ç†è¡¨å•åŠæ•°æ®.html-DkR0pF7V.js" as="script"><link rel="prefetch" href="/assets/7ã€æ•°æ®åº“çš„å¤‡ä»½ä¸æ¢å¤.html-CTA_uZJm.js" as="script"><link rel="prefetch" href="/assets/1ã€å¸¸ç”¨ç³»ç»Ÿå·¥ä½œå‘½ä»¤.html-BsLnzKiO.js" as="script"><link rel="prefetch" href="/assets/2ã€ç³»ç»ŸçŠ¶æ€æ£€æµ‹å‘½ä»¤.html-B_3At8ee.js" as="script"><link rel="prefetch" href="/assets/3ã€å·¥ä½œç›®å½•åˆ‡æ¢å‘½ä»¤.html-C9lWG_3l.js" as="script"><link rel="prefetch" href="/assets/4ã€æ–‡æœ¬æ–‡ä»¶ç¼–è¾‘å‘½ä»¤.html-CnqHTqAL.js" as="script"><link rel="prefetch" href="/assets/5ã€æ–‡ä»¶ç›®å½•ç®¡ç†å‘½ä»¤.html-5o5ntamx.js" as="script"><link rel="prefetch" href="/assets/6ã€æ‰“åŒ…å‹ç¼©ä¸æœç´¢å‘½ä»¤.html-CuFKC48J.js" as="script"><link rel="prefetch" href="/assets/1ã€è¾“å…¥è¾“å‡ºé‡å®šå‘.html-r5x6b4UT.js" as="script"><link rel="prefetch" href="/assets/2ã€ç®¡é“ç¬¦.html-DX_7OIYd.js" as="script"><link rel="prefetch" href="/assets/3ã€å‘½ä»¤è¡Œçš„é€šé…ç¬¦.html-Zof2E3Uz.js" as="script"><link rel="prefetch" href="/assets/1ã€vimæ–‡æœ¬ç¼–è¾‘å™¨.html-B_qZtEeG.js" as="script"><link rel="prefetch" href="/assets/2ã€é…ç½®ä¸»æœºå.html-GycT4NZz.js" as="script"><link rel="prefetch" href="/assets/3ã€é…ç½®ç½‘å¡ä¿¡æ¯.html-DdQ8N5sG.js" as="script"><link rel="prefetch" href="/assets/1ã€ç”¨æˆ·èº«ä»½ä¸èƒ½åŠ›.html-DIv1pWx_.js" as="script"><link rel="prefetch" href="/assets/2ã€æ–‡ä»¶æƒé™ä¸å½’å±.html-C_QNu0A_.js" as="script"><link rel="prefetch" href="/assets/3ã€suå‘½ä»¤å’Œsudoå‘½ä»¤.html-bMkUhyuv.js" as="script"><link rel="prefetch" href="/assets/10ã€æ ¹ä¸‹æ‰©å®¹å®.html-LzzuB4sg.js" as="script"><link rel="prefetch" href="/assets/1ã€ç£ç›˜æ–‡ä»¶å­˜å‚¨ç»“æ„.html-BomphfiL.js" as="script"><link rel="prefetch" href="/assets/2ã€ç‰©ç†è®¾å¤‡çš„å‘½åçš„è§„åˆ™.html-Cx0c-I_5.js" as="script"><link rel="prefetch" href="/assets/3ã€æ–‡ä»¶ç³»ç»Ÿ.html-BBjwUFJ_.js" as="script"><link rel="prefetch" href="/assets/4ã€æŒ‚è½½ç¡¬ä»¶è®¾å¤‡.html-DkBsuR4F.js" as="script"><link rel="prefetch" href="/assets/5ã€æ·»åŠ äº¤æ¢åˆ†åŒº.html-CRWr2UfG.js" as="script"><link rel="prefetch" href="/assets/6ã€é…ç½®æŒ‚è½½æ–‡ä»¶å¼€æœºè‡ªåŠ¨æŒ‚è½½ï¼ˆæ°¸ä¹…æŒ‚è½½ï¼‰.html-DMJKdhZN.js" as="script"><link rel="prefetch" href="/assets/7ã€ç£ç›˜é…é¢.html-CY_P-b0p.js" as="script"><link rel="prefetch" href="/assets/8ã€RAIDç‹¬ç«‹å†—ä½™ç£ç›˜é˜µåˆ—æŠ€æœ¯.html-B4HElm-B.js" as="script"><link rel="prefetch" href="/assets/9ã€LVM ï¼ˆé€»è¾‘å·ç®¡ç†å™¨ï¼‰.html-BWiYoFap.js" as="script"><link rel="prefetch" href="/assets/1ã€è®¤è¯†Apacheä¸é…ç½®æœåŠ¡æ–‡ä»¶å‚æ•°.html-D9qWpBE_.js" as="script"><link rel="prefetch" href="/assets/2ã€åˆ©ç”¨ApacheæœåŠ¡éƒ¨ç½²é»˜è®¤ç½‘ç«™ï¼ˆå•ä¸ªï¼‰.html-CHPguWjK.js" as="script"><link rel="prefetch" href="/assets/3ã€åˆ©ç”¨apacheæ­å»ºå¤šä¸ªipå¯¹åº”å¤šä¸ªç«™ç‚¹.html-Cfo9r7wG.js" as="script"><link rel="prefetch" href="/assets/4ã€åˆ©ç”¨apacheé…ç½®åŸºäºip_ç«¯å£çš„è™šæ‹Ÿä¸»æœº.html-C2A3M_GG.js" as="script"><link rel="prefetch" href="/assets/5ã€åˆ©ç”¨Apacheæ­å»ºåŸºäºè™šæ‹Ÿç›®å½•çš„è™šæ‹Ÿä¸»æœº.html-R-WWja11.js" as="script"><link rel="prefetch" href="/assets/1ã€äº†è§£DNSåŸŸåè§£ææœåŠ¡.html-D0acgIDF.js" as="script"><link rel="prefetch" href="/assets/2ã€åˆ©ç”¨bindæœåŠ¡ç¨‹åºæ­å»ºå•åŒºåŸŸdnsæœåŠ¡.html-DPv0e5dS.js" as="script"><link rel="prefetch" href="/assets/3ã€ä½¿ç”¨bindæœåŠ¡æ­å»ºå¤šåŒºåŸŸåŸŸåè§£ææœåŠ¡.html-DyWgsQ7V.js" as="script"><link rel="prefetch" href="/assets/4ã€ä½¿ç”¨bindéƒ¨ç½²dnsä¸»ä»æœåŠ¡å™¨ï¼Œå®ç°dnså†—ä½™è´Ÿè½½å‡è¡¡.html-izAkMPWf.js" as="script"><link rel="prefetch" href="/assets/1ã€ç½‘ç»œæ–‡ä»¶ç³»ç»ŸNFS.html-Bx-96HRM.js" as="script"><link rel="prefetch" href="/assets/2ã€å…±äº«æ–‡ä»¶ç³»ç»Ÿsamba.html-bDUzCYVJ.js" as="script"><link rel="prefetch" href="/assets/3ã€é¡¹ç›®å®æˆ˜sambaæœåŠ¡.html-B96_dgA6.js" as="script"><link rel="prefetch" href="/assets/4ã€ä½¿ç”¨vsftpdæœåŠ¡ä¼ è¾“æ–‡ä»¶.html-CbJ_tPYB.js" as="script"><link rel="prefetch" href="/assets/5ã€åˆ©ç”¨vsftpdæ­å»ºå®åftpæœåŠ¡.html-zGO5F89a.js" as="script"><link rel="prefetch" href="/assets/6ã€åˆ©ç”¨vsftpdæ­å»ºåŸºäºè™šæ‹Ÿç”¨æˆ·è®¿é—®çš„ftpæœåŠ¡.html-BwaYXi3m.js" as="script"><link rel="prefetch" href="/assets/index.html-BzUemh21.js" as="script"><link rel="prefetch" href="/assets/index.html-CGYLf6Np.js" as="script"><link rel="prefetch" href="/assets/01.html-RZXHXsli.js" as="script"><link rel="prefetch" href="/assets/index.html-BpeUVFzt.js" as="script"><link rel="prefetch" href="/assets/index.html-DTclJXBK.js" as="script"><link rel="prefetch" href="/assets/01.html-XqJ7R8QD.js" as="script"><link rel="prefetch" href="/assets/index.html-Cn4lGFjD.js" as="script"><link rel="prefetch" href="/assets/01.html-04FdsLT3.js" as="script"><link rel="prefetch" href="/assets/02.html-B_cL-_j8.js" as="script"><link rel="prefetch" href="/assets/03.html-C0y-jFha.js" as="script"><link rel="prefetch" href="/assets/04.html-CkWls7ed.js" as="script"><link rel="prefetch" href="/assets/05.html-Bh53NzZ-.js" as="script"><link rel="prefetch" href="/assets/index.html-C_LKWKgD.js" as="script"><link rel="prefetch" href="/assets/index.html-WjLlEiZz.js" as="script"><link rel="prefetch" href="/assets/404.html-C2JuHhRm.js" as="script"><link rel="prefetch" href="/assets/index.html-Bg3hv7op.js" as="script"><link rel="prefetch" href="/assets/index.html-DjtuPYYs.js" as="script"><link rel="prefetch" href="/assets/index.html-DkwlqFYC.js" as="script"><link rel="prefetch" href="/assets/index.html-C3W7pFSe.js" as="script"><link rel="prefetch" href="/assets/index.html-B_Y1Gy_S.js" as="script"><link rel="prefetch" href="/assets/index.html-D4hJ4moY.js" as="script"><link rel="prefetch" href="/assets/index.html-NzAK8_dN.js" as="script"><link rel="prefetch" href="/assets/index.html-C35um6bs.js" as="script"><link rel="prefetch" href="/assets/index.html-DHSg2D2d.js" as="script"><link rel="prefetch" href="/assets/index.html-DXrg_wVK.js" as="script"><link rel="prefetch" href="/assets/index.html-DjEb4V5k.js" as="script"><link rel="prefetch" href="/assets/index.html-c9Xr2mpP.js" as="script"><link rel="prefetch" href="/assets/index.html-B0UAxesw.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-GXRgw7eJ.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="https://www.xxjsfb.cn/static/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">é£å</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="æˆ‘çš„ä¸»é¡µ"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span><!--]-->æˆ‘çš„ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/portfolio.html" aria-label="æˆ‘çš„å¸…ç…§"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-image" style=""></span><!--]-->æˆ‘çš„å¸…ç…§<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/note/" aria-label="æˆ‘çš„ç¬”è®°"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><!--]-->æˆ‘çš„ç¬”è®°<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/yl/" aria-label="å‹æƒ…è¿æ¥"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-diagram-project" style=""></span><!--]-->å‹æƒ…è¿æ¥<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><!----><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="æœç´¢" autocomplete="off" spellcheck="false" value><!----></form><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-header active"><span class="font-icon icon fa-fw fa-sm fas fa-person-chalkboard" style=""></span><span class="vp-sidebar-title">æˆ‘çš„ç¬”è®°</span><!----></p><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/note/" aria-label="ç¬”è®°"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-laptop-code" style=""></span><!--]-->ç¬”è®°<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Centosç¬”è®°</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Dockerç¬”è®°</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">kubernetesç¬”è®°</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/note/kubernetes/" aria-label="kubernetesç¬”è®°"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><!--]-->kubernetesç¬”è®°<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">1ã€å®‰è£…ç¯‡</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/note/kubernetes/install/" aria-label="1ã€å®‰è£…ç¯‡"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><!--]-->1ã€å®‰è£…ç¯‡<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">äºŒè¿›åˆ¶å®‰è£…</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">kubeadmå®‰è£…</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/note/kubernetes/install/kubeadm/" aria-label="kubeadmå®‰è£…"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><!--]-->kubeadmå®‰è£…<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">1ã€å®‰è£…1ä¸»2ä»</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">2ã€å®‰è£…3ä¸»3ä»</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/note/kubernetes/install/kubeadm/High%20availability/" aria-label="2ã€å®‰è£…3ä¸»3ä»"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><!--]-->2ã€å®‰è£…3ä¸»3ä»<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/note/kubernetes/install/kubeadm/High%20availability/01.html" aria-label="01-éƒ¨ç½²3ä¸»3ä»çš„é«˜å¯ç”¨é›†ç¾¤"><!--[--><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span><!--]-->01-éƒ¨ç½²3ä¸»3ä»çš„é«˜å¯ç”¨é›†ç¾¤<!----></a></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">kubesphereå®‰è£…</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">rke2å®‰è£…</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Prometheusç¬”è®°</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Shellç¬”è®°</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span><span class="vp-sidebar-title">Supervisorç¬”è®°</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon fa-fw fa-sm fas fa-lightbulb" style=""></span>01-éƒ¨ç½²3ä¸»3ä»çš„é«˜å¯ç”¨é›†ç¾¤</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="/portfolio" target="_blank" rel="noopener noreferrer">é£å</a></span><span property="author" content="é£å"></span></span><!----><!----><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 19 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT19M"></span><!----><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1ã€ä¸»æœºæ“ä½œç³»ç»Ÿè¯´æ˜">1ã€ä¸»æœºæ“ä½œç³»ç»Ÿè¯´æ˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2ã€ä¸»æœºç¡¬ä»¶é…ç½®è¯´æ˜">2ã€ä¸»æœºç¡¬ä»¶é…ç½®è¯´æ˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3ã€ä¸»æœºé…ç½®">3ã€ä¸»æœºé…ç½®</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-1ã€é…ç½®yumæº-æ‰€æœ‰ä¸»æœºéƒ½é…ç½®">3.1ã€é…ç½®yumæºï¼Œæ‰€æœ‰ä¸»æœºéƒ½é…ç½®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-2ã€ä¿®æ”¹ä¸»æœºå-é…ç½®hostsæœ¬åœ°è§£æ">3.2ã€ä¿®æ”¹ä¸»æœºåï¼Œé…ç½®hostsæœ¬åœ°è§£æ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-3ã€æ‰€æœ‰èŠ‚ç‚¹ä¼˜åŒ–">3.3ã€æ‰€æœ‰èŠ‚ç‚¹ä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-4ã€é…ç½®å…å¯†-ä¸­æ§æœºæ“ä½œ-master01">3.4ã€é…ç½®å…å¯†[ä¸­æ§æœºæ“ä½œ:master01]</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-5ã€å‡çº§å†…æ ¸">3.5ã€å‡çº§å†…æ ¸</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-6ã€æ‰€æœ‰èŠ‚ç‚¹å®‰è£…ipvsadm">3.6ã€æ‰€æœ‰èŠ‚ç‚¹å®‰è£…ipvsadm</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-7ã€k8så†…æ ¸ä¼˜åŒ–">3.7ã€k8så†…æ ¸ä¼˜åŒ–</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-8ã€åŸºæœ¬ç»„ä»¶å®‰è£…">3.8ã€åŸºæœ¬ç»„ä»¶å®‰è£…</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4ã€kubernetesé›†ç¾¤åˆå§‹åŒ–">4ã€kubernetesé›†ç¾¤åˆå§‹åŒ–</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-2ã€master02-master03-åŠ å…¥masteré›†ç¾¤">4.2ã€master02 master03 åŠ å…¥masteré›†ç¾¤</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-3ã€worker01-worker02-worker03-åŠ å…¥masteré›†ç¾¤">4.3ã€worker01 worker02 worker03 åŠ å…¥masteré›†ç¾¤</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-4ã€åŠ å…¥ç»“æœé¢„è§ˆ">4.4ã€åŠ å…¥ç»“æœé¢„è§ˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-5ã€master01èŠ‚ç‚¹é…ç½®ç¯å¢ƒå˜é‡-ç”¨äºè®¿é—®kubernetesé›†ç¾¤">4.5ã€Master01èŠ‚ç‚¹é…ç½®ç¯å¢ƒå˜é‡ï¼Œç”¨äºè®¿é—®Kubernetesé›†ç¾¤ï¼š</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_5ã€å®‰è£…calicoç½‘ç»œç»„ä»¶-master01æ“ä½œ">5ã€å®‰è£…calicoç½‘ç»œç»„ä»¶[master01æ“ä½œ]</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_6ã€å®‰è£…dashboard">6ã€å®‰è£…dashboard</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_7ã€é€šè¿‡httpsåè®®è¿›è¡Œè®¿é—®">7ã€é€šè¿‡httpsåè®®è¿›è¡Œè®¿é—®</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_8ã€-é…ç½®ä¿®æ”¹">8ã€ é…ç½®ä¿®æ”¹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_9ã€-é«˜å¯ç”¨æµ‹è¯•">9ã€ é«˜å¯ç”¨æµ‹è¯•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_10ã€-å®‰è£…kuboardé›†ç¾¤ç®¡ç†é¢æ¿">10ã€ å®‰è£…Kuboardé›†ç¾¤ç®¡ç†é¢æ¿</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><p><a style="color:blue;font-size:30px;">éƒ¨ç½²3ä¸»3ä»çš„kubernetes1.21.0é«˜å¯ç”¨é›†ç¾¤ç¯å¢ƒ</a></p><p>å‚è€ƒåœ°å€ï¼šhttps://www.cnblogs.com/superlinux/p/14676959.html</p><h2 id="_1ã€ä¸»æœºæ“ä½œç³»ç»Ÿè¯´æ˜" tabindex="-1"><a class="header-anchor" href="#_1ã€ä¸»æœºæ“ä½œç³»ç»Ÿè¯´æ˜"><span>1ã€ä¸»æœºæ“ä½œç³»ç»Ÿè¯´æ˜</span></a></h2><table><thead><tr><th>åºå·</th><th>æ“ä½œç³»ç»ŸåŠç‰ˆæœ¬</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>1</td><td>centos7.6</td><td></td></tr></tbody></table><h2 id="_2ã€ä¸»æœºç¡¬ä»¶é…ç½®è¯´æ˜" tabindex="-1"><a class="header-anchor" href="#_2ã€ä¸»æœºç¡¬ä»¶é…ç½®è¯´æ˜"><span>2ã€ä¸»æœºç¡¬ä»¶é…ç½®è¯´æ˜</span></a></h2><table><thead><tr><th>éœ€æ±‚</th><th>CPU</th><th>å†…å­˜</th><th>ç¡¬ç›˜</th><th>è§’è‰²</th><th>ä¸»æœºå</th><th>ipåœ°å€</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>å€¼</td><td>4C</td><td>8G</td><td>100G</td><td>master</td><td>k8s-master01</td><td>192.168.10.21</td><td></td></tr><tr><td>å€¼</td><td>4C</td><td>8G</td><td>100G</td><td>master</td><td>k8s-master02</td><td>192.168.10.22</td><td></td></tr><tr><td>å€¼</td><td>4C</td><td>8G</td><td>100G</td><td>master</td><td>k8s-master03</td><td>192.168.10.23</td><td></td></tr><tr><td>å€¼</td><td>4C</td><td>8G</td><td>100G</td><td>workerï¼ˆnodeï¼‰</td><td>k8s-worker01</td><td>192.168.10.24</td><td></td></tr><tr><td>å€¼</td><td>4C</td><td>8G</td><td>100G</td><td>workerï¼ˆnodeï¼‰</td><td>k8s-worker02</td><td>192.168.10.25</td><td></td></tr><tr><td>å€¼</td><td>4C</td><td>8G</td><td>100G</td><td>workerï¼ˆnodeï¼‰</td><td>k8s-worker03</td><td>192.168.10.26</td><td></td></tr><tr><td></td><td></td><td></td><td></td><td></td><td>k8s-master-lb</td><td>192.168.10.100</td><td></td></tr></tbody></table><table><thead><tr><th>åºå·</th><th>ä¸»æœºå</th><th>åŠŸèƒ½</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>1</td><td>master01</td><td>haproxyã€keepalived</td><td>keepalivedä¸»èŠ‚ç‚¹</td></tr><tr><td>2</td><td>master02</td><td>haproxyã€keepalived</td><td>keepalivedä»èŠ‚ç‚¹</td></tr><tr><td>3</td><td>master03</td><td>haproxyã€keepalived</td><td>keepalivedä»èŠ‚ç‚¹</td></tr></tbody></table><p><strong>èŠ±é‡Œèƒ¡å“¨çš„ç¾åŒ–é…ç½®</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#å‘½ä»¤è¡Œä¼˜åŒ–ï¼š</span></span>
<span class="line"><span>echo &quot;export PS1=&#39;\[\033[01;31m\]\u\[\033[00m\]@\[\033[01;32m\]\h\[\033[00m\][\[\033[01;33m\]\t\[\033[00m\]]:\[\033[01;34m\]\w\[\033[00m\]$ &#39;&quot; &gt;&gt;/etc/profile</span></span>
<span class="line"><span>source /etc/profile</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#å†å²è®°å½•ä¼˜åŒ–ï¼š </span></span>
<span class="line"><span>export HISTTIMEFORMAT=&#39;%F %T &#39; </span></span>
<span class="line"><span>echo &quot;export HISTTIMEFORMAT=&#39;%F %T &#39;&quot; &gt;&gt;/etc/profile </span></span>
<span class="line"><span>source /etc/profile</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3ã€ä¸»æœºé…ç½®" tabindex="-1"><a class="header-anchor" href="#_3ã€ä¸»æœºé…ç½®"><span>3ã€ä¸»æœºé…ç½®</span></a></h2><h3 id="_3-1ã€é…ç½®yumæº-æ‰€æœ‰ä¸»æœºéƒ½é…ç½®" tabindex="-1"><a class="header-anchor" href="#_3-1ã€é…ç½®yumæº-æ‰€æœ‰ä¸»æœºéƒ½é…ç½®"><span>3.1ã€é…ç½®yumæºï¼Œæ‰€æœ‰ä¸»æœºéƒ½é…ç½®</span></a></h3><blockquote><p>é‡‡ç”¨é˜¿é‡Œäº‘æº</p></blockquote><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>rm -rf  /etc/yum.repos.d/*</span></span>
<span class="line"><span>cd /etc/yum.repos.d/</span></span>
<span class="line"><span>curl -o /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo</span></span>
<span class="line"><span>yum install -y yum-utils device-mapper-persistent-data lvm2</span></span>
<span class="line"><span>yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span>
<span class="line"><span></span></span>
<span class="line"><span>cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span></span>
<span class="line"><span>[kubernetes]</span></span>
<span class="line"><span>name=Kubernetes</span></span>
<span class="line"><span>baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span></span>
<span class="line"><span>enabled=1</span></span>
<span class="line"><span>gpgcheck=1</span></span>
<span class="line"><span>repo_gpgcheck=1</span></span>
<span class="line"><span>gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span>sed -i -e &#39;/mirrors.cloud.aliyuncs.com/d&#39; -e &#39;/mirrors.aliyuncs.com/d&#39; /etc/yum.repos.d/CentOS-Base.repo</span></span>
<span class="line"><span>yum clean all</span></span>
<span class="line"><span>yum install -y epel-release</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#å®‰è£…å¿…å¤‡å·¥å…·ï¼š</span></span>
<span class="line"><span>#å¿…å¤‡å·¥å…·å®‰è£…</span></span>
<span class="line"><span>yum install wget jq psmisc vim net-tools telnet yum-utils device-mapper-persistent-data lvm2 git -y</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ä¸‹è½½å®‰è£…æ‰€æœ‰çš„æºç æ–‡ä»¶ï¼Œåé¢éœ€è¦ç”¨åˆ°</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cd /root/ </span></span>
<span class="line"><span>git clone https://github.com/dotbalo/k8s-ha-install.git</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#å¦‚æœæ— æ³•ä¸‹è½½è¯·ä½¿ç”¨ä¸‹é¢çš„é‡è¯•ï¼š</span></span>
<span class="line"><span>git clone https://gitee.com/dukuan/k8s-ha-install.git</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2ã€ä¿®æ”¹ä¸»æœºå-é…ç½®hostsæœ¬åœ°è§£æ" tabindex="-1"><a class="header-anchor" href="#_3-2ã€ä¿®æ”¹ä¸»æœºå-é…ç½®hostsæœ¬åœ°è§£æ"><span>3.2ã€ä¿®æ”¹ä¸»æœºåï¼Œé…ç½®hostsæœ¬åœ°è§£æ</span></a></h3><blockquote><p>master01ä¸ºä¾‹ï¼Œå…¶ä»–ä¸»æœºå‡é…ç½®ï¼Œæ³¨æ„ä¸»æœºå</p></blockquote><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>hostnamectl set-hostname k8s-master01</span></span>
<span class="line"><span>bash</span></span>
<span class="line"><span>cat &gt;&gt; /etc/hosts &lt;&lt;EOF</span></span>
<span class="line"><span>192.168.3.31 k8s-master01</span></span>
<span class="line"><span>192.168.3.32 k8s-master02</span></span>
<span class="line"><span>192.168.3.33 k8s-master03</span></span>
<span class="line"><span>192.168.3.34 k8s-worker01</span></span>
<span class="line"><span>192.168.3.35 k8s-worker02</span></span>
<span class="line"><span>192.168.3.36 k8s-worker03</span></span>
<span class="line"><span>192.168.3.100 k8s-master-lb</span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span>cat /etc/hosts</span></span>
<span class="line"><span>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span></span>
<span class="line"><span>::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span></span>
<span class="line"><span>192.168.3.31 k8s-master01</span></span>
<span class="line"><span>192.168.3.32 k8s-master02</span></span>
<span class="line"><span>192.168.3.33 k8s-master03</span></span>
<span class="line"><span>192.168.3.34 k8s-worker01</span></span>
<span class="line"><span>192.168.3.35 k8s-worker02</span></span>
<span class="line"><span>192.168.3.36 k8s-worker03</span></span>
<span class="line"><span>192.168.3.100 k8s-master-lb</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>å®Œæˆä»¥ååœ¨master01ä¸Šæµ‹è¯•è¿é€šæ€§</p></blockquote><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>[root@master01 ~]# ping k8s-worker01</span></span>
<span class="line"><span>[root@master01 ~]# ping k8s-worker02</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#ä»¥ä¸‹ä»¥master01ç»“æœä¸ºä¾‹</span></span>
<span class="line"><span>[root@master01 ~]# ping worker01 </span></span>
<span class="line"><span>PING worker01 (192.168.10.22) 56(84) bytes of data.</span></span>
<span class="line"><span>64 bytes from worker01 (192.168.10.22): icmp_seq=1 ttl=64 time=0.652 ms</span></span>
<span class="line"><span>64 bytes from worker01 (192.168.10.22): icmp_seq=2 ttl=64 time=0.430 ms</span></span>
<span class="line"><span>^C</span></span>
<span class="line"><span>--- worker01 ping statistics ---</span></span>
<span class="line"><span>2 packets transmitted, 2 received, 0% packet loss, time 1065ms</span></span>
<span class="line"><span>rtt min/avg/max/mdev = 0.430/0.541/0.652/0.111 ms</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@master01 ~]# ping worker02</span></span>
<span class="line"><span>PING worker02 (192.168.10.23) 56(84) bytes of data.</span></span>
<span class="line"><span>64 bytes from worker02 (192.168.10.23): icmp_seq=1 ttl=64 time=0.774 ms</span></span>
<span class="line"><span>64 bytes from worker02 (192.168.10.23): icmp_seq=2 ttl=64 time=0.444 ms</span></span>
<span class="line"><span>^C</span></span>
<span class="line"><span>--- worker02 ping statistics ---</span></span>
<span class="line"><span>2 packets transmitted, 2 received, 0% packet loss, time 1019ms</span></span>
<span class="line"><span>rtt min/avg/max/mdev = 0.444/0.609/0.774/0.165 ms</span></span>
<span class="line"><span></span></span>
<span class="line"><span>------</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3ã€æ‰€æœ‰èŠ‚ç‚¹ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_3-3ã€æ‰€æœ‰èŠ‚ç‚¹ä¼˜åŒ–"><span>3.3ã€æ‰€æœ‰èŠ‚ç‚¹ä¼˜åŒ–</span></a></h3><blockquote><p>master01ä¸ºä¾‹ï¼Œå…¶ä»–ä¸»æœºå‡é…ç½®ï¼Œé…ç½®å®Œæˆå <em><strong>é‡å¯ä¸»æœº</strong></em></p></blockquote><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#æ‰€æœ‰èŠ‚ç‚¹å…³é—­é˜²ç«å¢™ã€selinuxã€dnsmasqã€swapã€‚æœåŠ¡å™¨é…ç½®å¦‚ä¸‹ï¼š</span></span>
<span class="line"><span>systemctl disable --now firewalld </span></span>
<span class="line"><span>systemctl disable --now dnsmasq</span></span>
<span class="line"><span></span></span>
<span class="line"><span>setenforce 0</span></span>
<span class="line"><span>sed -i &#39;s#SELINUX=enforcing#SELINUX=disabled#g&#39; /etc/sysconfig/selinux</span></span>
<span class="line"><span>sed -i &#39;s#SELINUX=enforcing#SELINUX=disabled#g&#39; /etc/selinux/config</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#å…³é—­swapåˆ†åŒº</span></span>
<span class="line"><span>swapoff -a &amp;&amp; sysctl -w vm.swappiness=0</span></span>
<span class="line"><span>sed -ri &#39;/^[^#]*swap/s@^@#@&#39; /etc/fstab</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#å®‰è£…ntpdate</span></span>
<span class="line"><span>rpm -ivh http://mirrors.wlnmp.com/centos/wlnmp-release-centos.noarch.rpm</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#æ·»åŠ è®¡åˆ’ä»»åŠ¡</span></span>
<span class="line"><span>yum install -y ntpdate</span></span>
<span class="line"><span>echo &#39;*/5 * * * * ntpdate cn.pool.ntp.org&#39; &gt;&gt;/var/spool/cron/root</span></span>
<span class="line"><span>systemctl restart crond</span></span>
<span class="line"><span>ntpdate time2.aliyun.com</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#æ‰€æœ‰èŠ‚ç‚¹åŒæ­¥æ—¶é—´ã€‚æ—¶é—´åŒæ­¥é…ç½®å¦‚ä¸‹ï¼š</span></span>
<span class="line"><span>ln -sf /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</span></span>
<span class="line"><span>echo &#39;Asia/Shanghai&#39; &gt;/etc/timezone</span></span>
<span class="line"><span>ntpdate time2.aliyun.com</span></span>
<span class="line"><span># åŠ å…¥åˆ°crontab</span></span>
<span class="line"><span>*/5 * * * * /usr/sbin/ntpdate time2.aliyun.com</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#limitä¼˜åŒ–</span></span>
<span class="line"><span>ulimit -SHn 65535</span></span>
<span class="line"><span></span></span>
<span class="line"><span>cat &lt;&lt;EOF &gt;&gt; /etc/security/limits.conf</span></span>
<span class="line"><span>* soft nofile 655360</span></span>
<span class="line"><span>* hard nofile 131072</span></span>
<span class="line"><span>* soft nproc 655350</span></span>
<span class="line"><span>* hard nproc 655350</span></span>
<span class="line"><span>* soft memlock unlimited</span></span>
<span class="line"><span>* hard memlock unlimited</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-4ã€é…ç½®å…å¯†-ä¸­æ§æœºæ“ä½œ-master01" tabindex="-1"><a class="header-anchor" href="#_3-4ã€é…ç½®å…å¯†-ä¸­æ§æœºæ“ä½œ-master01"><span>3.4ã€é…ç½®å…å¯†[ä¸­æ§æœºæ“ä½œ:master01]</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#Master01èŠ‚ç‚¹å…å¯†é’¥ç™»å½•å…¶ä»–èŠ‚ç‚¹ï¼Œå®‰è£…è¿‡ç¨‹ä¸­ç”Ÿæˆé…ç½®æ–‡ä»¶å’Œè¯ä¹¦å‡åœ¨Master01ä¸Šæ“ä½œï¼Œé›†ç¾¤ç®¡ç†ä¹Ÿåœ¨Master01ä¸Šæ“ä½œï¼Œé˜¿é‡Œäº‘æˆ–è€…AWSä¸Šéœ€è¦å•ç‹¬ä¸€å°kubectlæœåŠ¡å™¨ã€‚å¯†é’¥é…ç½®å¦‚ä¸‹ï¼š</span></span>
<span class="line"><span>cd /root</span></span>
<span class="line"><span>ssh-keygen -t rsa</span></span>
<span class="line"><span>for i in k8s-master01 k8s-master02 k8s-master03 k8s-worker01 k8s-worker02 k8s-worker03;do ssh-copy-id -i .ssh/id_rsa.pub $i;done</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5ã€å‡çº§å†…æ ¸" tabindex="-1"><a class="header-anchor" href="#_3-5ã€å‡çº§å†…æ ¸"><span>3.5ã€å‡çº§å†…æ ¸</span></a></h3><blockquote><p>åŸæ–‡ï¼šhttps://www.xxjsfb.cn/doc/275/</p></blockquote><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#å¯ç”¨ ELRepo åªéœ€è¦æ‰§è¡Œå‘½ä»¤ï¼š</span></span>
<span class="line"><span>yum -y install elrepo-release</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span># åˆ—å‡ºå¯ç”¨çš„å†…æ ¸ç›¸å…³åŒ…ï¼š</span></span>
<span class="line"><span>yum --disablerepo=&quot;*&quot; --enablerepo=&quot;elrepo-kernel&quot; list available</span></span>
<span class="line"><span>yum --disablerepo=&quot;*&quot; --enablerepo=&quot;elrepo-kernel&quot; list available --showduplicates #æŸ¥çœ‹æ‰€æœ‰ç‰ˆæœ¬</span></span>
<span class="line"><span></span></span>
<span class="line"><span># æ ¹æ®ä¸Šè¿°æŸ¥è¯¢ç»“æœï¼Œå®‰è£…å†…æ ¸ç›¸å…³åŒ…</span></span>
<span class="line"><span># å®‰è£…æ–°å†…æ ¸</span></span>
<span class="line"><span>yum --disablerepo=\* --enablerepo=elrepo-kernel install -y kernel-ml.x86_64</span></span>
<span class="line"><span>#kernel-coreã€kernel-modules ä¸ kernel ä¾èµ–è‡ªåŠ¨æ›´æ–°</span></span>
<span class="line"><span># å®‰è£…æ–°å†…æ ¸ç›¸å…³è½¯ä»¶</span></span>
<span class="line"><span>yum --disablerepo=\* --enablerepo=elrepo-kernel install -y kernel-ml-devel kernel-ml-tools kernel-ml-tools-libs kernel-ml-tools-libs-devel kernel-ml-headers --skip-broken</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#æŸ¥çœ‹ç³»ç»Ÿå®‰è£…çš„å…¨éƒ¨å†…æ ¸ï¼š</span></span>
<span class="line"><span>root@k8s-master01[18:08:45]:~$ grubby --info=ALL</span></span>
<span class="line"><span>index=0</span></span>
<span class="line"><span>kernel=/boot/vmlinuz-6.6.11-1.el7.elrepo.x86_64</span></span>
<span class="line"><span>args=&quot;ro crashkernel=auto rd.lvm.lv=centos/root rhgb quiet LANG=en_US.UTF-8&quot;</span></span>
<span class="line"><span>root=/dev/mapper/centos-root</span></span>
<span class="line"><span>initrd=/boot/initramfs-6.6.11-1.el7.elrepo.x86_64.img</span></span>
<span class="line"><span>title=CentOS Linux (6.6.11-1.el7.elrepo.x86_64) 7 (Core)</span></span>
<span class="line"><span>index=1</span></span>
<span class="line"><span>kernel=/boot/vmlinuz-3.10.0-957.el7.x86_64</span></span>
<span class="line"><span>args=&quot;ro crashkernel=auto rd.lvm.lv=centos/root rhgb quiet LANG=en_US.UTF-8&quot;</span></span>
<span class="line"><span>root=/dev/mapper/centos-root</span></span>
<span class="line"><span>initrd=/boot/initramfs-3.10.0-957.el7.x86_64.img</span></span>
<span class="line"><span>title=CentOS Linux (3.10.0-957.el7.x86_64) 7 (Core)</span></span>
<span class="line"><span>index=2</span></span>
<span class="line"><span>kernel=/boot/vmlinuz-0-rescue-6b99fdbc99164b2d8a41e9891d315802</span></span>
<span class="line"><span>args=&quot;ro crashkernel=auto rd.lvm.lv=centos/root rhgb quiet&quot;</span></span>
<span class="line"><span>root=/dev/mapper/centos-root</span></span>
<span class="line"><span>initrd=/boot/initramfs-0-rescue-6b99fdbc99164b2d8a41e9891d315802.img</span></span>
<span class="line"><span>title=CentOS Linux (0-rescue-6b99fdbc99164b2d8a41e9891d315802) 7 (Core)</span></span>
<span class="line"><span>index=3</span></span>
<span class="line"><span>non linux entry</span></span>
<span class="line"><span>You have new mail in /var/spool/mail/root</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#ä½¿ç”¨è·¯å¾„æ¥æŒ‡å®šå†…æ ¸ï¼Œå¯ä»¥ä½¿ç”¨ --set-default=kernel-path</span></span>
<span class="line"><span>root@k8s-master01[18:18:16]:~$grubby --set-default=/boot/vmlinuz-6.6.11-1.el7.elrepo.x86_64</span></span>
<span class="line"><span></span></span>
<span class="line"><span>root@k8s-master01[18:18:16]:~$ grubby --default-kernel</span></span>
<span class="line"><span>/boot/vmlinuz-6.6.11-1.el7.elrepo.x86_64</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#é‡å¯</span></span>
<span class="line"><span>reboot</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-6ã€æ‰€æœ‰èŠ‚ç‚¹å®‰è£…ipvsadm" tabindex="-1"><a class="header-anchor" href="#_3-6ã€æ‰€æœ‰èŠ‚ç‚¹å®‰è£…ipvsadm"><span>3.6ã€æ‰€æœ‰èŠ‚ç‚¹å®‰è£…ipvsadm</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>yum install ipvsadm ipset sysstat conntrack libseccomp -y </span></span>
<span class="line"><span> </span></span>
<span class="line"><span> </span></span>
<span class="line"><span>#æ‰€æœ‰èŠ‚ç‚¹é…ç½®ipvsæ¨¡å—ï¼Œåœ¨å†…æ ¸4.19+ç‰ˆæœ¬nf_conntrack_ipv4å·²ç»æ”¹ä¸ºnf_conntrackï¼Œ 4.18ä»¥ä¸‹ä½¿ç”¨nf_conntrack_ipv4å³å¯ï¼š </span></span>
<span class="line"><span> </span></span>
<span class="line"><span>modprobe -- ip_vs </span></span>
<span class="line"><span>modprobe -- ip_vs_rr </span></span>
<span class="line"><span>modprobe -- ip_vs_wrr </span></span>
<span class="line"><span>modprobe -- ip_vs_sh </span></span>
<span class="line"><span>modprobe -- nf_conntrack </span></span>
<span class="line"><span></span></span>
<span class="line"><span> </span></span>
<span class="line"><span>#åˆ›å»º /etc/modules-load.d/ipvs.conf å¹¶åŠ å…¥ä»¥ä¸‹å†…å®¹ï¼š </span></span>
<span class="line"><span>cat &gt;/etc/modules-load.d/ipvs.conf &lt;&lt;EOF </span></span>
<span class="line"><span>ip_vs </span></span>
<span class="line"><span>ip_vs_lc </span></span>
<span class="line"><span>ip_vs_wlc </span></span>
<span class="line"><span>ip_vs_rr </span></span>
<span class="line"><span>ip_vs_wrr </span></span>
<span class="line"><span>ip_vs_lblc </span></span>
<span class="line"><span>ip_vs_lblcr </span></span>
<span class="line"><span>ip_vs_dh </span></span>
<span class="line"><span>ip_vs_sh </span></span>
<span class="line"><span>ip_vs_fo </span></span>
<span class="line"><span>ip_vs_nq </span></span>
<span class="line"><span>ip_vs_sed </span></span>
<span class="line"><span>ip_vs_ftp </span></span>
<span class="line"><span>ip_vs_sh </span></span>
<span class="line"><span>nf_conntrack </span></span>
<span class="line"><span>ip_tables </span></span>
<span class="line"><span>ip_set </span></span>
<span class="line"><span>xt_set </span></span>
<span class="line"><span>ipt_set </span></span>
<span class="line"><span>ipt_rpfilter </span></span>
<span class="line"><span>ipt_REJECT </span></span>
<span class="line"><span>ipip </span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#è®¾ç½®ä¸ºå¼€æœºå¯åŠ¨</span></span>
<span class="line"><span>systemctl enable --now systemd-modules-load.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-7ã€k8så†…æ ¸ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_3-7ã€k8så†…æ ¸ä¼˜åŒ–"><span>3.7ã€k8så†…æ ¸ä¼˜åŒ–</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#å¼€å¯ä¸€äº›k8sé›†ç¾¤ä¸­å¿…é¡»çš„å†…æ ¸å‚æ•°ï¼Œæ‰€æœ‰èŠ‚ç‚¹é…ç½®k8så†…æ ¸ï¼š</span></span>
<span class="line"><span>cat &lt;&lt;EOF &gt; /etc/sysctl.d/k8s.conf</span></span>
<span class="line"><span>net.ipv4.ip_forward = 1</span></span>
<span class="line"><span>net.bridge.bridge-nf-call-iptables = 1</span></span>
<span class="line"><span>net.bridge.bridge-nf-call-ip6tables = 1</span></span>
<span class="line"><span>fs.may_detach_mounts = 1</span></span>
<span class="line"><span>vm.overcommit_memory=1</span></span>
<span class="line"><span>vm.panic_on_oom=0</span></span>
<span class="line"><span>fs.inotify.max_user_watches=89100</span></span>
<span class="line"><span>fs.file-max=52706963</span></span>
<span class="line"><span>fs.nr_open=52706963</span></span>
<span class="line"><span>net.netfilter.nf_conntrack_max=2310720</span></span>
<span class="line"><span></span></span>
<span class="line"><span>net.ipv4.tcp_keepalive_time = 600</span></span>
<span class="line"><span>net.ipv4.tcp_keepalive_probes = 3</span></span>
<span class="line"><span>net.ipv4.tcp_keepalive_intvl =15</span></span>
<span class="line"><span>net.ipv4.tcp_max_tw_buckets = 36000</span></span>
<span class="line"><span>net.ipv4.tcp_tw_reuse = 1</span></span>
<span class="line"><span>net.ipv4.tcp_max_orphans = 327680</span></span>
<span class="line"><span>net.ipv4.tcp_orphan_retries = 3</span></span>
<span class="line"><span>net.ipv4.tcp_syncookies = 1</span></span>
<span class="line"><span>net.ipv4.tcp_max_syn_backlog = 16384</span></span>
<span class="line"><span>net.ipv4.ip_conntrack_max = 65536</span></span>
<span class="line"><span>net.ipv4.tcp_max_syn_backlog = 16384</span></span>
<span class="line"><span>net.ipv4.tcp_timestamps = 0</span></span>
<span class="line"><span>net.core.somaxconn = 16384</span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span>sysctl --system</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#æ‰€æœ‰èŠ‚ç‚¹é…ç½®å®Œå†…æ ¸åï¼Œé‡å¯æœåŠ¡å™¨ï¼Œä¿è¯é‡å¯åå†…æ ¸ä¾æ—§åŠ è½½</span></span>
<span class="line"><span></span></span>
<span class="line"><span>reboot</span></span>
<span class="line"><span>lsmod | grep --color=auto -e ip_vs -e nf_conntrack</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#é‡å¯åç»“æœå¦‚ä¸‹ä»£è¡¨æ­£å¸¸ï¼š</span></span>
<span class="line"><span>root@k8s-master01[17:19:15]:~$ lsmod | grep --color=auto -e ip_vs -e nf_conntrack </span></span>
<span class="line"><span>ip_vs_ftp              16384  0  </span></span>
<span class="line"><span>nf_nat                 32768  1 ip_vs_ftp </span></span>
<span class="line"><span>ip_vs_sed              16384  0  </span></span>
<span class="line"><span>ip_vs_nq               16384  0  </span></span>
<span class="line"><span>ip_vs_fo               16384  0  </span></span>
<span class="line"><span>ip_vs_sh               16384  0  </span></span>
<span class="line"><span>ip_vs_dh               16384  0  </span></span>
<span class="line"><span>ip_vs_lblcr            16384  0  </span></span>
<span class="line"><span>ip_vs_lblc             16384  0  </span></span>
<span class="line"><span>ip_vs_wrr              16384  0  </span></span>
<span class="line"><span>ip_vs_rr               16384  0  </span></span>
<span class="line"><span>ip_vs_wlc              16384  0  </span></span>
<span class="line"><span>ip_vs_lc               16384  0  </span></span>
<span class="line"><span>ip_vs                 151552  24 ip_vs_wlc,ip_vs_rr,ip_vs_dh,ip_vs_lblcr,ip_vs_sh,ip_vs_fo,ip_vs_nq,ip_vs_lblc,ip_vs_wrr,ip_vs_lc,ip_vs_sed,ip_vs_ftp </span></span>
<span class="line"><span>nf_conntrack          143360  2 nf_nat,ip_vs </span></span>
<span class="line"><span>nf_defrag_ipv6         20480  1 nf_conntrack </span></span>
<span class="line"><span>nf_defrag_ipv4         16384  1 nf_conntrack </span></span>
<span class="line"><span>libcrc32c              16384  4 nf_conntrack,nf_nat,xfs,ip_vs</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-8ã€åŸºæœ¬ç»„ä»¶å®‰è£…" tabindex="-1"><a class="header-anchor" href="#_3-8ã€åŸºæœ¬ç»„ä»¶å®‰è£…"><span>3.8ã€åŸºæœ¬ç»„ä»¶å®‰è£…</span></a></h3><h4 id="_3-8-1ã€æ‰€æœ‰èŠ‚ç‚¹å®‰è£…-docker-ce-20-10" tabindex="-1"><a class="header-anchor" href="#_3-8-1ã€æ‰€æœ‰èŠ‚ç‚¹å®‰è£…-docker-ce-20-10"><span>3.8.1ã€æ‰€æœ‰èŠ‚ç‚¹å®‰è£… docker-ce 20.10</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>yum install -y docker-ce-20.10.6-* docker-ce-cli-20.10.6-*.x86_64</span></span>
<span class="line"><span>rm -f /etc/docker/* </span></span>
<span class="line"><span>sudo mkdir -p /etc/docker </span></span>
<span class="line"><span>sudo tee /etc/docker/daemon.json &lt;&lt;-&#39;EOF&#39; </span></span>
<span class="line"><span>{ </span></span>
<span class="line"><span>  &quot;registry-mirrors&quot;: [&quot;https://ajvcw8qn.mirror.aliyuncs.com&quot;],</span></span>
<span class="line"><span>  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;] </span></span>
<span class="line"><span>} </span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span>sudo systemctl daemon-reload </span></span>
<span class="line"><span>sudo systemctl restart docker </span></span>
<span class="line"><span>systemctl enable --now  docker.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-8-2ã€æ‰€æœ‰æœºå™¨å®‰è£…k8sç»„ä»¶kubeadm" tabindex="-1"><a class="header-anchor" href="#_3-8-2ã€æ‰€æœ‰æœºå™¨å®‰è£…k8sç»„ä»¶kubeadm"><span>3.8.2ã€æ‰€æœ‰æœºå™¨å®‰è£…k8sç»„ä»¶kubeadm</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>yum list kubeadm.x86_64 --showduplicates | sort -r</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#æ‰€æœ‰èŠ‚ç‚¹å®‰è£…æœ€æ–°ç‰ˆæœ¬kubeadmï¼š </span></span>
<span class="line"><span>yum install kubeadm-1.21* kubelet-1.21* kubectl-1.21* -y</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#é»˜è®¤é…ç½®çš„pauseé•œåƒä½¿ç”¨gcr.ioä»“åº“ï¼Œå›½å†…å¯èƒ½æ— æ³•è®¿é—®ï¼Œæ‰€ä»¥è¿™é‡Œé…ç½®Kubeletä½¿ç”¨é˜¿é‡Œäº‘çš„pauseé•œåƒ</span></span>
<span class="line"><span>cat &gt;/etc/sysconfig/kubelet&lt;&lt;EOF</span></span>
<span class="line"><span>KUBELET_EXTRA_ARGS=&quot;--cgroup-driver=systemd --pod-infra-container-image=registry.cn-hangzhou.aliyuncs.com/google_containers/pause-amd64:3.2&quot;</span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#è®¾ç½®å¼€æœºå¯åŠ¨</span></span>
<span class="line"><span>systemctl daemon-reload</span></span>
<span class="line"><span>systemctl enable --now kubelet</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-8-3ã€å®‰è£…é«˜å¯ç”¨ç»„ä»¶-masterç›¸å…³æœåŠ¡å™¨æ‰§è¡Œ" tabindex="-1"><a class="header-anchor" href="#_3-8-3ã€å®‰è£…é«˜å¯ç”¨ç»„ä»¶-masterç›¸å…³æœåŠ¡å™¨æ‰§è¡Œ"><span>3.8.3ã€å®‰è£…é«˜å¯ç”¨ç»„ä»¶[masterç›¸å…³æœåŠ¡å™¨æ‰§è¡Œ]</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#æ‰€æœ‰MasterèŠ‚ç‚¹é€šè¿‡yumå®‰è£…HAProxyå’ŒKeepAlivedï¼š</span></span>
<span class="line"><span>root@k8s-master01[17:44:47]:~$  yum install keepalived haproxy -y</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#é…ç½®HAProxyï¼š</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#æ‰€æœ‰MasterèŠ‚ç‚¹é…ç½®HAProxyï¼ˆè¯¦ç»†é…ç½®å‚è€ƒHAProxyæ–‡æ¡£ï¼Œæ‰€æœ‰MasterèŠ‚ç‚¹çš„HAProxyé…ç½®ç›¸åŒï¼‰ï¼š</span></span>
<span class="line"><span></span></span>
<span class="line"><span>mkdir /etc/haproxy</span></span>
<span class="line"><span>cat &gt;/etc/haproxy/haproxy.cfg&lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span>global</span></span>
<span class="line"><span> maxconn 2000</span></span>
<span class="line"><span> ulimit-n 16384</span></span>
<span class="line"><span> log 127.0.0.1 local0 err</span></span>
<span class="line"><span> stats timeout 30s</span></span>
<span class="line"><span></span></span>
<span class="line"><span>defaults</span></span>
<span class="line"><span> log global</span></span>
<span class="line"><span> mode http</span></span>
<span class="line"><span> option httplog</span></span>
<span class="line"><span> timeout connect 5000</span></span>
<span class="line"><span> timeout client 50000</span></span>
<span class="line"><span> timeout server 50000</span></span>
<span class="line"><span> timeout http-request 15s</span></span>
<span class="line"><span> timeout http-keep-alive 15s</span></span>
<span class="line"><span></span></span>
<span class="line"><span>frontend monitor-in</span></span>
<span class="line"><span> bind *:33305</span></span>
<span class="line"><span> mode http</span></span>
<span class="line"><span> option httplog</span></span>
<span class="line"><span> monitor-uri /monitor</span></span>
<span class="line"><span></span></span>
<span class="line"><span>frontend k8s-master</span></span>
<span class="line"><span> bind 0.0.0.0:16443</span></span>
<span class="line"><span> bind 127.0.0.1:16443</span></span>
<span class="line"><span> mode tcp</span></span>
<span class="line"><span> option tcplog</span></span>
<span class="line"><span> tcp-request inspect-delay 5s</span></span>
<span class="line"><span> default_backend k8s-master</span></span>
<span class="line"><span></span></span>
<span class="line"><span>backend k8s-master</span></span>
<span class="line"><span> mode tcp</span></span>
<span class="line"><span> option tcplog</span></span>
<span class="line"><span> option tcp-check</span></span>
<span class="line"><span> balance roundrobin</span></span>
<span class="line"><span> default-server inter 10s downinter 5s rise 2 fall 2 slowstart 60s maxconn 250 maxqueue 256 weight 100</span></span>
<span class="line"><span> server k8s-master01  192.168.3.31:6443 check</span></span>
<span class="line"><span> server k8s-master02  192.168.3.32:6443 check</span></span>
<span class="line"><span> server k8s-master03  192.168.3.33:6443 check</span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#æ‰€æœ‰MasterèŠ‚ç‚¹é…ç½®KeepAlivedï¼Œé…ç½®ä¸ä¸€æ ·ï¼Œæ³¨æ„åŒºåˆ†</span></span>
<span class="line"><span>#[root@k8s-master01 pki]# vim /etc/keepalived/keepalived.conf ï¼Œæ³¨æ„æ¯ä¸ªèŠ‚ç‚¹çš„IPå’Œç½‘å¡ï¼ˆinterfaceå‚æ•°ï¼‰</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#æ³¨æ„ä¿®æ”¹é…ç½®ï¼Œä¸‹é¢IPæ›¿æ¢ä¸ºmasterçš„IPåœ°å€ï¼š</span></span>
<span class="line"><span>server k8s-master01  192.168.3.31:6443 check</span></span>
<span class="line"><span>server k8s-master02  192.168.3.32:6443 check</span></span>
<span class="line"><span>server k8s-master03  192.168.3.33:6443 check</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#é…ç½®keepalived</span></span>
<span class="line"><span>#æ‰€æœ‰MasterèŠ‚ç‚¹é…ç½®KeepAlivedï¼Œé…ç½®ä¸ä¸€æ ·ï¼Œæ³¨æ„åŒºåˆ† </span></span>
<span class="line"><span>#æ¯å°æœåŠ¡å™¨ ä¼˜å…ˆçº§å¿…é¡»ä¸åŒ priority 100 å…¶ä»–æœºå™¨è®¾ç½®ä¸º 99 98 </span></span>
<span class="line"><span>#master01 é…ç½®ï¼š</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[root@k8s-master01 pki]# mkdir -p /etc/keepalived</span></span>
<span class="line"><span>[root@k8s-master01 pki]# cat &gt;/etc/keepalived/keepalived.conf&lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span>! Configuration File for keepalived</span></span>
<span class="line"><span>global_defs {</span></span>
<span class="line"><span>   router_id LVS_DEVEL</span></span>
<span class="line"><span>script_user root</span></span>
<span class="line"><span>   enable_script_security</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>vrrp_script chk_apiserver {</span></span>
<span class="line"><span>   script &quot;/etc/keepalived/check_apiserver.sh&quot;</span></span>
<span class="line"><span>   interval 5</span></span>
<span class="line"><span>   weight -5</span></span>
<span class="line"><span>   fall 2 </span></span>
<span class="line"><span>rise 1</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>vrrp_instance VI_1 {</span></span>
<span class="line"><span>   state MASTER</span></span>
<span class="line"><span>   interface eth0</span></span>
<span class="line"><span>   mcast_src_ip 192.168.3.31</span></span>
<span class="line"><span>   virtual_router_id 51</span></span>
<span class="line"><span>   priority 100</span></span>
<span class="line"><span>   advert_int 2</span></span>
<span class="line"><span>   authentication {</span></span>
<span class="line"><span>       auth_type PASS</span></span>
<span class="line"><span>       auth_pass K8SHA_KA_AUTH</span></span>
<span class="line"><span>   }</span></span>
<span class="line"><span>   virtual_ipaddress {</span></span>
<span class="line"><span>       192.168.3.100</span></span>
<span class="line"><span>   }</span></span>
<span class="line"><span>   track_script {</span></span>
<span class="line"><span>      chk_apiserver</span></span>
<span class="line"><span>   }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#Master02 é…ç½®ï¼š</span></span>
<span class="line"><span>[root@k8s-master02 pki]# cat &gt;/etc/keepalived/keepalived.conf&lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span>! Configuration File for keepalived</span></span>
<span class="line"><span>global_defs {</span></span>
<span class="line"><span>   router_id LVS_DEVEL</span></span>
<span class="line"><span>script_user root</span></span>
<span class="line"><span>   enable_script_security</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>vrrp_script chk_apiserver {</span></span>
<span class="line"><span>   script &quot;/etc/keepalived/check_apiserver.sh&quot;</span></span>
<span class="line"><span>  interval 5</span></span>
<span class="line"><span>   weight -5</span></span>
<span class="line"><span>   fall 2 </span></span>
<span class="line"><span>rise 1</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>vrrp_instance VI_1 {</span></span>
<span class="line"><span>   state BACKUP</span></span>
<span class="line"><span>   interface eth0</span></span>
<span class="line"><span>   mcast_src_ip 192.168.3.32</span></span>
<span class="line"><span>   virtual_router_id 51</span></span>
<span class="line"><span>   priority 99</span></span>
<span class="line"><span>   advert_int 2</span></span>
<span class="line"><span>   authentication {</span></span>
<span class="line"><span>       auth_type PASS</span></span>
<span class="line"><span>       auth_pass K8SHA_KA_AUTH</span></span>
<span class="line"><span>   }</span></span>
<span class="line"><span>   virtual_ipaddress {</span></span>
<span class="line"><span>       192.168.3.100</span></span>
<span class="line"><span>   }</span></span>
<span class="line"><span>   track_script {</span></span>
<span class="line"><span>      chk_apiserver</span></span>
<span class="line"><span>   }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#Master03 é…ç½®ï¼š</span></span>
<span class="line"><span>[root@k8s-master03 pki]# cat &gt;/etc/keepalived/keepalived.conf&lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span>! Configuration File for keepalived</span></span>
<span class="line"><span>global_defs {</span></span>
<span class="line"><span>   router_id LVS_DEVEL</span></span>
<span class="line"><span>script_user root</span></span>
<span class="line"><span>   enable_script_security</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>vrrp_script chk_apiserver {</span></span>
<span class="line"><span>   script &quot;/etc/keepalived/check_apiserver.sh&quot;</span></span>
<span class="line"><span> interval 5</span></span>
<span class="line"><span>   weight -5</span></span>
<span class="line"><span>   fall 2 </span></span>
<span class="line"><span>rise 1</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>vrrp_instance VI_1 {</span></span>
<span class="line"><span>   state BACKUP</span></span>
<span class="line"><span>   interface eth0</span></span>
<span class="line"><span>   mcast_src_ip 192.168.3.33</span></span>
<span class="line"><span>   virtual_router_id 51</span></span>
<span class="line"><span>   priority 98</span></span>
<span class="line"><span>   advert_int 2</span></span>
<span class="line"><span>   authentication {</span></span>
<span class="line"><span>       auth_type PASS</span></span>
<span class="line"><span>       auth_pass K8SHA_KA_AUTH</span></span>
<span class="line"><span>   }</span></span>
<span class="line"><span>   virtual_ipaddress {</span></span>
<span class="line"><span>       192.168.3.100</span></span>
<span class="line"><span>   }</span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#å¿«æ·åŠæ³•[å˜é‡è·å–æœ¬æœºIP]ï¼š</span></span>
<span class="line"><span>host=$(hostname -i)</span></span>
<span class="line"><span>cat &gt;/etc/keepalived/keepalived.conf&lt;&lt;EOF </span></span>
<span class="line"><span>! Configuration File for keepalived </span></span>
<span class="line"><span>global_defs { </span></span>
<span class="line"><span>   router_id LVS_DEVEL </span></span>
<span class="line"><span>script_user root </span></span>
<span class="line"><span>   enable_script_security </span></span>
<span class="line"><span>} </span></span>
<span class="line"><span>vrrp_script chk_apiserver { </span></span>
<span class="line"><span>   script &quot;/etc/keepalived/check_apiserver.sh&quot; </span></span>
<span class="line"><span>   interval 5 </span></span>
<span class="line"><span>   weight -5 </span></span>
<span class="line"><span>   fall 2  </span></span>
<span class="line"><span>rise 1 </span></span>
<span class="line"><span>} </span></span>
<span class="line"><span>vrrp_instance VI_1 { </span></span>
<span class="line"><span>   state MASTER </span></span>
<span class="line"><span>   interface eth0 </span></span>
<span class="line"><span>   mcast_src_ip $(hostname -i) </span></span>
<span class="line"><span>   virtual_router_id 51 </span></span>
<span class="line"><span>   priority 101 </span></span>
<span class="line"><span>   advert_int 2 </span></span>
<span class="line"><span>   authentication { </span></span>
<span class="line"><span>       auth_type PASS </span></span>
<span class="line"><span>       auth_pass K8SHA_KA_AUTH </span></span>
<span class="line"><span>   } </span></span>
<span class="line"><span>   virtual_ipaddress { </span></span>
<span class="line"><span>       192.168.3.100 </span></span>
<span class="line"><span>   } </span></span>
<span class="line"><span>   track_script { </span></span>
<span class="line"><span>      chk_apiserver </span></span>
<span class="line"><span>   } </span></span>
<span class="line"><span>} </span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-8-4ã€å¥åº·æ£€æŸ¥é…ç½®-æ‰€æœ‰masteræœåŠ¡å™¨æ·»åŠ å¥åº·æ£€æŸ¥è„šæœ¬" tabindex="-1"><a class="header-anchor" href="#_3-8-4ã€å¥åº·æ£€æŸ¥é…ç½®-æ‰€æœ‰masteræœåŠ¡å™¨æ·»åŠ å¥åº·æ£€æŸ¥è„šæœ¬"><span>3.8.4ã€å¥åº·æ£€æŸ¥é…ç½®[æ‰€æœ‰masteræœåŠ¡å™¨æ·»åŠ å¥åº·æ£€æŸ¥è„šæœ¬]</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat &gt; /etc/keepalived/check_apiserver.sh &lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span>#!/bin/bash</span></span>
<span class="line"><span>err=0</span></span>
<span class="line"><span>for k in $(seq 1 3)</span></span>
<span class="line"><span>do</span></span>
<span class="line"><span>   check_code=$(pgrep haproxy)</span></span>
<span class="line"><span>   if [[ $check_code == &quot;&quot; ]]; then</span></span>
<span class="line"><span>       err=$(expr $err + 1)</span></span>
<span class="line"><span>       sleep 1</span></span>
<span class="line"><span>       continue</span></span>
<span class="line"><span>   else</span></span>
<span class="line"><span>       err=0</span></span>
<span class="line"><span>       break</span></span>
<span class="line"><span>   fi</span></span>
<span class="line"><span>done</span></span>
<span class="line"><span></span></span>
<span class="line"><span>if [[ $err != &quot;0&quot; ]]; then</span></span>
<span class="line"><span>   echo &quot;systemctl stop keepalived&quot;</span></span>
<span class="line"><span>   /usr/bin/systemctl stop keepalived</span></span>
<span class="line"><span>   exit 1</span></span>
<span class="line"><span>else</span></span>
<span class="line"><span>   exit 0</span></span>
<span class="line"><span>fi</span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span></span></span>
<span class="line"><span>chmod +x /etc/keepalived/check_apiserver.sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-8-5ã€å¯åŠ¨haproxyå’Œkeepalived-æ¯å°masterå¯ç”¨" tabindex="-1"><a class="header-anchor" href="#_3-8-5ã€å¯åŠ¨haproxyå’Œkeepalived-æ¯å°masterå¯ç”¨"><span>3.8.5ã€å¯åŠ¨haproxyå’Œkeepalived[æ¯å°masterå¯ç”¨]</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl daemon-reload</span></span>
<span class="line"><span>systemctl enable --now haproxy</span></span>
<span class="line"><span>systemctl enable --now keepalived</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-8-6ã€æµ‹è¯•haproxyä¸keepalivedæ˜¯å¦æ­£å¸¸" tabindex="-1"><a class="header-anchor" href="#_3-8-6ã€æµ‹è¯•haproxyä¸keepalivedæ˜¯å¦æ­£å¸¸"><span>3.8.6ã€æµ‹è¯•haproxyä¸keepalivedæ˜¯å¦æ­£å¸¸</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>é‡è¦ï¼šå¦‚æœå®‰è£…äº†keepalivedå’Œhaproxyï¼Œéœ€è¦æµ‹è¯•keepalivedæ˜¯å¦æ˜¯æ­£å¸¸çš„</span></span>
<span class="line"><span>æ‰€ä»¥è¿™é‡Œéœ€è¦æµ‹è¯•VIPæ˜¯å¦é€š</span></span>
<span class="line"><span>root@k8s-master01[18:19:31]:~$ ping 192.168.3.100 -c 4</span></span>
<span class="line"><span>PING 192.168.3.100 (192.168.3.100) 56(84) bytes of data.</span></span>
<span class="line"><span>64 bytes from 192.168.3.100: icmp_seq=1 ttl=64 time=0.421 ms</span></span>
<span class="line"><span>64 bytes from 192.168.3.100: icmp_seq=2 ttl=64 time=0.289 ms</span></span>
<span class="line"><span>64 bytes from 192.168.3.100: icmp_seq=3 ttl=64 time=0.321 ms</span></span>
<span class="line"><span>64 bytes from 192.168.3.100: icmp_seq=4 ttl=64 time=0.232 ms</span></span>
<span class="line"><span></span></span>
<span class="line"><span>--- 192.168.3.100 ping statistics ---</span></span>
<span class="line"><span>4 packets transmitted, 4 received, 0% packet loss, time 3080ms</span></span>
<span class="line"><span>rtt min/avg/max/mdev = 0.232/0.315/0.421/0.071 ms</span></span>
<span class="line"><span>You have new mail in /var/spool/mail/root</span></span>
<span class="line"><span></span></span>
<span class="line"><span>root@k8s-master02[17:52:24]:~$ ping 192.168.3.100 -c 4</span></span>
<span class="line"><span>PING 192.168.3.100 (192.168.3.100) 56(84) bytes of data.</span></span>
<span class="line"><span>64 bytes from 192.168.3.100: icmp_seq=1 ttl=64 time=0.458 ms</span></span>
<span class="line"><span>64 bytes from 192.168.3.100: icmp_seq=2 ttl=64 time=0.344 ms</span></span>
<span class="line"><span>64 bytes from 192.168.3.100: icmp_seq=3 ttl=64 time=0.253 ms</span></span>
<span class="line"><span>64 bytes from 192.168.3.100: icmp_seq=4 ttl=64 time=0.373 ms</span></span>
<span class="line"><span></span></span>
<span class="line"><span>--- 192.168.3.100 ping statistics ---</span></span>
<span class="line"><span>4 packets transmitted, 4 received, 0% packet loss, time 3093ms</span></span>
<span class="line"><span>rtt min/avg/max/mdev = 0.253/0.357/0.458/0.073 ms</span></span>
<span class="line"><span>You have new mail in /var/spool/mail/root</span></span>
<span class="line"><span></span></span>
<span class="line"><span>root@k8s-master03[17:52:24]:~$ ping 192.168.3.100 -c 4</span></span>
<span class="line"><span>PING 192.168.3.100 (192.168.3.100) 56(84) bytes of data.</span></span>
<span class="line"><span>64 bytes from 192.168.3.100: icmp_seq=1 ttl=64 time=0.079 ms</span></span>
<span class="line"><span>64 bytes from 192.168.3.100: icmp_seq=2 ttl=64 time=0.054 ms</span></span>
<span class="line"><span>64 bytes from 192.168.3.100: icmp_seq=3 ttl=64 time=0.058 ms</span></span>
<span class="line"><span>64 bytes from 192.168.3.100: icmp_seq=4 ttl=64 time=0.055 ms</span></span>
<span class="line"><span></span></span>
<span class="line"><span>--- 192.168.3.100 ping statistics ---</span></span>
<span class="line"><span>4 packets transmitted, 4 received, 0% packet loss, time 3094ms</span></span>
<span class="line"><span>rtt min/avg/max/mdev = 0.054/0.061/0.079/0.012 ms</span></span>
<span class="line"><span>You have new mail in /var/spool/mail/root</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ³¨æ„ï¼š å¦‚æœpingä¸é€šä¸”telnetæ²¡æœ‰å‡ºç° ] ï¼Œåˆ™è®¤ä¸ºVIPä¸å¯ä»¥ï¼Œä¸å¯åœ¨ç»§ç»­å¾€ä¸‹æ‰§è¡Œï¼Œéœ€è¦æ’æŸ¥keepalivedçš„é—®é¢˜ï¼Œæ¯”å¦‚é˜²ç«å¢™å’Œselinuxï¼Œhaproxyå’Œkeepalivedçš„çŠ¶æ€ï¼Œç›‘å¬ç«¯å£ç­‰</span></span>
<span class="line"><span>æ‰€æœ‰èŠ‚ç‚¹æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€å¿…é¡»ä¸ºdisableå’Œinactiveï¼šsystemctl status firewalld</span></span>
<span class="line"><span>æ‰€æœ‰èŠ‚ç‚¹æŸ¥çœ‹selinuxçŠ¶æ€ï¼Œå¿…é¡»ä¸ºdisableï¼šgetenforce</span></span>
<span class="line"><span>masterèŠ‚ç‚¹æŸ¥çœ‹haproxyå’ŒkeepalivedçŠ¶æ€ï¼šsystemctl status keepalived haproxy</span></span>
<span class="line"><span>masterèŠ‚ç‚¹æŸ¥çœ‹ç›‘å¬ç«¯å£ï¼šnetstat -lntp</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ’æŸ¥æ€è·¯ï¼š</span></span>
<span class="line"><span>keepalivedçš„é—®é¢˜ï¼Œæ¯”å¦‚é˜²ç«å¢™å’Œselinuxï¼Œhaproxyå’Œkeepalivedçš„çŠ¶æ€ï¼Œç›‘å¬ç«¯å£ç­‰</span></span>
<span class="line"><span>æ‰€æœ‰èŠ‚ç‚¹æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€å¿…é¡»ä¸ºdisableå’Œinactiveï¼šsystemctl status firewalld</span></span>
<span class="line"><span>æ‰€æœ‰èŠ‚ç‚¹æŸ¥çœ‹selinuxçŠ¶æ€ï¼Œå¿…é¡»ä¸ºdisableï¼šgetenforce</span></span>
<span class="line"><span>masterèŠ‚ç‚¹æŸ¥çœ‹haproxyå’ŒkeepalivedçŠ¶æ€ï¼šsystemctl status keepalived haproxy</span></span>
<span class="line"><span>masterèŠ‚ç‚¹æŸ¥çœ‹ç›‘å¬ç«¯å£ï¼šnetstat -lntp</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4ã€kubernetesé›†ç¾¤åˆå§‹åŒ–" tabindex="-1"><a class="header-anchor" href="#_4ã€kubernetesé›†ç¾¤åˆå§‹åŒ–"><span>4ã€kubernetesé›†ç¾¤åˆå§‹åŒ–</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>Master01èŠ‚ç‚¹åˆ›å»º kubeadm-config.yaml é…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š</span></span>
<span class="line"><span>Master01ï¼šï¼ˆ# æ³¨æ„ï¼Œå¦‚æœä¸æ˜¯é«˜å¯ç”¨é›†ç¾¤ï¼Œ192.168.3.100:16443æ”¹ä¸ºmaster01çš„åœ°å€ï¼Œ16443æ”¹ä¸ºapiserverçš„ç«¯å£ï¼Œé»˜è®¤æ˜¯6443ï¼Œæ³¨æ„æ›´æ”¹v1.18.5è‡ªå·±æœåŠ¡å™¨kubeadmçš„ç‰ˆæœ¬ï¼škubeadm versionï¼‰</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#æŸ¥çœ‹åŠæ³•ï¼š</span></span>
<span class="line"><span>kubectl version</span></span>
<span class="line"><span>root@k8s-master01[18:25:48]:~$ kubectl version </span></span>
<span class="line"><span>Client Version: version.Info{Major:&quot;1&quot;, Minor:&quot;21&quot;, GitVersion:&quot;v1.21.0&quot;, GitCommit:&quot;cb303e613a121a29364f75cc67d3d580833a7479&quot;, GitTreeState:&quot;clean&quot;, BuildDate:&quot;2021-04-08T16:31:21Z&quot;, GoVersion:&quot;go1.16.1&quot;, Compiler:&quot;gc&quot;, Platform:&quot;linux/amd64&quot;} </span></span>
<span class="line"><span></span></span>
<span class="line"><span>å› ä¸ºå®‰è£…çš„ç‰ˆæœ¬æ˜¯ GitVersion:&quot;v1.21.0&quot;</span></span>
<span class="line"><span>ä¸‹é¢çš„yamlæ–‡ä»¶ä¸­çš„å¯¹åº”ç‰ˆæœ¬éœ€è¦æ”¹ä¸º  v1.21.0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>root@k8s-master01[18:28:03]:~$ cat kubeadm-config.yaml </span></span>
<span class="line"><span>apiVersion: kubeadm.k8s.io/v1beta2</span></span>
<span class="line"><span>bootstrapTokens:</span></span>
<span class="line"><span>- groups:</span></span>
<span class="line"><span>  - system:bootstrappers:kubeadm:default-node-token</span></span>
<span class="line"><span>  token: 7t2weq.bjbawausm0jaxury</span></span>
<span class="line"><span>  ttl: 24h0m0s</span></span>
<span class="line"><span>  usages:</span></span>
<span class="line"><span>  - signing</span></span>
<span class="line"><span>  - authentication</span></span>
<span class="line"><span>kind: InitConfiguration</span></span>
<span class="line"><span>localAPIEndpoint:</span></span>
<span class="line"><span>  advertiseAddress: 192.168.3.31</span></span>
<span class="line"><span>  bindPort: 6443</span></span>
<span class="line"><span>nodeRegistration:</span></span>
<span class="line"><span>  criSocket: /var/run/dockershim.sock</span></span>
<span class="line"><span>  name: k8s-master01</span></span>
<span class="line"><span>  taints:</span></span>
<span class="line"><span>  - effect: NoSchedule</span></span>
<span class="line"><span>    key: node-role.kubernetes.io/master</span></span>
<span class="line"><span>---</span></span>
<span class="line"><span>apiServer:</span></span>
<span class="line"><span>  certSANs:</span></span>
<span class="line"><span>  - 192.168.3.100</span></span>
<span class="line"><span>  timeoutForControlPlane: 4m0s</span></span>
<span class="line"><span>apiVersion: kubeadm.k8s.io/v1beta2</span></span>
<span class="line"><span>certificatesDir: /etc/kubernetes/pki</span></span>
<span class="line"><span>clusterName: kubernetes</span></span>
<span class="line"><span>controlPlaneEndpoint: 192.168.3.100:16443</span></span>
<span class="line"><span>controllerManager: {}</span></span>
<span class="line"><span>dns:</span></span>
<span class="line"><span>  type: CoreDNS</span></span>
<span class="line"><span>etcd:</span></span>
<span class="line"><span>  local:</span></span>
<span class="line"><span>    dataDir: /var/lib/etcd</span></span>
<span class="line"><span>imageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers</span></span>
<span class="line"><span>kind: ClusterConfiguration</span></span>
<span class="line"><span>kubernetesVersion: v1.21.0</span></span>
<span class="line"><span>networking:</span></span>
<span class="line"><span>  dnsDomain: cluster.local</span></span>
<span class="line"><span>  podSubnet: 10.244.0.0/16</span></span>
<span class="line"><span>  serviceSubnet: 10.96.0.0/12</span></span>
<span class="line"><span>scheduler: {}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#æ›´æ–°kubeadmæ–‡ä»¶: kubeadm-config.yaml</span></span>
<span class="line"><span></span></span>
<span class="line"><span>kubeadm config migrate --old-config kubeadm-config.yaml --new-config new.yaml</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#å°†new.yamlæ–‡ä»¶å¤åˆ¶åˆ°å…¶ä»–masterèŠ‚ç‚¹ï¼Œä¹‹åæ‰€æœ‰MasterèŠ‚ç‚¹æå‰ä¸‹è½½é•œåƒï¼Œå¯ä»¥èŠ‚çœåˆå§‹åŒ–æ—¶é—´ï¼š</span></span>
<span class="line"><span>for i in k8s-master02 k8s-master03; do scp new.yaml $i:/root/; done</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#åœ¨å…¶ä»–masterèŠ‚ç‚¹æå‰ä¸‹è½½é•œåƒï¼Œç”¨äºè§£å†³åˆå§‹åŒ–æ—¶é—´</span></span>
<span class="line"><span>kubeadm config images pull --config /root/new.yaml</span></span>
<span class="line"><span>systemctl enable --now kubelet</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#æ‰§è¡Œkubeadm config images pull --config /root/new.yamlå¦‚æœå‡ºç°å¦‚ä¸‹æŠ¥é”™</span></span>
<span class="line"><span>[config/images] Pulled registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.4.1 </span></span>
<span class="line"><span>[config/images] Pulled registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.4.13-0 </span></span>
<span class="line"><span>failed to pull image &quot;registry.cn-hangzhou.aliyuncs.com/google_containers/coredns/coredns:v1.8.0&quot;: output: Error response from daemon: manifest for registry.cn-hangzhou.aliyuncs.com/google_containers/coredns/coredns:v1.8.0 not found: manifest unknown: manifest unknown </span></span>
<span class="line"><span>, error: exit status 1 </span></span>
<span class="line"><span>To see the stack trace of this error execute with --v=5 or higher </span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#corednså¦‚æœæ²¡æœ‰æˆåŠŸ</span></span>
<span class="line"><span>å‡ºç°ImagePullBackOffï¼š</span></span>
<span class="line"><span>coredns-57d4cbf879-gnh6j        0/1     ImagePullBackOff   0          6m </span></span>
<span class="line"><span>coredns-57d4cbf879-z79bt        0/1     ImagePullBackOff   0          6m</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#è¯·æ‰€æœ‰èŠ‚ç‚¹æ‰§è¡Œï¼Œç”¨äºä¸‹è½½é•œåƒå³å¯ï¼š</span></span>
<span class="line"><span>docker pull registry.cn-beijing.aliyuncs.com/dotbalo/coredns:1.8.0</span></span>
<span class="line"><span>docker tag registry.cn-beijing.aliyuncs.com/dotbalo/coredns:1.8.0 registry.cn-hangzhou.aliyuncs.com/google_containers/coredns/coredns:v1.8.0</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#å†æ¬¡æŸ¥çœ‹å°±ä¼šè‡ªåŠ¨æ‹‰èµ·</span></span>
<span class="line"><span>coredns-57d4cbf879-gnh6j                  1/1     Running   0          16h </span></span>
<span class="line"><span>coredns-57d4cbf879-z79bt                  1/1     Running   0          16h</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-2ã€-master01åˆå§‹åŒ–" tabindex="-1"><a class="header-anchor" href="#_4-2ã€-master01åˆå§‹åŒ–"><span>4.2ã€ master01åˆå§‹åŒ–</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#master01èŠ‚ç‚¹æ‰§è¡Œåˆå§‹åŒ–ï¼š</span></span>
<span class="line"><span>kubeadm init --config /root/new.yaml --upload-certs</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#å¦‚æœåˆå§‹åŒ–å¤±è´¥ï¼Œé‡ç½®åå†æ¬¡åˆå§‹åŒ–ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</span></span>
<span class="line"><span>kubeadm reset -f ; ipvsadm --clear ; rm -rf ~/.kube</span></span>
<span class="line"><span></span></span>
<span class="line"><span>å…³é”®æç¤ºä¿¡æ¯ï¼š</span></span>
<span class="line"><span>You should now deploy a pod network to the cluster. </span></span>
<span class="line"><span>Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at: </span></span>
<span class="line"><span>  https://kubernetes.io/docs/concepts/cluster-administration/addons/ </span></span>
<span class="line"><span> </span></span>
<span class="line"><span>You can now join any number of the control-plane node running the following command on each as root: </span></span>
<span class="line"><span> </span></span>
<span class="line"><span> [å…¶ä»–masteråŠ å…¥é›†ç¾¤]</span></span>
<span class="line"><span>  kubeadm join 192.168.3.100:16443 --token 7t2weq.bjbawausm0jaxury \ </span></span>
<span class="line"><span>        --discovery-token-ca-cert-hash sha256:aeb438bb077768d6626fbc5f2ff61a903bfea24c2eaaa3fde49bace433176384 \ </span></span>
<span class="line"><span>        --control-plane --certificate-key 530a5f56ce32e4ab69b384f41e6165327e23577f4924558b36efb6bb08a883e5 </span></span>
<span class="line"><span> </span></span>
<span class="line"><span>Please note that the certificate-key gives access to cluster sensitive data, keep it secret! </span></span>
<span class="line"><span>As a safeguard, uploaded-certs will be deleted in two hours; If necessary, you can use </span></span>
<span class="line"><span>&quot;kubeadm init phase upload-certs --upload-certs&quot; to reload certs afterward. </span></span>
<span class="line"><span> </span></span>
<span class="line"><span>Then you can join any number of worker nodes by running the following on each as root: </span></span>
<span class="line"><span></span></span>
<span class="line"><span>[å…¶ä»–nodeåŠ å…¥é›†ç¾¤]</span></span>
<span class="line"><span>kubeadm join 192.168.3.100:16443 --token 7t2weq.bjbawausm0jaxury \ </span></span>
<span class="line"><span>        --discovery-token-ca-cert-hash sha256:aeb438bb077768d6626fbc5f2ff61a903bfea24c2eaaa3fde49bace433176384  </span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#ä¼˜åŒ–</span></span>
<span class="line"><span>mkdir -p $HOME/.kube </span></span>
<span class="line"><span>sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config </span></span>
<span class="line"><span>sudo chown $(id -u):$(id -g) $HOME/.kube/config </span></span>
<span class="line"><span>cat &lt;&lt;EOF &gt;&gt; /root/.bashrc</span></span>
<span class="line"><span>export KUBECONFIG=/etc/kubernetes/admin.conf</span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span>source /root/.bashrc</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2ã€master02-master03-åŠ å…¥masteré›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_4-2ã€master02-master03-åŠ å…¥masteré›†ç¾¤"><span>4.2ã€master02 master03 åŠ å…¥masteré›†ç¾¤</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#Tokenè¿‡æœŸåç”Ÿæˆæ–°çš„tokenï¼š</span></span>
<span class="line"><span>kubeadm token create --print-join-command</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#Masteréœ€è¦ç”Ÿæˆ-certificate-key</span></span>
<span class="line"><span>root@k8s-master01[15:36:45]:~$ kubeadm init phase upload-certs --upload-certs </span></span>
<span class="line"><span>[upload-certs] Storing the certificates in Secret &quot;kubeadm-certs&quot; in the &quot;kube-system&quot; Namespace </span></span>
<span class="line"><span>[upload-certs] Using certificate key: </span></span>
<span class="line"><span>9b5153fe13fe5a9286eb68fae35311f7357b854a2f8ad925bc7e45b16d2b886e </span></span>
<span class="line"><span></span></span>
<span class="line"><span>#å…¶ä»–masteråŠ å…¥é›†ç¾¤</span></span>
<span class="line"><span>kubeadm join 192.168.3.100:16443 --token fgtxr1.bz6dw1tci1kbj977    --discovery-token-ca-cert-hash sha256:06ebf46458a41922ff1f5b3bc49365cf3dd938f1a7e3e4a8c8049b5ec5a3aaa5 \</span></span>
<span class="line"><span>   --control-plane --certificate-key 9b5153fe13fe5a9286eb68fae35311f7357b854a2f8ad925bc7e45b16d2b886e</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3ã€worker01-worker02-worker03-åŠ å…¥masteré›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_4-3ã€worker01-worker02-worker03-åŠ å…¥masteré›†ç¾¤"><span>4.3ã€worker01 worker02 worker03 åŠ å…¥masteré›†ç¾¤</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>kubeadm join 192.168.1.160:16443 --token 7t2weq.bjbawausm0jaxury --discovery-token-ca-cert-hash sha256:aeb438bb077768d6626fbc5f2ff61a903bfea24c2eaaa3fde49bace433176384</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#è¿‡ç¨‹</span></span>
<span class="line"><span>root@k8s-work01[15:29:45]:~$ kubeadm join 192.168.3.100:16443 --token 7t2weq.bjbawausm0jaxury \ </span></span>
<span class="line"><span>&gt; --discovery-token-ca-cert-hash sha256:aeb438bb077768d6626fbc5f2ff61a903bfea24c2eaaa3fde49bace433176384 </span></span>
<span class="line"><span>[preflight] Running pre-flight checks </span></span>
<span class="line"><span>[preflight] Reading configuration from the cluster... </span></span>
<span class="line"><span>[preflight] FYI: You can look at this config file with &#39;kubectl -n kube-system get cm kubeadm-config -o yaml&#39; </span></span>
<span class="line"><span>[kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot; </span></span>
<span class="line"><span>[kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot; </span></span>
<span class="line"><span>[kubelet-start] Starting the kubelet </span></span>
<span class="line"><span>[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap... </span></span>
<span class="line"><span> </span></span>
<span class="line"><span>This node has joined the cluster: </span></span>
<span class="line"><span>* Certificate signing request was sent to apiserver and a response was received. </span></span>
<span class="line"><span>* The Kubelet was informed of the new secure connection details. </span></span>
<span class="line"><span> </span></span>
<span class="line"><span>Run &#39;kubectl get nodes&#39; on the control-plane to see this node join the cluster.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-4ã€åŠ å…¥ç»“æœé¢„è§ˆ" tabindex="-1"><a class="header-anchor" href="#_4-4ã€åŠ å…¥ç»“æœé¢„è§ˆ"><span>4.4ã€åŠ å…¥ç»“æœé¢„è§ˆ</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>root@k8s-master01[16:06:10]:~$ kubectl get nodes </span></span>
<span class="line"><span>NAME           STATUS     ROLES                  AGE     VERSION </span></span>
<span class="line"><span>k8s-master01   NotReady   control-plane,master   6m15s   v1.21.0 </span></span>
<span class="line"><span>k8s-master02   NotReady   control-plane,master   5m23s   v1.21.0 </span></span>
<span class="line"><span>k8s-master03   NotReady   control-plane,master   4m21s   v1.21.0 </span></span>
<span class="line"><span>k8s-worker01     NotReady   &lt;none&gt;                 11s     v1.21.0 </span></span>
<span class="line"><span>k8s-worker02     NotReady   &lt;none&gt;                 0s      v1.21.0</span></span>
<span class="line"><span>k8s-worker03     NotReady   &lt;none&gt;                 0s      v1.21.0</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>é‡‡ç”¨åˆå§‹åŒ–å®‰è£…æ–¹å¼ï¼Œæ‰€æœ‰çš„ç³»ç»Ÿç»„ä»¶å‡ä»¥å®¹å™¨çš„æ–¹å¼è¿è¡Œå¹¶ä¸”åœ¨kube-systemå‘½åç©ºé—´å†…ï¼Œæ­¤æ—¶å¯ä»¥æŸ¥çœ‹PodçŠ¶æ€ï¼š</span></span>
<span class="line"><span>root@k8s-master01[20:18:57]:~$ kubectl get pod -n kube-system </span></span>
<span class="line"><span>NAME                                   READY   STATUS    RESTARTS   AGE </span></span>
<span class="line"><span>coredns-57d4cbf879-8vs6c               0/1     Pending   0          75m </span></span>
<span class="line"><span>coredns-57d4cbf879-p99nc               0/1     Pending   0          75m </span></span>
<span class="line"><span>etcd-k8s-master01                      1/1     Running   0          75m </span></span>
<span class="line"><span>etcd-k8s-master02                      1/1     Running   0          4m45s </span></span>
<span class="line"><span>etcd-k8s-master03                      1/1     Running   0          4m23s </span></span>
<span class="line"><span>kube-apiserver-k8s-master01            1/1     Running   0          75m </span></span>
<span class="line"><span>kube-apiserver-k8s-master02            1/1     Running   0          4m45s </span></span>
<span class="line"><span>kube-apiserver-k8s-master03            1/1     Running   0          4m10s </span></span>
<span class="line"><span>kube-controller-manager-k8s-master01   1/1     Running   1          75m </span></span>
<span class="line"><span>kube-controller-manager-k8s-master02   1/1     Running   0          4m45s </span></span>
<span class="line"><span>kube-controller-manager-k8s-master03   1/1     Running   0          4m21s </span></span>
<span class="line"><span>kube-proxy-2zc6p                       1/1     Running   0          4m46s </span></span>
<span class="line"><span>kube-proxy-djtbn                       1/1     Running   0          3m30s </span></span>
<span class="line"><span>kube-proxy-g2ddr                       1/1     Running   0          75m </span></span>
<span class="line"><span>kube-proxy-gf7w8                       1/1     Running   0          3m34s </span></span>
<span class="line"><span>kube-proxy-mfsbz                       1/1     Running   0          3m59s </span></span>
<span class="line"><span>kube-scheduler-k8s-master01            1/1     Running   1          75m </span></span>
<span class="line"><span>kube-scheduler-k8s-master02            1/1     Running   0          4m45s </span></span>
<span class="line"><span>kube-scheduler-k8s-master03            1/1     Running   0          4m19s </span></span>
<span class="line"><span></span></span>
<span class="line"><span>#å‡ºç° coredns PendingçŠ¶æ€ï¼ŒåŸå› æ˜¯å› ä¸ºæ²¡æœ‰ç½‘ç»œ</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-5ã€master01èŠ‚ç‚¹é…ç½®ç¯å¢ƒå˜é‡-ç”¨äºè®¿é—®kubernetesé›†ç¾¤" tabindex="-1"><a class="header-anchor" href="#_4-5ã€master01èŠ‚ç‚¹é…ç½®ç¯å¢ƒå˜é‡-ç”¨äºè®¿é—®kubernetesé›†ç¾¤"><span>4.5ã€Master01èŠ‚ç‚¹é…ç½®ç¯å¢ƒå˜é‡ï¼Œç”¨äºè®¿é—®Kubernetesé›†ç¾¤ï¼š</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat &lt;&lt;EOF &gt;&gt; /root/.bashrc</span></span>
<span class="line"><span>export KUBECONFIG=/etc/kubernetes/admin.conf</span></span>
<span class="line"><span>EOF</span></span>
<span class="line"><span>source /root/.bashrc</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5ã€å®‰è£…calicoç½‘ç»œç»„ä»¶-master01æ“ä½œ" tabindex="-1"><a class="header-anchor" href="#_5ã€å®‰è£…calicoç½‘ç»œç»„ä»¶-master01æ“ä½œ"><span>5ã€å®‰è£…calicoç½‘ç»œç»„ä»¶[master01æ“ä½œ]</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#è¿è¡Œcaliconæ–‡ä»¶ï¼Œæ— éœ€é…ç½®æ”¹å˜ï¼Œç›´æ¥è¿è¡Œ</span></span>
<span class="line"><span>kubectl create -f https://docs.projectcalico.org/archive/v3.21/manifests/tigera-operator.yaml</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#ä¸å»ºè®®ç›´æ¥ä½¿ç”¨éœ€è¦ä¿®æ”¹ï¼Œç¬¦åˆkubernetesé›†ç¾¤ç¯å¢ƒæ‰è¡Œï¼Œå› æ­¤å…ˆä¸‹è½½åˆ°æœ¬åœ°</span></span>
<span class="line"><span>#kubectl create -f https://docs.projectcalico.org/archive/v3.21/manifests/custom-resources.yaml</span></span>
<span class="line"><span></span></span>
<span class="line"><span>mkdir calicodir</span></span>
<span class="line"><span>cd calicodir</span></span>
<span class="line"><span>wget https://docs.projectcalico.org/archive/v3.21/manifests/custom-resources.yaml</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#éœ€è¦ä¿®æ”¹çš„åœ°æ–¹å¦‚ä¸‹ï¼š</span></span>
<span class="line"><span>[root@master01 calicodir]# cat custom-resources.yaml </span></span>
<span class="line"><span># This section includes base Calico installation configuration.</span></span>
<span class="line"><span># For more information, see: https://docs.projectcalico.org/v3.21/reference/installation/api#operator.tigera.io/v1.Installation</span></span>
<span class="line"><span>apiVersion: operator.tigera.io/v1</span></span>
<span class="line"><span>kind: Installation</span></span>
<span class="line"><span>metadata:</span></span>
<span class="line"><span>  name: default</span></span>
<span class="line"><span>spec:</span></span>
<span class="line"><span>  # Configures Calico networking.</span></span>
<span class="line"><span>  calicoNetwork:</span></span>
<span class="line"><span>    # Note: The ipPools section cannot be modified post-install.</span></span>
<span class="line"><span>    ipPools:</span></span>
<span class="line"><span>    - blockSize: 26</span></span>
<span class="line"><span>      cidr: 10.244.0.0/16      -----&gt;è¿™ä¸ªåœ°æ–¹éœ€è¦åšä¿®æ”¹</span></span>
<span class="line"><span>      encapsulation: VXLANCrossSubnet</span></span>
<span class="line"><span>      natOutgoing: Enabled</span></span>
<span class="line"><span>      nodeSelector: all()</span></span>
<span class="line"><span></span></span>
<span class="line"><span>---</span></span>
<span class="line"><span></span></span>
<span class="line"><span># This section configures the Calico API server.</span></span>
<span class="line"><span># For more information, see: https://docs.projectcalico.org/v3.21/reference/installation/api#operator.tigera.io/v1.APIServer</span></span>
<span class="line"><span>apiVersion: operator.tigera.io/v1</span></span>
<span class="line"><span>kind: APIServer </span></span>
<span class="line"><span>metadata: </span></span>
<span class="line"><span>  name: default </span></span>
<span class="line"><span>spec: {}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#æ¥ç€å¯¹è¯¥èµ„æºæ¸…å•æ–‡ä»¶è¿›è¡Œä½¿ç”¨</span></span>
<span class="line"><span>[root@master01 calicodir]# kubectl apply -f custom-resources.yaml </span></span>
<span class="line"><span>installation.operator.tigera.io/default created</span></span>
<span class="line"><span>apiserver.operator.tigera.io/default created</span></span>
<span class="line"><span></span></span>
<span class="line"><span>##ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹</span></span>
<span class="line"><span>[root@master01 calicodir]# kubectl get ns</span></span>
<span class="line"><span>NAME              STATUS   AGE</span></span>
<span class="line"><span>calico-system     Active   48s       ##åˆ›å»ºäº†ä¸€ä¸ªå‘½åç©ºé—´</span></span>
<span class="line"><span>default           Active   71m</span></span>
<span class="line"><span>kube-node-lease   Active   71m</span></span>
<span class="line"><span>kube-public       Active   71m</span></span>
<span class="line"><span>kube-system       Active   71m</span></span>
<span class="line"><span>tigera-operator   Active   4m59s</span></span>
<span class="line"><span></span></span>
<span class="line"><span>##æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹calico-systemå‘½åç©ºé—´ä¸‹æœ‰å“ªäº›podï¼Œè¿è¡Œæ—¶é—´æ¯”è¾ƒé•¿</span></span>
<span class="line"><span></span></span>
<span class="line"><span>##å®˜æ–¹å»ºè®®ç›´æ¥ä½¿ç”¨watchå‘½ä»¤æŸ¥çœ‹ï¼Œç›´åˆ°ä»–å…¨éƒ¨è¿è¡Œä¸ºæ­¢</span></span>
<span class="line"><span>watch kubectl get pods -n calico-system</span></span>
<span class="line"><span>##æˆ‘ä»¬å‘ç°ç‰¹åˆ«æ…¢ï¼ŒåŸå› æ˜¯å› ä¸ºkubernetesçš„masterèŠ‚ç‚¹ä¸å…è®¸åšå·¥ä½œè´Ÿè½½è°ƒåº¦ï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªæ“ä½œï¼Œå–æ¶ˆæ±¡ç‚¹ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</span></span>
<span class="line"><span>kubectl taint nodes --all node-role.kubernetes.io/master-</span></span>
<span class="line"><span></span></span>
<span class="line"><span>##æ¥ç€æˆ‘ä»¬å†æ¬¡æŸ¥çœ‹ï¼Œç­‰å¾…ç›´åˆ°å®Œæˆï¼Œè¿™ä¸ªè¿‡ç¨‹å·¨æ…¢</span></span>
<span class="line"><span>watch kubectl get pods -n calico-system</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#æœ€åæŸ¥çœ‹å®¹å™¨å’ŒèŠ‚ç‚¹çŠ¶æ€:</span></span>
<span class="line"><span>root@k8s-master01[18:34:00]:~$ kubectl get pod -n kube-system</span></span>
<span class="line"><span>NAME                                   READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span>coredns-6f6b8cc4f6-dd2kf               1/1     Running   0          4h4m</span></span>
<span class="line"><span>coredns-6f6b8cc4f6-f9gw8               1/1     Running   0          4h4m</span></span>
<span class="line"><span>etcd-k8s-master01                      1/1     Running   5          4h4m</span></span>
<span class="line"><span>etcd-k8s-master02                      1/1     Running   0          4h4m</span></span>
<span class="line"><span>etcd-k8s-master03                      1/1     Running   0          4h4m</span></span>
<span class="line"><span>kube-apiserver-k8s-master01            1/1     Running   0          4h4m</span></span>
<span class="line"><span>kube-apiserver-k8s-master02            1/1     Running   0          4h4m</span></span>
<span class="line"><span>kube-apiserver-k8s-master03            1/1     Running   0          4h4m</span></span>
<span class="line"><span>kube-controller-manager-k8s-master01   1/1     Running   1          4h4m</span></span>
<span class="line"><span>kube-controller-manager-k8s-master02   1/1     Running   0          4h4m</span></span>
<span class="line"><span>kube-controller-manager-k8s-master03   1/1     Running   0          4h4m</span></span>
<span class="line"><span>kube-proxy-8fpmv                       1/1     Running   0          4h3m</span></span>
<span class="line"><span>kube-proxy-8sw6v                       1/1     Running   0          4h3m</span></span>
<span class="line"><span>kube-proxy-9chjn                       1/1     Running   0          4h3m</span></span>
<span class="line"><span>kube-proxy-ctrth                       1/1     Running   0          4h4m</span></span>
<span class="line"><span>kube-proxy-gsst4                       1/1     Running   0          4h4m</span></span>
<span class="line"><span>kube-proxy-qb9kh                       1/1     Running   0          4h3m</span></span>
<span class="line"><span>kube-scheduler-k8s-master01            1/1     Running   13         4h4m</span></span>
<span class="line"><span>kube-scheduler-k8s-master02            1/1     Running   4          4h4m</span></span>
<span class="line"><span>kube-scheduler-k8s-master03            1/1     Running   4          4h4m</span></span>
<span class="line"><span>You have new mail in /var/spool/mail/root</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6ã€å®‰è£…dashboard" tabindex="-1"><a class="header-anchor" href="#_6ã€å®‰è£…dashboard"><span>6ã€å®‰è£…dashboard</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#1. å®‰è£…è€ç‰ˆæœ¬</span></span>
<span class="line"><span>cd /root/k8s-ha-install/dashboard/</span></span>
<span class="line"><span>kubectl create -f .</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#2. å®‰è£…æœ€æ–°ç‰ˆï¼š</span></span>
<span class="line"><span>kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.2.0/aio/deploy/recommended.yaml</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#æˆæƒï¼š</span></span>
<span class="line"><span>vim admin.yaml</span></span>
<span class="line"><span>#--------------------------admin.yaml--------------------------#</span></span>
<span class="line"><span>apiVersion: v1 </span></span>
<span class="line"><span>kind: ServiceAccount </span></span>
<span class="line"><span>metadata: </span></span>
<span class="line"><span>  name: admin-user </span></span>
<span class="line"><span>  namespace: kube-system </span></span>
<span class="line"><span>--- </span></span>
<span class="line"><span>apiVersion: rbac.authorization.k8s.io/v1 </span></span>
<span class="line"><span>kind: ClusterRoleBinding </span></span>
<span class="line"><span>metadata: </span></span>
<span class="line"><span>  name: admin-user </span></span>
<span class="line"><span>  annotations: </span></span>
<span class="line"><span>    rbac.authorization.kubernetes.io/autoupdate: &quot;true&quot; </span></span>
<span class="line"><span>roleRef: </span></span>
<span class="line"><span>  apiGroup: rbac.authorization.k8s.io </span></span>
<span class="line"><span>  kind: ClusterRole </span></span>
<span class="line"><span>  name: cluster-admin </span></span>
<span class="line"><span>subjects: </span></span>
<span class="line"><span>- kind: ServiceAccount </span></span>
<span class="line"><span>  name: admin-user </span></span>
<span class="line"><span>  namespace: kube-system</span></span>
<span class="line"><span>#--------------------------admin.yaml--------------------------#</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#æ‰§è¡Œå®‰è£…</span></span>
<span class="line"><span>kubectl apply -f admin.yaml -n kube-system</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ç™»å½•dashboard</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>åœ¨è°·æ­Œæµè§ˆå™¨ï¼ˆChromeï¼‰å¯åŠ¨æ–‡ä»¶ä¸­åŠ å…¥å¯åŠ¨å‚æ•°ï¼Œç”¨äºè§£å†³æ— æ³•è®¿é—®Dashboardçš„é—®é¢˜ï¼Œå‚è€ƒå›¾1-1ï¼š</span></span>
<span class="line"><span></span></span>
<span class="line"><span>è°·æ­Œæµè§ˆå™¨æ·»åŠ å‚æ•°ï¼š</span></span>
<span class="line"><span>--test-type --ignore-certificate-errors</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/2024-01-18_100251_7822250.19618477323547356-YaLPLebj.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>æ›´æ”¹dashboardçš„svcä¸ºNodePortï¼š</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>kubectl edit svc kubernetes-dashboard -n kubernetes-dashboard</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>spec: </span></span>
<span class="line"><span>  clusterIP: 10.108.157.21 </span></span>
<span class="line"><span>  clusterIPs: </span></span>
<span class="line"><span>  - 10.108.157.21 </span></span>
<span class="line"><span>  externalTrafficPolicy: Cluster </span></span>
<span class="line"><span>  ports: </span></span>
<span class="line"><span>  - nodePort: 30195 </span></span>
<span class="line"><span>    port: 443 </span></span>
<span class="line"><span>    protocol: TCP </span></span>
<span class="line"><span>    targetPort: 8443 </span></span>
<span class="line"><span>  selector: </span></span>
<span class="line"><span>    k8s-app: kubernetes-dashboard </span></span>
<span class="line"><span>  sessionAffinity: None </span></span>
<span class="line"><span>  type: ClusterIP     #æ”¹ä¸º NodePort </span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>#ä¿®æ”¹å®Œæˆåå¦‚ä¸‹ï¼š</span></span>
<span class="line"><span>spec: </span></span>
<span class="line"><span>  clusterIP: 10.108.157.21 </span></span>
<span class="line"><span>  clusterIPs: </span></span>
<span class="line"><span>  - 10.108.157.21 </span></span>
<span class="line"><span>  externalTrafficPolicy: Cluster </span></span>
<span class="line"><span>  ports: </span></span>
<span class="line"><span>  - nodePort: 30195 </span></span>
<span class="line"><span>    port: 443 </span></span>
<span class="line"><span>    protocol: TCP </span></span>
<span class="line"><span>    targetPort: 8443 </span></span>
<span class="line"><span>  selector: </span></span>
<span class="line"><span>    k8s-app: kubernetes-dashboard </span></span>
<span class="line"><span>  sessionAffinity: None </span></span>
<span class="line"><span>  type: NodePort      #å·²ç»æ”¹ä¸ºNodePort</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>ä¿®æ”¹å®Œæˆåè®¿é—®dashboardï¼š</span></span>
<span class="line"><span>#æŸ¥çœ‹ç«¯å£å·ï¼š</span></span>
<span class="line"><span>kubectl get svc kubernetes-dashboard -n kubernetes-dashboard</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7ã€é€šè¿‡httpsåè®®è¿›è¡Œè®¿é—®" tabindex="-1"><a class="header-anchor" href="#_7ã€é€šè¿‡httpsåè®®è¿›è¡Œè®¿é—®"><span>7ã€é€šè¿‡httpsåè®®è¿›è¡Œè®¿é—®</span></a></h2><p><code>https://192.168.3.31:30995/</code><img src="/assets/2024-01-18_100447_8443210.19085411082207815-BYQJrZlP.png" alt="" loading="lazy"></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#æŸ¥çœ‹tokenå€¼ï¼š</span></span>
<span class="line"><span>kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep admin-user | awk &#39;{print $1}&#39;)</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#å¾—åˆ° token:</span></span>
<span class="line"><span>eyJhbGciOiJSUzI1NiIsImtpZCI6IlFkM3BUd0xxVEZ6a0t4Njl2QnVaMWhLNUl4NFlzUkVrQngzbmlQeG4zczgifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi11c2VyLXRva2VuLXRidjRkIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImFkbWluLXVzZXIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI0MzI2NDM1My1iNzY4LTRlNTEtYjljZS0wY2FlMzJlNThmOTgiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06YWRtaW4tdXNlciJ9.jKtz39e-9EBlLhIW571Ms63ywad2z0s2hEa0ZalBRcEDXDKLN7jDejTLrrcyeNY5pRa8AUtbS1ckiYWI7OOlR3PBjD5Tgaz2HEKFw0FEoNMQnU8uLzR5WbUX4obOpzAyB4WYmCS9vK-ud98mmMHOT15Ee2BeaxIWTBL715m-NJcIxxByvsBtogVj7zWJayAVLOspMLps8hWk8XJDXpWEx0J8uU9KUPOey3YMiO5gNlk5TRHcZJOGg_7HV8_55MqKTQ8K9Jhsu5uVieB3kuJdwJdcGCGrMi1UVGx-RgJwGbZqMkXgy55QAp2he_sNFZmThhuxvz7FIclUyyoUZ43V9Q</span></span>
<span class="line"><span></span></span>
<span class="line"><span>å°†tokenç²˜è´´åˆ°webé¡µé¢ä¸Šçš„tokenè¾“å…¥æ </span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="/assets/2024-01-18_100630_8176320.023882901635084886-DefU2e33.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="_8ã€-é…ç½®ä¿®æ”¹" tabindex="-1"><a class="header-anchor" href="#_8ã€-é…ç½®ä¿®æ”¹"><span>8ã€ é…ç½®ä¿®æ”¹</span></a></h2><blockquote><p>å°†Kube-proxyæ”¹ä¸ºipvsæ¨¡å¼ï¼Œå› ä¸ºåœ¨åˆå§‹åŒ–é›†ç¾¤çš„æ—¶å€™æ³¨é‡Šäº†ipvsé…ç½®ï¼Œæ‰€ä»¥éœ€è¦è‡ªè¡Œä¿®æ”¹ä¸€ä¸‹ï¼š åœ¨master01èŠ‚ç‚¹æ‰§è¡Œ</p></blockquote><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>kubectl edit cm kube-proxy -n kube-system</span></span>
<span class="line"><span>modeï¼š ä¿®æ”¹ä¸º mode: ipvs</span></span>
<span class="line"><span></span></span>
<span class="line"><span>æ›´æ–°Kube-Proxyçš„Podï¼š</span></span>
<span class="line"><span>kubectl patch daemonset kube-proxy -p &quot;{\&quot;spec\&quot;:{\&quot;template\&quot;:{\&quot;metadata\&quot;:{\&quot;annotations\&quot;:{\&quot;date\&quot;:\&quot;`date +&#39;%s&#39;`\&quot;}}}}}&quot; -n kube-system</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>éªŒè¯Kube-Proxyæ¨¡å¼ï¼š</span></span>
<span class="line"><span>curl 127.0.0.1:10249/proxyMode</span></span>
<span class="line"><span>ipvs</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æœ€åé›†ç¾¤çŠ¶æ€</strong></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>root@k8s-master01[10:36:14]:~$ kubectl get nodes</span></span>
<span class="line"><span>NAME           STATUS   ROLES                  AGE   VERSION</span></span>
<span class="line"><span>k8s-master01   Ready    control-plane,master   19h   v1.21.14</span></span>
<span class="line"><span>k8s-master02   Ready    control-plane,master   19h   v1.21.14</span></span>
<span class="line"><span>k8s-master03   Ready    control-plane,master   19h   v1.21.14</span></span>
<span class="line"><span>k8s-worker01   Ready    &lt;none&gt;                 19h   v1.21.14</span></span>
<span class="line"><span>k8s-worker02   Ready    &lt;none&gt;                 19h   v1.21.14</span></span>
<span class="line"><span>k8s-worker03   Ready    &lt;none&gt;                 19h   v1.21.14</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_9ã€-é«˜å¯ç”¨æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#_9ã€-é«˜å¯ç”¨æµ‹è¯•"><span>9ã€ é«˜å¯ç”¨æµ‹è¯•</span></a></h2><p><code>k8s-master01æ˜¯vipåœ°å€ï¼Œåœæ­¢eth0åvipæ¶ˆå¤±ï¼Œvipåœ°å€ä¼šæ¼‚ç§»åˆ°k8s-master01ä¸Š</code></p><h2 id="_10ã€-å®‰è£…kuboardé›†ç¾¤ç®¡ç†é¢æ¿" tabindex="-1"><a class="header-anchor" href="#_10ã€-å®‰è£…kuboardé›†ç¾¤ç®¡ç†é¢æ¿"><span>10ã€ å®‰è£…Kuboardé›†ç¾¤ç®¡ç†é¢æ¿</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#åœ¨master01èŠ‚ç‚¹ä¸Šæ‰§è¡Œ</span></span>
<span class="line"><span>kubectl apply -f https://addons.kuboard.cn/kuboard/kuboard-v3.yaml</span></span>
<span class="line"><span># æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æŒ‡ä»¤ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œè¯¥æŒ‡ä»¤ä½¿ç”¨åä¸ºäº‘çš„é•œåƒä»“åº“æ›¿ä»£ docker hub åˆ†å‘ Kuboard æ‰€éœ€è¦çš„é•œåƒ</span></span>
<span class="line"><span># kubectl apply -f https://addons.kuboard.cn/kuboard/kuboard-v3-swr.yaml</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>#æ‰§è¡ŒæŒ‡ä»¤ watch kubectl get pods -n kuboardï¼Œç­‰å¾… kuboard åç§°ç©ºé—´ä¸­æ‰€æœ‰çš„ Pod å°±ç»ªï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼Œ</span></span>
<span class="line"><span>Every 2.0s: kubectl get pods -n kuboard                          Thu Jan 18 14:20:40 2024</span></span>
<span class="line"><span></span></span>
<span class="line"><span>NAME                          READY   STATUS              RESTARTS   AGE</span></span>
<span class="line"><span>kuboard-etcd-ltkjt            1/1     Running             0          3m54s</span></span>
<span class="line"><span>kuboard-etcd-m257r            0/1     ContainerCreating   0          3m54s</span></span>
<span class="line"><span>kuboard-etcd-q6dqw            1/1     Running             0          3m54s</span></span>
<span class="line"><span>kuboard-v3-5fc46b5557-qq6pk   0/1     ContainerCreating   0          3m53s</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#æœ€ç»ˆå®Œæˆåçš„çŠ¶æ€</span></span>
<span class="line"><span>Every 2.0s: kubectl get pods -n kuboard                          Thu Jan 18 14:26:54 2024</span></span>
<span class="line"><span></span></span>
<span class="line"><span>NAME                               READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span>kuboard-agent-2-78b6856bb5-kw67d   1/1     Running   1          3m58s</span></span>
<span class="line"><span>kuboard-agent-857d7b8f45-dmctj     1/1     Running   1          3m58s</span></span>
<span class="line"><span>kuboard-etcd-ltkjt                 1/1     Running   0          10m</span></span>
<span class="line"><span>kuboard-etcd-m257r                 1/1     Running   0          10m</span></span>
<span class="line"><span>kuboard-etcd-q6dqw                 1/1     Running   0          10m</span></span>
<span class="line"><span>kuboard-questdb-586fb449fc-hdvwp   1/1     Running   0          3m58s</span></span>
<span class="line"><span>kuboard-v3-5fc46b5557-qq6pk        1/1     Running   0          10m</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>è®¿é—® Kuboard</strong></p><blockquote><p>åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€é“¾æ¥ http://your-node-ip-address:30080 è¾“å…¥åˆå§‹ç”¨æˆ·åå’Œå¯†ç ï¼Œå¹¶ç™»å½• ç”¨æˆ·åï¼š admin å¯†ç ï¼š Kuboard123 æµè§ˆå™¨å…¼å®¹æ€§ è¯·ä½¿ç”¨ Chrome / FireFox / Safari / Edge ç­‰æµè§ˆå™¨ ä¸å…¼å®¹ IE ä»¥åŠä»¥ IE ä¸ºå†…æ ¸çš„æµè§ˆå™¨ æ·»åŠ æ–°çš„é›†ç¾¤ Kuboard v3 æ˜¯æ”¯æŒ Kubernetes å¤šé›†ç¾¤ç®¡ç†çš„ï¼Œåœ¨ Kuboard v3 çš„é¦–é¡µé‡Œï¼Œç‚¹å‡» æ·»åŠ é›†ç¾¤ æŒ‰é’®ï¼Œåœ¨å‘å¯¼çš„å¼•å¯¼ä¸‹å¯ä»¥å®Œæˆé›†ç¾¤çš„æ·»åŠ ï¼› å‘ Kuboard v3 æ·»åŠ æ–°çš„ Kubernetes é›†ç¾¤æ—¶ï¼Œè¯·ç¡®ä¿ï¼š æ‚¨æ–°æ·»åŠ é›†ç¾¤å¯ä»¥è®¿é—®åˆ°å½“å‰é›†ç¾¤ Master èŠ‚ç‚¹ å†…ç½‘IP çš„ 30080 TCPã€30081 TCPã€30081 UDP ç«¯å£ï¼› å¦‚æœæ‚¨æ‰“ç®—æ–°æ·»åŠ åˆ° Kuboard ä¸­çš„é›†ç¾¤ä¸å½“å‰é›†ç¾¤ä¸åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘ï¼Œè¯·å’¨è¯¢ Kuboard å›¢é˜Ÿï¼Œå¸®åŠ©æ‚¨è§£å†³é—®é¢˜ã€‚</p></blockquote><figure><img src="/assets/2024-01-18_142756_3843980.9232590886755949-Dh_lFSbG.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><strong>æ ¹æ®æç¤ºæ·»åŠ é›†ç¾¤ï¼Œæœ€åæ•ˆæœå¦‚ä¸‹</strong></p><figure><img src="/assets/2024-01-18_144246_4851460.36406800115353777-0yZ9CUiV.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><!----><!----></div></footer><nav class="vp-page-nav"><a class="route-link route-link-active auto-link prev" href="/note/kubernetes/install/kubeadm/High%20availability/" aria-label="2ã€å®‰è£…3ä¸»3ä»"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><span class="font-icon icon fa-fw fa-sm fas fa-book" style=""></span>2ã€å®‰è£…3ä¸»3ä»</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer">ä¸€å¤©æ˜¯ITäººï¼Œä¸€è¾ˆå­éƒ½æ˜¯ï¼ Â© é£å 2024-è‡³ä»Š Mr.FH</div><div class="vp-copyright">Copyright Â© 2024 é£å </div></footer></div><!--]--><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-mt04-1UL.js" defer></script>
  </body>
</html>
