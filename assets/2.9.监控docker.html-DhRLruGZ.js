import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,o as n,d as a}from"./app-fmcy30Ms.js";const i={},d=a(`<h1 id="一、环境" tabindex="-1"><a class="header-anchor" href="#一、环境"><span>一、环境</span></a></h1><table id="f61207c5" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:748px;"><tbody><tr style="height:33px;"><td width="187" style="border:1px solid #d9d9d9;"><p id="u2112f38e" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">主机名</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u099af289" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">IP地址</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u530d8c14" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">系统</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u94a1d109" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">说明</span></p></td></tr><tr style="height:33px;"><td width="187" style="border:1px solid #d9d9d9;"><p id="u543699fb" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">localhost</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="ua558310d" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">192.168.11.61</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u3982a915" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">Ubuntu 20.04</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="ub03b2d05" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">docker安装的prometheus</span></p></td></tr><tr style="height:33px;"><td width="187" style="border:1px solid #d9d9d9;"><p id="u4a19cdf8" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">test</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u82420eb0" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">192.168.11.62</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="udfa55170" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">Ubuntu 20.04</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u52301d25" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">Docker 版本 23.0.1</span></p></td></tr></tbody></table><h2 id="_1、环境搭建" tabindex="-1"><a class="header-anchor" href="#_1、环境搭建"><span>1、环境搭建</span></a></h2><h3 id="docker安装" tabindex="-1"><a class="header-anchor" href="#docker安装"><span>docker安装</span></a></h3><p>略</p><h3 id="docker-compose安装" tabindex="-1"><a class="header-anchor" href="#docker-compose安装"><span>docker-compose安装</span></a></h3><p>略</p><h1 id="二、监控docker" tabindex="-1"><a class="header-anchor" href="#二、监控docker"><span>二、监控docker</span></a></h1><p>为了能够获取到Docker容器的运行状态，用户可以通过Docker的stats命令获取到当前主机上运行容器的统计信息，可以查看容器的CPU利用率、内存使用量、网络IO总量以及磁盘IO总量等信息。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker stats</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>除了使用命令以外，用户还可以通过Docker提供的HTTP API查看容器详细的监控统计信息。</p><h2 id="_1、使用cadvisor" tabindex="-1"><a class="header-anchor" href="#_1、使用cadvisor"><span>1、使用CAdvisor</span></a></h2><p><a href="https://github.com/google/cadvisor/blob/master/docs/storage/prometheus.md" target="_blank" rel="noopener noreferrer">文档</a></p><p>CAdvisor是Google开源的一款用于展示和分析容器运行状态的可视化工具。通过在主机上运行CAdvisor用户可以轻松的获取到当前主机上容器的运行统计信息，并以图表的形式向用户展示。</p><h3 id="docker命令安装" tabindex="-1"><a class="header-anchor" href="#docker命令安装"><span>docker命令安装</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker run -d \\</span></span>
<span class="line"><span>  --restart=always \\</span></span>
<span class="line"><span>  --volume=/:/rootfs:ro \\</span></span>
<span class="line"><span>  --volume=/var/run:/var/run:rw \\</span></span>
<span class="line"><span>  --volume=/sys:/sys:ro \\</span></span>
<span class="line"><span>  --volume=/var/lib/docker/:/var/lib/docker:ro \\</span></span>
<span class="line"><span>  --publish=8080:8080 \\</span></span>
<span class="line"><span>  --name=cadvisor \\</span></span>
<span class="line"><span>  google/cadvisor:latest</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="docker-compose安装-1" tabindex="-1"><a class="header-anchor" href="#docker-compose安装-1"><span>Docker-compose安装</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>mkdir /data/cadvisor</span></span>
<span class="line"><span></span></span>
<span class="line"><span>cd /data/cadvisor</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#通过cat新建docker-compose.yaml文件</span></span>
<span class="line"><span>cat &gt; docker-compose.yaml &lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span>version: &#39;3.3&#39;</span></span>
<span class="line"><span>  cadvisor:</span></span>
<span class="line"><span>    image: google/cadvisor:latest</span></span>
<span class="line"><span>    container_name: cadvisor</span></span>
<span class="line"><span>    restart: always</span></span>
<span class="line"><span>    volumes:</span></span>
<span class="line"><span>      - /:/rootfs:ro</span></span>
<span class="line"><span>      - /var/run:/var/run:rw</span></span>
<span class="line"><span>      - /sys:/sys:ro</span></span>
<span class="line"><span>      - /var/lib/docker/:/var/lib/docker:ro</span></span>
<span class="line"><span>    ports:</span></span>
<span class="line"><span>      - 8080:8080</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker-compose up -d</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>检查</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker ps</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>通过访问http://localhost:8080可以查看，当前主机上容器的运行状态，如下所示</p><p>访问http://localhost:8080/metrics即可获取到标准的Prometheus监控样本输出</p><h2 id="_2、prometheus配置" tabindex="-1"><a class="header-anchor" href="#_2、prometheus配置"><span>2、Prometheus配置</span></a></h2><p>配置prometheus去采集（拉取）cAdvisor的监控样本数据</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cd /data/docker-prometheus </span></span>
<span class="line"><span></span></span>
<span class="line"><span>#在scrape_configs(搜刮配置):下面增加如下配置：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>cat &gt;&gt; prometheus/prometheus.yml &lt;&lt; &quot;EOF&quot;</span></span>
<span class="line"><span>  - job_name: &#39;cadvisor&#39;</span></span>
<span class="line"><span>    static_configs:</span></span>
<span class="line"><span>    - targets: [&#39;192.168.11.62:8080&#39;]</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        instance: test服务器</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重新加载配置</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>curl -X POST http://localhost:9090/-/reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="检查" tabindex="-1"><a class="header-anchor" href="#检查"><span>检查</span></a></h3><p>启动完成后，可以在Prometheus UI中查看到当前所有的Target状态：</p><p><a href="http://192.168.11.61:9090/targets?search=" target="_blank" rel="noopener noreferrer">http://192.168.11.61:9090/targets?search=</a></p><h2 id="_3、常用监控指标" tabindex="-1"><a class="header-anchor" href="#_3、常用监控指标"><span>3、常用监控指标</span></a></h2><p>下面表格中列举了一些CAdvisor中获取到的典型监控指标：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>container_</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><table id="c8c4b72a" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:750px;"><tbody><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u7036d724" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">指标名称</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uf84b2b6d" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">类型</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ube970f2f" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">含义</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u0ea89fd2" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">container_cpu_load_average_10s</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ufc4a8ae7" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">gauge</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u3e397459" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">过去10秒容器CPU的平均负载</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u08f21c0b" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">container_cpu_usage_seconds_total</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u34b88bd9" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">counter</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ub304c2ac" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">容器在每个CPU内核上的累积占用时间 (单位：秒)</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u09966986" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">container_cpu_system_seconds_total</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u594755bf" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">counter</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uce4cb533" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">System CPU累积占用时间（单位：秒）</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u120f964c" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">container_cpu_user_seconds_total</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uedaaa787" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">counter</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u5c781382" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">User CPU累积占用时间（单位：秒）</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u7ed7f24c" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">container_fs_usage_bytes</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uc1fb101f" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">gauge</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ua6ae1f79" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">容器中文件系统的使用量(单位：字节)</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="uab88495b" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">container_fs_limit_bytes</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u11f6a17e" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">gauge</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ue6d03d0c" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">容器可以使用的文件系统总量(单位：字节)</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u942ee6d9" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">container_fs_reads_bytes_total</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u8992a1e1" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">counter</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u93982eb8" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">容器累积读取数据的总量(单位：字节)</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u4c344b09" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">container_fs_writes_bytes_total</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u38f29a7e" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">counter</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u91283ea1" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">容器累积写入数据的总量(单位：字节)</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="ud6493670" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">container_memory_max_usage_bytes</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uec623741" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">gauge</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ua25b0dea" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">容器的最大内存使用量（单位：字节）</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u9185f4e4" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">container_memory_usage_bytes</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u9b20567a" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">gauge</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uca2c8b33" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">容器当前的内存使用量（单位：字节</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u23609d12" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">container_spec_memory_limit_bytes</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u1b568e64" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">gauge</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uc0715aa5" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">容器的内存使用量限制</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u535ee49a" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">machine_memory_bytes</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u389f7c0d" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">gauge</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u3e95152b" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">当前主机的内存总量</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u8c14777d" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">container_network_receive_bytes_total</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u326763d8" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">counter</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u881826ac" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">容器网络累积接收数据总量（单位：字节）</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="udb13a11e" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">container_network_transmit_bytes_total</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uae818b33" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">counter</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ud95bbf02" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">容器网络累积传输数据总量（单位：字节）</span></p></td></tr></tbody></table><h2 id="_4、触发器配置" tabindex="-1"><a class="header-anchor" href="#_4、触发器配置"><span>4、触发器配置</span></a></h2><p>Prometheus配置</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># 报警(触发器)配置</span></span>
<span class="line"><span>rule_files:</span></span>
<span class="line"><span>  - &quot;alert.yml&quot;  </span></span>
<span class="line"><span>  - &quot;rules/*.yml&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="添加docker触发器-告警规则" tabindex="-1"><a class="header-anchor" href="#添加docker触发器-告警规则"><span>添加docker触发器（告警规则）</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat &gt;&gt; prometheus/rules/docker.yml &lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span>groups:</span></span>
<span class="line"><span>- name: DockerContainers</span></span>
<span class="line"><span>  rules:</span></span>
<span class="line"><span>  - alert: ContainerKilled</span></span>
<span class="line"><span>    expr: time() - container_last_seen &gt; 60</span></span>
<span class="line"><span>    for: 0m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      isummary: &quot;Docker容器被杀死 容器:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;{{ $value }}个容器消失了&quot;</span></span>
<span class="line"><span>  # This rule can be very noisy in dynamic infra with legitimate container start/stop/deployment.</span></span>
<span class="line"><span>  - alert: ContainerAbsent</span></span>
<span class="line"><span>    expr: absent(container_last_seen)</span></span>
<span class="line"><span>    for: 5m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;无容器 容器: {{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;5分钟检查容器不存在，值为：{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: ContainerCpuUsage</span></span>
<span class="line"><span>    expr: (sum(rate(container_cpu_usage_seconds_total{name!=&quot;&quot;}[3m])) BY (instance, name) * 100) &gt; 300</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;容器cpu使用率告警 容器: {{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;容器cpu使用率超过300%，当前值为：{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: ContainerMemoryUsage</span></span>
<span class="line"><span>    expr: (sum(container_memory_working_set_bytes{name!=&quot;&quot;}) BY (instance, name) / sum(container_spec_memory_limit_bytes &gt; 0) BY (instance, name) * 100) &gt; 80</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;容器内存使用率告警 容器: {{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;容器内存使用率超过80%，当前值为：{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: ContainerVolumeIoUsage</span></span>
<span class="line"><span>    expr: (sum(container_fs_io_current{name!=&quot;&quot;}) BY (instance, name) * 100) &gt; 80</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;容器存储io使用率告警 容器: {{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;容器存储io使用率超过 80%，当前值为：{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: ContainerHighThrottleRate</span></span>
<span class="line"><span>    expr: rate(container_cpu_cfs_throttled_seconds_total[3m]) &gt; 1</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;容器限制告警 容器:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;容器被限制，当前值为：{{ $value }}&quot;</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重新加载配置</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>curl -X POST http://localhost:9090/-/reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>检查</p><h2 id="_5、dashboard" tabindex="-1"><a class="header-anchor" href="#_5、dashboard"><span>5、dashboard</span></a></h2><p>grafana展示prometheus收集到的cadvisor的数据</p><p>192.168.11.61:3000</p><p>11600 <a href="https://grafana.com/grafana/dashboards/11600-docker-container/" target="_blank" rel="noopener noreferrer">https://grafana.com/grafana/dashboards/11600-docker-container/</a></p>`,48),t=[d];function l(p,r){return n(),e("div",null,t)}const h=s(i,[["render",l],["__file","2.9.监控docker.html.vue"]]),m=JSON.parse('{"path":"/note/Prometheus/2.9.%E7%9B%91%E6%8E%A7docker.html","title":"2.9.监控docker","lang":"zh-CN","frontmatter":{"title":"2.9.监控docker","order":14,"icon":"lightbulb","description":"一、环境 1、环境搭建 docker安装 略 docker-compose安装 略 二、监控docker 为了能够获取到Docker容器的运行状态，用户可以通过Docker的stats命令获取到当前主机上运行容器的统计信息，可以查看容器的CPU利用率、内存使用量、网络IO总量以及磁盘IO总量等信息。 除了使用命令以外，用户还可以通过Docker提供的H...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/note/Prometheus/2.9.%E7%9B%91%E6%8E%A7docker.html"}],["meta",{"property":"og:site_name","content":"风华"}],["meta",{"property":"og:title","content":"2.9.监控docker"}],["meta",{"property":"og:description","content":"一、环境 1、环境搭建 docker安装 略 docker-compose安装 略 二、监控docker 为了能够获取到Docker容器的运行状态，用户可以通过Docker的stats命令获取到当前主机上运行容器的统计信息，可以查看容器的CPU利用率、内存使用量、网络IO总量以及磁盘IO总量等信息。 除了使用命令以外，用户还可以通过Docker提供的H..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"风华"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"2.9.监控docker\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"风华\\",\\"url\\":\\"/portfolio\\"}]}"]]},"headers":[{"level":2,"title":"1、环境搭建","slug":"_1、环境搭建","link":"#_1、环境搭建","children":[{"level":3,"title":"docker安装","slug":"docker安装","link":"#docker安装","children":[]},{"level":3,"title":"docker-compose安装","slug":"docker-compose安装","link":"#docker-compose安装","children":[]}]},{"level":2,"title":"1、使用CAdvisor","slug":"_1、使用cadvisor","link":"#_1、使用cadvisor","children":[{"level":3,"title":"docker命令安装","slug":"docker命令安装","link":"#docker命令安装","children":[]},{"level":3,"title":"Docker-compose安装","slug":"docker-compose安装-1","link":"#docker-compose安装-1","children":[]}]},{"level":2,"title":"2、Prometheus配置","slug":"_2、prometheus配置","link":"#_2、prometheus配置","children":[{"level":3,"title":"检查","slug":"检查","link":"#检查","children":[]}]},{"level":2,"title":"3、常用监控指标","slug":"_3、常用监控指标","link":"#_3、常用监控指标","children":[]},{"level":2,"title":"4、触发器配置","slug":"_4、触发器配置","link":"#_4、触发器配置","children":[{"level":3,"title":"添加docker触发器（告警规则）","slug":"添加docker触发器-告警规则","link":"#添加docker触发器-告警规则","children":[]}]},{"level":2,"title":"5、dashboard","slug":"_5、dashboard","link":"#_5、dashboard","children":[]}],"git":{},"readingTime":{"minutes":9.54,"words":2863},"filePathRelative":"note/Prometheus/2.9.监控docker.md","autoDesc":true}');export{h as comp,m as data};
