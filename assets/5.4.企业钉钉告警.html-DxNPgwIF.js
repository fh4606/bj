import{_ as e}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as s,o as a,d as i}from"./app-cGHsJGw-.js";const n="/vuepress/assets/2023-10-28_210249_2301060.3740863851828825-DZBLZWho.png",l="/vuepress/assets/2023-10-28_210249_6829590.4556152455113155-cIDmq_iL.png",t="/vuepress/assets/2023-10-28_210248_9499620.6958107209671164-CPKO7rb6.png",p="/vuepress/assets/2023-10-28_210250_4696850.3609613330424307-BUNtladd.png",d="/vuepress/assets/2023-10-28_210249_8112720.34154701865988424-CdDPtXSC.png",r="/vuepress/assets/2023-10-28_210250_1336340.9654623365364813-ClPGX0dK.png",c="/vuepress/assets/2023-10-28_210249_9196690.6236833202542279-CUzHmy-W.png",o="/vuepress/assets/2023-10-28_210249_3370280.3474629028910682-pv577YiR.png",h="/vuepress/assets/2023-10-28_210250_8804700.5341264896659748-Br-v3q3-.png",g="/vuepress/assets/2023-10-28_210251_0296280.6899420332522106-Chof0RoP.png",m="/vuepress/assets/2023-10-28_210250_6935410.9453763212047746-_uSzoC-g.png",b="/vuepress/assets/2023-10-28_210251_1934010.22571243598786184-BV95JEt8.png",u="/vuepress/assets/2023-10-28_210250_1624310.8359351428450916-w8m7Gl2h.png",k="/vuepress/assets/2023-10-28_210250_7171310.22366069889920226-Br959MkA.png",v="/vuepress/assets/2023-10-28_210250_7615230.866532525127337-CoWXaROO.png",f="/vuepress/assets/2023-10-28_210251_3345940.5521683434218457-DZVE8fDg.png",_="/vuepress/assets/2023-10-28_202232_3157980.3417943973584434-fzbfidHN.png",y={},x=i('<h1 id="一、环境介绍" tabindex="-1"><a class="header-anchor" href="#一、环境介绍"><span>一、环境介绍</span></a></h1><table id="a04f6509" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:748px;"><tbody><tr style="height:33px;"><td width="187" style="border:1px solid #d9d9d9;"><p id="u26761d7f" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">主机名</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u9833a616" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">IP地址</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u3a9b947d" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">系统</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u39935c7d" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">说明</span></p></td></tr><tr style="height:33px;"><td width="187" style="border:1px solid #d9d9d9;"><p id="ud273df3e" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">localhost</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="ua16beae2" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">192.168.11.61</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="ud3ae6df9" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">Ubuntu 20.04</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u07b14eba" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">docker方式安装的prometheus</span></p></td></tr></tbody></table><h1 id="二、获取钉钉的webhook地址" tabindex="-1"><a class="header-anchor" href="#二、获取钉钉的webhook地址"><span>二、获取钉钉的webhook地址</span></a></h1><h2 id="_1、注册企业钉钉" tabindex="-1"><a class="header-anchor" href="#_1、注册企业钉钉"><span>1、注册企业钉钉</span></a></h2><h3 id="a、注册企业钉钉" tabindex="-1"><a class="header-anchor" href="#a、注册企业钉钉"><span>a、注册企业钉钉</span></a></h3><p>浏览器打开<a href="https://oa.dingtalk.com/register_new.htm?source=CreateTeamPC&amp;lwfrom=2019111111293551000#/" target="_blank" rel="noopener noreferrer">钉钉注册页面</a> 填入手机号码，填入获取到的验证码，点注册</p><figure><img src="'+n+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>填入企业资料并注册</p><figure><img src="'+l+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>注册成功后，扫描二维码下载钉钉，如下图：</p><figure><img src="'+t+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="b、添加机器人" tabindex="-1"><a class="header-anchor" href="#b、添加机器人"><span>b、添加机器人</span></a></h3><p>因为机器人添加，只能是钉钉电脑版（手机版钉钉不能添加机器人）。“测试钉钉报警“ 这个企业只有我一个人，所以我就把报警消息发到默认的 ”测试钉钉报警 全员群“ 里面。实际使用时，请创建个运维群--添加对应的人员进来。</p><p>电脑钉钉登陆成功后----点击左下角的。。。---然后再点管理后台，如下图：</p><figure><img src="'+p+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>点击之前创建的企业名</p><figure><img src="'+d+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>点通讯录--组织架构--添加子部门</p><figure><img src="'+r+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>刷新后，把接收告警的员工调整到刚刚添加的部门</p><figure><img src="'+c+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>勾选部门</p><figure><img src="'+o+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>添加成功后，电脑钉钉消息窗口--会弹出一个测试告警的群--点击这个群---群设置--机器人</p><figure><img src="'+h+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>添加机器人</p><figure><img src="'+g+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>添加机器人</p><figure><img src="'+m+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>点自定义</p><figure><img src="'+b+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>机器人名字：随意</p><p>勾选ip：填入alertmanager外网ip</p><p>如果在自己电脑上测试钉钉告警，获取Alertmanager外网ip地址的方法为浏览器打开http://ip138.com 您的iP地址是：[xxx.xx.xx.xx]得到自己外网ip地址。</p><figure><img src="'+u+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="c、复制机器人webhook地址" tabindex="-1"><a class="header-anchor" href="#c、复制机器人webhook地址"><span>c、复制机器人webhook地址</span></a></h3><figure><img src="'+k+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>复制webhook的地址，例如：</p><p><a href="https://oapi.dingtalk.com/robot/send?access_token=2ac0682516aa8634f3410c08339d21f7effeec5ac180eec60082a3ca66661f29" target="_blank" rel="noopener noreferrer">https://oapi.dingtalk.com/robot/send?access_token=2ac0682516aa8634f3410c08339d21f7effeec5ac180eec60082a3ca66661f29</a></p><p>我们真实需要的是access_token=后面的，如下：</p><p>2ac0682516aa8634f3410c08339d21f7effeec5ac180eec60082a3ca66661f29</p><h1 id="三、使用prometheus-webhook-dingtalk实现钉钉告警" tabindex="-1"><a class="header-anchor" href="#三、使用prometheus-webhook-dingtalk实现钉钉告警"><span>三、使用prometheus-webhook-dingtalk实现钉钉告警</span></a></h1><p><a href="https://github.com/timonwong/prometheus-webhook-dingtalk/releases" target="_blank" rel="noopener noreferrer">github地址</a>,获取最新的安装包</p><h2 id="_1、二进制安装-和docker安装二选一" tabindex="-1"><a class="header-anchor" href="#_1、二进制安装-和docker安装二选一"><span>1、二进制安装（和docker安装二选一）</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#安装二进制安装包</span></span>
<span class="line"><span>wget https://github.com/timonwong/prometheus-webhook-dingtalk/releases/download/v2.1.0/prometheus-webhook-dingtalk-2.1.0.linux-amd64.tar.gz</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#解压</span></span>
<span class="line"><span>tar vxf prometheus-webhook-dingtalk-2.1.0.linux-amd64.tar.gz</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ls -l</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#移动并改名</span></span>
<span class="line"><span>mv prometheus-webhook-dingtalk-2.1.0.linux-amd64 /opt/prometheus-webhook-dingtalk</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建配置文件</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat &gt; /opt/prometheus-webhook-dingtalk/config.yml &lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span>targets:</span></span>
<span class="line"><span>  webhook1:</span></span>
<span class="line"><span>    url: https://oapi.dingtalk.com/robot/send?access_token=修改为自己的TOKEN</span></span>
<span class="line"><span>    secret: SEC000000000000000000000</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建一个<code>prometheus</code>用户：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>useradd -M -s /usr/sbin/nologin prometheus</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>更改<code>prometheus-webhook-dingtalk</code>用户的文件夹权限：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>chown prometheus:prometheus -R /opt/prometheus-webhook-dingtalk</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>创建 systemd 服务</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat &gt; /etc/systemd/system/prometheus-webhook-dingtalk.service &lt;&lt; &quot;EOF&quot;</span></span>
<span class="line"><span>[Unit]</span></span>
<span class="line"><span>Description=prometheus-webhook-dingtalk</span></span>
<span class="line"><span>Documentation=https://github.com/timonwong/prometheus-webhook-dingtalk</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Service]</span></span>
<span class="line"><span>User=prometheus</span></span>
<span class="line"><span>Group=prometheus</span></span>
<span class="line"><span>Restart=on-failure</span></span>
<span class="line"><span>ExecStart=/opt/prometheus-webhook-dingtalk/prometheus-webhook-dingtalk \\</span></span>
<span class="line"><span>  --config.file=/opt/prometheus-webhook-dingtalk/config.yml</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Install]</span></span>
<span class="line"><span>WantedBy=multi-user.target</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动 prometheus-webhook-dingtalk</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl daemon-reload</span></span>
<span class="line"><span>systemctl start prometheus-webhook-dingtalk.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>加入到开机自启动</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl enable prometheus-webhook-dingtalk.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>检查</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl status prometheus-webhook-dingtalk.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>查看 prometheus-webhook-dingtalk的日志以进行故障排除：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>journalctl -u prometheus-webhook-dingtalk.service -f</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_2、docker安装-和二进制安装二选一-推荐" tabindex="-1"><a class="header-anchor" href="#_2、docker安装-和二进制安装二选一-推荐"><span>2、docker安装（和二进制安装二选一，推荐）</span></a></h2><h3 id="创建配置文件config-yml" tabindex="-1"><a class="header-anchor" href="#创建配置文件config-yml"><span>创建配置文件config.yml</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#创建数据目录</span></span>
<span class="line"><span>mkdir /data/docker-prometheus/prometheus-webhook-dingtalk/ -p</span></span>
<span class="line"><span></span></span>
<span class="line"><span>cat &gt; /data/docker-prometheus/prometheus-webhook-dingtalk/config.yml &lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#templates:</span></span>
<span class="line"><span>#  - /etc/prometheus-webhook-dingtalk/templates/default.tmpl</span></span>
<span class="line"><span></span></span>
<span class="line"><span>targets:</span></span>
<span class="line"><span>  webhook1:</span></span>
<span class="line"><span>    url: https://oapi.dingtalk.com/robot/send?access_token=之前复制的TOKEN</span></span>
<span class="line"><span>    secret: SEC000000000000000000000</span></span>
<span class="line"><span>    #message:</span></span>
<span class="line"><span>     # text: &#39;{{ template &quot;default.content&quot; . }}&#39;</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="docker-compose-yaml文件" tabindex="-1"><a class="header-anchor" href="#docker-compose-yaml文件"><span>docker-compose.yaml文件</span></a></h3><p>注：我把prometheus-webhook-dingtalk安装在prometheus服务器上，如果安装在其他机器上也是可以的。</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cd /data/docker-prometheus/prometheus-webhook-dingtalk/</span></span>
<span class="line"><span></span></span>
<span class="line"><span>cat &gt; docker-compose.yaml &lt;&lt; &quot;EOF&quot;</span></span>
<span class="line"><span>version: &#39;3.3&#39;</span></span>
<span class="line"><span>services:</span></span>
<span class="line"><span>  webhook:</span></span>
<span class="line"><span>    image: timonwong/prometheus-webhook-dingtalk:v2.1.0</span></span>
<span class="line"><span>    container_name: prometheus-webhook-dingtalk</span></span>
<span class="line"><span>    restart: &quot;always&quot;</span></span>
<span class="line"><span>    ports:</span></span>
<span class="line"><span>      - 8060:8060</span></span>
<span class="line"><span>    command:</span></span>
<span class="line"><span>      - &#39;--config.file=/etc/prometheus-webhook-dingtalk/config.yml&#39;</span></span>
<span class="line"><span>    volumes:</span></span>
<span class="line"><span>      - ./config.yml:/etc/prometheus-webhook-dingtalk/config.yml</span></span>
<span class="line"><span>      - /etc/localtime:/etc/localtime:ro</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker-compose up -d</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>检查</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker ps</span></span>
<span class="line"><span>或：</span></span>
<span class="line"><span>docker logs -f prometheus-webhook-dingtalk</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3、访问地址" tabindex="-1"><a class="header-anchor" href="#_3、访问地址"><span>3、访问地址</span></a></h2><table id="04d26e5d" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:750px;"><tbody><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u24c9f076" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">应用</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ue6c696cb" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">访问地址</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u2c390f31" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">备注</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u8a6fd1f0" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">prometheus-webhook-dingtalk</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ud0a168c8" class="ne-p" style="margin:0;padding:0;min-height:24px;"><a href="http://192.168.11.61:8060" data-href="http://192.168.11.61:8060" target="_blank" class="ne-link"><span class="ne-text">http://192.168.11.61:8060</span></a></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ua9b2b1ce" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">无用户和密码</span></p></td></tr></tbody></table><h2 id="_4、alertmanager配置" tabindex="-1"><a class="header-anchor" href="#_4、alertmanager配置"><span>4、alertmanager配置</span></a></h2><p>alertmanager/config.yml增加如下配置：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>route:</span></span>
<span class="line"><span>  receiver: &#39;dingtalk&#39;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>receivers:</span></span>
<span class="line"><span>- name: &#39;dingtalk&#39;</span></span>
<span class="line"><span>  webhook_configs:</span></span>
<span class="line"><span>  - url: &#39;http://192.168.11.61:8060/dingtalk/webhook1/send&#39;</span></span>
<span class="line"><span>    send_resolved: true</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="检查配置" tabindex="-1"><a class="header-anchor" href="#检查配置"><span>检查配置</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#docker安装方式，检查</span></span>
<span class="line"><span>docker exec -it alertmanager  amtool check-config /etc/alertmanager/config.yml</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#二进制安装方式，检查</span></span>
<span class="line"><span>/opt/prometheus/alertmanager/amtool check-config /opt/prometheus/alertmanager/alertmanager.yml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="重载alertmanager配置" tabindex="-1"><a class="header-anchor" href="#重载alertmanager配置"><span>重载alertmanager配置</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>curl -X POST http://localhost:9093/-/reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_5、配置触发器" tabindex="-1"><a class="header-anchor" href="#_5、配置触发器"><span>5、配置触发器</span></a></h2><p>已配置，查看现有触发器</p><h3 id="访问告警模块的web页面" tabindex="-1"><a class="header-anchor" href="#访问告警模块的web页面"><span>访问告警模块的web页面</span></a></h3><p><a href="http://192.168.11.61:9090/alerts" target="_blank" rel="noopener noreferrer">http://192.168.11.61:9090/alerts</a></p><ul><li><p>INACTIVE：活跃中，即表示正常无告警产生。</p></li><li><p>PENDING：待触发，表示已经达到预设的阈值，但没达到预设的时间。</p></li><li><p>FIRING：表示达到预设的阈值并超过预设的时间触发告警</p></li></ul><h2 id="_6、测试" tabindex="-1"><a class="header-anchor" href="#_6、测试"><span>6、测试</span></a></h2><p>关闭node-exporter</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#docker环境</span></span>
<span class="line"><span>docker stop node-exporter</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#二进制安装环境</span></span>
<span class="line"><span>systemctl stop node_exporter</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>查看prometheus的alerts: <a href="http://192.168.11.61:9090/alerts" target="_blank" rel="noopener noreferrer">http://192.168.11.61:9090/alerts</a></p><p>查看alertmanager的alerts：<a href="http://192.168.11.61:9093/#/alerts" target="_blank" rel="noopener noreferrer">http://192.168.11.61:9093/#/alerts</a></p><p>如果没收到钉钉消息，排查</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker logs -f alertmanager</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>钉钉正常收到报警信息如下图：</p><figure><img src="`+v+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="_7、碰到的问题" tabindex="-1"><a class="header-anchor" href="#_7、碰到的问题"><span>7、碰到的问题</span></a></h2><p>由于配置名称错误导致不能发送报警信息给钉钉，如下图：<img src="'+f+'" alt="" loading="lazy"></p><p>解决：</p><p>修改名称，使其配置正确</p><h1 id="四、我的微信" tabindex="-1"><a class="header-anchor" href="#四、我的微信"><span>四、我的微信</span></a></h1><p>如果碰到问题，可以随时加我微信，谢谢</p><figure><img src="'+_+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',101),w=[x];function E(z,C){return a(),s("div",null,w)}const P=e(y,[["render",E],["__file","5.4.企业钉钉告警.html.vue"]]),A=JSON.parse('{"path":"/note/Prometheus/5.4.%E4%BC%81%E4%B8%9A%E9%92%89%E9%92%89%E5%91%8A%E8%AD%A6.html","title":"5.4.企业钉钉告警","lang":"zh-CN","frontmatter":{"title":"5.4.企业钉钉告警","order":30,"icon":"lightbulb","description":"一、环境介绍 二、获取钉钉的webhook地址 1、注册企业钉钉 a、注册企业钉钉 浏览器打开钉钉注册页面 填入手机号码，填入获取到的验证码，点注册 填入企业资料并注册 注册成功后，扫描二维码下载钉钉，如下图： b、添加机器人 因为机器人添加，只能是钉钉电脑版（手机版钉钉不能添加机器人）。“测试钉钉报警“ 这个企业只有我一个人，所以我就把报警消息发到默...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/vuepress/note/Prometheus/5.4.%E4%BC%81%E4%B8%9A%E9%92%89%E9%92%89%E5%91%8A%E8%AD%A6.html"}],["meta",{"property":"og:site_name","content":"风华"}],["meta",{"property":"og:title","content":"5.4.企业钉钉告警"}],["meta",{"property":"og:description","content":"一、环境介绍 二、获取钉钉的webhook地址 1、注册企业钉钉 a、注册企业钉钉 浏览器打开钉钉注册页面 填入手机号码，填入获取到的验证码，点注册 填入企业资料并注册 注册成功后，扫描二维码下载钉钉，如下图： b、添加机器人 因为机器人添加，只能是钉钉电脑版（手机版钉钉不能添加机器人）。“测试钉钉报警“ 这个企业只有我一个人，所以我就把报警消息发到默..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"风华"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"5.4.企业钉钉告警\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"风华\\",\\"url\\":\\"/portfolio\\"}]}"]]},"headers":[{"level":2,"title":"1、注册企业钉钉","slug":"_1、注册企业钉钉","link":"#_1、注册企业钉钉","children":[{"level":3,"title":"a、注册企业钉钉","slug":"a、注册企业钉钉","link":"#a、注册企业钉钉","children":[]},{"level":3,"title":"b、添加机器人","slug":"b、添加机器人","link":"#b、添加机器人","children":[]},{"level":3,"title":"c、复制机器人webhook地址","slug":"c、复制机器人webhook地址","link":"#c、复制机器人webhook地址","children":[]}]},{"level":2,"title":"1、二进制安装（和docker安装二选一）","slug":"_1、二进制安装-和docker安装二选一","link":"#_1、二进制安装-和docker安装二选一","children":[]},{"level":2,"title":"2、docker安装（和二进制安装二选一，推荐）","slug":"_2、docker安装-和二进制安装二选一-推荐","link":"#_2、docker安装-和二进制安装二选一-推荐","children":[{"level":3,"title":"创建配置文件config.yml","slug":"创建配置文件config-yml","link":"#创建配置文件config-yml","children":[]},{"level":3,"title":"docker-compose.yaml文件","slug":"docker-compose-yaml文件","link":"#docker-compose-yaml文件","children":[]}]},{"level":2,"title":"3、访问地址","slug":"_3、访问地址","link":"#_3、访问地址","children":[]},{"level":2,"title":"4、alertmanager配置","slug":"_4、alertmanager配置","link":"#_4、alertmanager配置","children":[{"level":3,"title":"检查配置","slug":"检查配置","link":"#检查配置","children":[]},{"level":3,"title":"重载alertmanager配置","slug":"重载alertmanager配置","link":"#重载alertmanager配置","children":[]}]},{"level":2,"title":"5、配置触发器","slug":"_5、配置触发器","link":"#_5、配置触发器","children":[{"level":3,"title":"访问告警模块的web页面","slug":"访问告警模块的web页面","link":"#访问告警模块的web页面","children":[]}]},{"level":2,"title":"6、测试","slug":"_6、测试","link":"#_6、测试","children":[]},{"level":2,"title":"7、碰到的问题","slug":"_7、碰到的问题","link":"#_7、碰到的问题","children":[]}],"git":{},"readingTime":{"minutes":5.67,"words":1702},"filePathRelative":"note/Prometheus/5.4.企业钉钉告警.md","autoDesc":true}');export{P as comp,A as data};
