import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,o as a,d as n}from"./app-mt04-1UL.js";const i="/assets/2023-10-28_202232_4928460.5495842907788178-BHEy7yzr.png",l="/assets/2023-10-28_202232_5762670.10282154526992338-BuLbx50y.png",d="/assets/2023-10-28_202232_3157980.3417943973584434-fzbfidHN.png",p={},r=n(`<h1 id="一、环境" tabindex="-1"><a class="header-anchor" href="#一、环境"><span>一、环境</span></a></h1><table id="fd29fa5a" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:748px;"><tbody><tr style="height:33px;"><td width="187" style="border:1px solid #d9d9d9;"><p id="u0a620f04" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">主机名</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u6efcb0ef" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">IP地址</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u7e37468c" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">系统</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u12325d61" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">说明</span></p></td></tr><tr style="height:33px;"><td width="187" style="border:1px solid #d9d9d9;"><p id="u67da842f" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">localhost</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="ua86e65c9" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">192.168.11.61</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="ude36e408" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">Ubuntu 20.04</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u8b08a4d5" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">docker安装的prometheus</span></p></td></tr><tr style="height:33px;"><td width="187" style="border:1px solid #d9d9d9;"><p id="ue26672a3" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">test</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u852818fd" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">192.168.11.62</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="ue10d80ab" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">Ubuntu 20.04</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="uc9bc93bf" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">redis版本5.0，Docker 版本 23.0.1</span></p></td></tr></tbody></table><h2 id="_1、环境搭建" tabindex="-1"><a class="header-anchor" href="#_1、环境搭建"><span>1、环境搭建</span></a></h2><h3 id="docker安装" tabindex="-1"><a class="header-anchor" href="#docker安装"><span>docker安装</span></a></h3><p>略</p><h3 id="docker-compose安装" tabindex="-1"><a class="header-anchor" href="#docker-compose安装"><span>docker-compose安装</span></a></h3><p>略</p><h3 id="redis" tabindex="-1"><a class="header-anchor" href="#redis"><span>redis</span></a></h3><p>已经在监控nginx那节课安装好了</p><p>docker-compose.yaml</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>version: &#39;3&#39;</span></span>
<span class="line"><span>services:</span></span>
<span class="line"><span>  redis:</span></span>
<span class="line"><span>    image: redis:5</span></span>
<span class="line"><span>    container_name: redis</span></span>
<span class="line"><span>    command: redis-server --requirepass 123456 --maxmemory 512mb</span></span>
<span class="line"><span>    restart: always</span></span>
<span class="line"><span>    volumes:</span></span>
<span class="line"><span>      - /data/redis/data:/data</span></span>
<span class="line"><span>    ports:</span></span>
<span class="line"><span>      - 6379:6379</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker-compose up -d</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h1 id="二、监控redis" tabindex="-1"><a class="header-anchor" href="#二、监控redis"><span>二、监控redis</span></a></h1><h2 id="_1、二进制安装-二选一" tabindex="-1"><a class="header-anchor" href="#_1、二进制安装-二选一"><span>1、二进制安装（二选一）</span></a></h2><p>redis_exporter下载地址：<a href="https://github.com/oliver006/redis_exporter/releases" target="_blank" rel="noopener noreferrer">https://github.com/oliver006/redis_exporter/releases</a></p><h3 id="下载二进制包解压并放入-opt目录" tabindex="-1"><a class="header-anchor" href="#下载二进制包解压并放入-opt目录"><span>下载二进制包解压并放入/opt目录</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>wget https://github.com/oliver006/redis_exporter/releases/download/v1.48.0/redis_exporter-v1.48.0.linux-amd64.tar.gz</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>tar xvf redis_exporter-v1.48.0.linux-amd64.tar.gz</span></span>
<span class="line"><span></span></span>
<span class="line"><span>mkdir /opt/prometheus/</span></span>
<span class="line"><span></span></span>
<span class="line"><span>mv redis_exporter-v1.48.0.linux-amd64 /opt/prometheus/redis_exporter</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="创建用户" tabindex="-1"><a class="header-anchor" href="#创建用户"><span>创建用户</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>useradd -M -s /usr/sbin/nologin prometheus</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="更改exporter文件夹权限" tabindex="-1"><a class="header-anchor" href="#更改exporter文件夹权限"><span>更改exporter文件夹权限</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>chown prometheus:prometheus -R /opt/prometheus</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="创建-systemd-服务" tabindex="-1"><a class="header-anchor" href="#创建-systemd-服务"><span>创建 systemd 服务</span></a></h3><p>redis_exporter.service</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat &gt; /etc/systemd/system/redis_exporter.service &lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span>[Unit]</span></span>
<span class="line"><span>Description=Prometheus Redis Exporter</span></span>
<span class="line"><span>After=network.target</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Service]</span></span>
<span class="line"><span>Type=simple</span></span>
<span class="line"><span>User=prometheus</span></span>
<span class="line"><span>Group=prometheus</span></span>
<span class="line"><span>Restart=always</span></span>
<span class="line"><span>ExecStart=/opt/prometheus/redis_exporter/redis_exporter \\</span></span>
<span class="line"><span>-redis.addr localhost:6379 \\</span></span>
<span class="line"><span>-redis.password 123456</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Install]</span></span>
<span class="line"><span>WantedBy=multi-user.target</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="启动-redis-exporter" tabindex="-1"><a class="header-anchor" href="#启动-redis-exporter"><span>启动 redis_exporter</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl daemon-reload</span></span>
<span class="line"><span>systemctl start redis_exporter</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="加入到开机自启动" tabindex="-1"><a class="header-anchor" href="#加入到开机自启动"><span>加入到开机自启动</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl enable redis_exporter</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="检查" tabindex="-1"><a class="header-anchor" href="#检查"><span>检查</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl status redis_exporter</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>启动不了检查日志</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>journalctl -u redis_exporter -f</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_2、docker安装-二选一" tabindex="-1"><a class="header-anchor" href="#_2、docker安装-二选一"><span>2、docker安装（二选一）</span></a></h2><h3 id="docker直接运行" tabindex="-1"><a class="header-anchor" href="#docker直接运行"><span>docker直接运行</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker run -d --restart=always --name redis_exporter -p 9121:9121 oliver006/redis_exporter --redis.addr redis://192.168.11.62:6379 --redis.password &#39;123456&#39;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="docker-compose方式" tabindex="-1"><a class="header-anchor" href="#docker-compose方式"><span>docker-compose方式</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat &gt;docker-compose.yaml &lt;&lt;EOF</span></span>
<span class="line"><span>version: &#39;3.3&#39;</span></span>
<span class="line"><span>services:</span></span>
<span class="line"><span>  redis_exporter:</span></span>
<span class="line"><span>    image: oliver006/redis_exporter</span></span>
<span class="line"><span>    container_name: redis_exporter</span></span>
<span class="line"><span>    restart: always</span></span>
<span class="line"><span>    environment:</span></span>
<span class="line"><span>      REDIS_ADDR: &quot;192.168.11.62:6379&quot;</span></span>
<span class="line"><span>      REDIS_PASSWORD: 123456</span></span>
<span class="line"><span>    ports:</span></span>
<span class="line"><span>      - &quot;9121:9121&quot;</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker-compose up -d</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>检查</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker ps</span></span>
<span class="line"><span>或：</span></span>
<span class="line"><span>docker logs -f redis_exporter</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3、参数解释" tabindex="-1"><a class="header-anchor" href="#_3、参数解释"><span>3、参数解释</span></a></h2><table id="8046c54a" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:750px;"><tbody><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u4fc71661" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">Environment variable</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ud3f36e19" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">值</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u18ad2588" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">description</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u7eed82b2" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">REDIS_ADDR</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u0b65c2eb" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">192.168.11.62:6379</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u0b9ad2bb" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">redis服务器地址，如：ip:6379</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u2062025a" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">REDIS_PASSWORD</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uc31970d1" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">123456</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uaad19eb7" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">redis服务器管理密码</span></p></td></tr></tbody></table><h2 id="_4、metrics地址" tabindex="-1"><a class="header-anchor" href="#_4、metrics地址"><span>4、metrics地址</span></a></h2><p>注：安装好Exporter后会暴露一个<code>http://ip:端口/metrics</code>的HTTP服务</p><table id="3f5084fe" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:750px;"><tbody><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="ucb82509f" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">名称</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u328e4b48" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">地址</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u9a059f16" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">备注</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u5f3eddc4" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">redis_exporter</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u87f11811" class="ne-p" style="margin:0;padding:0;min-height:24px;"><a href="http://192.168.11.62:9121/metrics" data-href="http://192.168.11.62:9121/metrics" target="_blank" class="ne-link"><span class="ne-text">http://192.168.11.62:9121/metrics</span></a></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr></tbody></table><h2 id="_5、prometheus配置" tabindex="-1"><a class="header-anchor" href="#_5、prometheus配置"><span>5、Prometheus配置</span></a></h2><p>配置prometheus去采集（拉取）redis_exporter的监控样本数据</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cd /data/docker-prometheus </span></span>
<span class="line"><span></span></span>
<span class="line"><span>#在scrape_configs(搜刮配置):下面增加如下配置：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>cat &gt;&gt; prometheus/prometheus.yml &lt;&lt; &quot;EOF&quot;</span></span>
<span class="line"><span>  - job_name: &#39;redis_exporter&#39;</span></span>
<span class="line"><span>    static_configs:</span></span>
<span class="line"><span>    - targets: [&#39;192.168.11.62:9121&#39;]</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        instance: test服务器</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重新加载配置</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>curl -X POST http://localhost:9090/-/reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="检查-1" tabindex="-1"><a class="header-anchor" href="#检查-1"><span>检查</span></a></h3><figure><img src="`+i+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="_6、常用的监控指标" tabindex="-1"><a class="header-anchor" href="#_6、常用的监控指标"><span>6、常用的监控指标</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>redis_up                                    # 服务器是否在线</span></span>
<span class="line"><span>redis_uptime_in_seconds                     # 运行时长，单位 s</span></span>
<span class="line"><span>rate(redis_cpu_sys_seconds_total[1m]) + rate(redis_cpu_user_seconds_total[1m])  # 占用 CPU 核数</span></span>
<span class="line"><span>redis_memory_used_bytes                     # 占用内存量</span></span>
<span class="line"><span>redis_memory_max_bytes                      # 限制的最大内存，如果没限制则为 0</span></span>
<span class="line"><span>delta(redis_net_input_bytes_total[1m])      # 网络接收的 bytes</span></span>
<span class="line"><span>delta(redis_net_output_bytes_total[1m])     # 网络发送的 bytes</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>redis_connected_clients                     # 客户端连接数</span></span>
<span class="line"><span>redis_connected_clients / redis_config_maxclients # 连接数使用率</span></span>
<span class="line"><span>redis_rejected_connections_total            # 拒绝的客户端连接数</span></span>
<span class="line"><span>redis_connected_slaves                      # slave 连接数</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7、触发器配置" tabindex="-1"><a class="header-anchor" href="#_7、触发器配置"><span>7、触发器配置</span></a></h2><p>Prometheus配置</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># 报警(触发器)配置</span></span>
<span class="line"><span>rule_files:</span></span>
<span class="line"><span>  - &quot;alert.yml&quot;  </span></span>
<span class="line"><span>  - &quot;rules/*.yml&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="redis触发器-告警规则" tabindex="-1"><a class="header-anchor" href="#redis触发器-告警规则"><span>redis触发器（告警规则）</span></a></h3><p>因为是单机，所以未配置集群的触发器</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat &gt;&gt; prometheus/rules/redis.yml &lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span>groups:</span></span>
<span class="line"><span>- name: redis</span></span>
<span class="line"><span>  rules:</span></span>
<span class="line"><span>  - alert: RedisDown</span></span>
<span class="line"><span>    expr: redis_up == 0</span></span>
<span class="line"><span>    for: 0m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: critical</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &#39;Redis Down,实例:{{ $labels.instance }}&#39;</span></span>
<span class="line"><span>      description: &quot;Redis实例 is down&quot;</span></span>
<span class="line"><span>  - alert: RedisMissingBackup</span></span>
<span class="line"><span>    expr: time() - redis_rdb_last_save_timestamp_seconds &gt; 60 * 60 * 24</span></span>
<span class="line"><span>    for: 0m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: critical</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;Redis备份丢失,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;Redis 24小时未备份&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>  - alert: RedisOutOfConfiguredMaxmemory</span></span>
<span class="line"><span>    expr: redis_memory_used_bytes / redis_memory_max_bytes * 100 &gt; 90</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;Redis超出配置的最大内存,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;Redis内存使用超过配置最大内存的90%&quot;</span></span>
<span class="line"><span>  - alert: RedisTooManyConnections</span></span>
<span class="line"><span>    expr: redis_connected_clients &gt; 100</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;Redis连接数过多,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;Redis当前连接数为： {{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: RedisNotEnoughConnections</span></span>
<span class="line"><span>    expr: redis_connected_clients &lt; 1</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;Redis没有足够的连接,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;Redis当前连接数为： {{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: RedisRejectedConnections</span></span>
<span class="line"><span>    expr: increase(redis_rejected_connections_total[1m]) &gt; 0</span></span>
<span class="line"><span>    for: 0m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: critical</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;Redis有拒绝连接,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;与Redis 的某些连接被拒绝{{ $value }}&quot;</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>检查：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>vim prometheus/alert.yml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="检查配置" tabindex="-1"><a class="header-anchor" href="#检查配置"><span>检查配置</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker exec -it prometheus promtool check config /etc/prometheus/prometheus.yml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="重新加载配置" tabindex="-1"><a class="header-anchor" href="#重新加载配置"><span>重新加载配置</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>curl -X POST http://localhost:9090/-/reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="检查-2" tabindex="-1"><a class="header-anchor" href="#检查-2"><span>检查</span></a></h3><p><a href="http://192.168.11.61:9090/alerts?search=" target="_blank" rel="noopener noreferrer">http://192.168.11.61:9090/alerts?search=</a></p><p>或：</p><p><a href="http://192.168.11.61:9090/rules" target="_blank" rel="noopener noreferrer">http://192.168.11.61:9090/rules</a></p><h2 id="_8、dashboard" tabindex="-1"><a class="header-anchor" href="#_8、dashboard"><span>8、dashboard</span></a></h2><p>grafana展示prometheus从redis_exporter收集到的的数据</p><p>Redis:<a href="https://grafana.com/grafana/dashboards/11835" target="_blank" rel="noopener noreferrer">https://grafana.com/grafana/dashboards/11835</a></p><p>或：</p><p><a href="https://grafana.com/grafana/dashboards/17507" target="_blank" rel="noopener noreferrer">https://grafana.com/grafana/dashboards/17507</a></p><h3 id="图行展示问题" tabindex="-1"><a class="header-anchor" href="#图行展示问题"><span>图行展示问题</span></a></h3><p>redis dashbord 内存使用图行展示有问题，如下图</p><figure><img src="`+l+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><a href="http://192.168.11.61:9090/graph" target="_blank" rel="noopener noreferrer">http://192.168.11.61:9090/graph</a></p><p>查询到<code>redis_memory_max_bytes</code>为0，因为redis配置参数<code>maxmemory</code>未设置，默认<code>0</code>。</p><h3 id="解决" tabindex="-1"><a class="header-anchor" href="#解决"><span>解决</span></a></h3><p>redis增加配置<code>maxmemory</code>的值</p><h1 id="三、我的微信" tabindex="-1"><a class="header-anchor" href="#三、我的微信"><span>三、我的微信</span></a></h1><p>如果碰到问题，可以随时加我微信，谢谢</p><figure><img src="'+d+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',86),t=[r];function c(h,o){return a(),e("div",null,t)}const b=s(p,[["render",c],["__file","2.6.监控redis.html.vue"]]),v=JSON.parse('{"path":"/note/Prometheus/2.6.%E7%9B%91%E6%8E%A7redis.html","title":"2.6.监控redis","lang":"zh-CN","frontmatter":{"title":"2.6.监控redis","order":11,"icon":"lightbulb","description":"一、环境 1、环境搭建 docker安装 略 docker-compose安装 略 redis 已经在监控nginx那节课安装好了 docker-compose.yaml 二、监控redis 1、二进制安装（二选一） redis_exporter下载地址：https://github.com/oliver006/redis_exporter/relea...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/note/Prometheus/2.6.%E7%9B%91%E6%8E%A7redis.html"}],["meta",{"property":"og:site_name","content":"风华"}],["meta",{"property":"og:title","content":"2.6.监控redis"}],["meta",{"property":"og:description","content":"一、环境 1、环境搭建 docker安装 略 docker-compose安装 略 redis 已经在监控nginx那节课安装好了 docker-compose.yaml 二、监控redis 1、二进制安装（二选一） redis_exporter下载地址：https://github.com/oliver006/redis_exporter/relea..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"风华"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"2.6.监控redis\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"风华\\",\\"url\\":\\"/portfolio\\"}]}"]]},"headers":[{"level":2,"title":"1、环境搭建","slug":"_1、环境搭建","link":"#_1、环境搭建","children":[{"level":3,"title":"docker安装","slug":"docker安装","link":"#docker安装","children":[]},{"level":3,"title":"docker-compose安装","slug":"docker-compose安装","link":"#docker-compose安装","children":[]},{"level":3,"title":"redis","slug":"redis","link":"#redis","children":[]}]},{"level":2,"title":"1、二进制安装（二选一）","slug":"_1、二进制安装-二选一","link":"#_1、二进制安装-二选一","children":[{"level":3,"title":"下载二进制包解压并放入/opt目录","slug":"下载二进制包解压并放入-opt目录","link":"#下载二进制包解压并放入-opt目录","children":[]},{"level":3,"title":"创建用户","slug":"创建用户","link":"#创建用户","children":[]},{"level":3,"title":"更改exporter文件夹权限","slug":"更改exporter文件夹权限","link":"#更改exporter文件夹权限","children":[]},{"level":3,"title":"创建 systemd 服务","slug":"创建-systemd-服务","link":"#创建-systemd-服务","children":[]},{"level":3,"title":"启动 redis_exporter","slug":"启动-redis-exporter","link":"#启动-redis-exporter","children":[]},{"level":3,"title":"加入到开机自启动","slug":"加入到开机自启动","link":"#加入到开机自启动","children":[]},{"level":3,"title":"检查","slug":"检查","link":"#检查","children":[]}]},{"level":2,"title":"2、docker安装（二选一）","slug":"_2、docker安装-二选一","link":"#_2、docker安装-二选一","children":[{"level":3,"title":"docker直接运行","slug":"docker直接运行","link":"#docker直接运行","children":[]},{"level":3,"title":"docker-compose方式","slug":"docker-compose方式","link":"#docker-compose方式","children":[]}]},{"level":2,"title":"3、参数解释","slug":"_3、参数解释","link":"#_3、参数解释","children":[]},{"level":2,"title":"4、metrics地址","slug":"_4、metrics地址","link":"#_4、metrics地址","children":[]},{"level":2,"title":"5、Prometheus配置","slug":"_5、prometheus配置","link":"#_5、prometheus配置","children":[{"level":3,"title":"检查","slug":"检查-1","link":"#检查-1","children":[]}]},{"level":2,"title":"6、常用的监控指标","slug":"_6、常用的监控指标","link":"#_6、常用的监控指标","children":[]},{"level":2,"title":"7、触发器配置","slug":"_7、触发器配置","link":"#_7、触发器配置","children":[{"level":3,"title":"redis触发器（告警规则）","slug":"redis触发器-告警规则","link":"#redis触发器-告警规则","children":[]},{"level":3,"title":"检查配置","slug":"检查配置","link":"#检查配置","children":[]},{"level":3,"title":"重新加载配置","slug":"重新加载配置","link":"#重新加载配置","children":[]},{"level":3,"title":"检查","slug":"检查-2","link":"#检查-2","children":[]}]},{"level":2,"title":"8、dashboard","slug":"_8、dashboard","link":"#_8、dashboard","children":[{"level":3,"title":"图行展示问题","slug":"图行展示问题","link":"#图行展示问题","children":[]},{"level":3,"title":"解决","slug":"解决","link":"#解决","children":[]}]}],"git":{},"readingTime":{"minutes":6.19,"words":1858},"filePathRelative":"note/Prometheus/2.6.监控redis.md","autoDesc":true}');export{b as comp,v as data};
