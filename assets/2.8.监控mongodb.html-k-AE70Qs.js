import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,o as n,d as a}from"./app-DZWWIkr0.js";const i="/bj/assets/2023-10-28_202125_8060200.21238878257011795-D4K0BUDk.png",d="/bj/assets/2023-10-28_210448_0344880.6239992097474373-C9Ts4dJW.png",l={},t=a(`<h1 id="一、环境" tabindex="-1"><a class="header-anchor" href="#一、环境"><span>一、环境</span></a></h1><table id="bf62420f" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:748px;"><tbody><tr style="height:33px;"><td width="187" style="border:1px solid #d9d9d9;"><p id="uc7ba5919" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">主机名</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="ud2ce4794" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">IP地址</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u8006ce2a" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">系统</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u5f55bdbc" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">说明</span></p></td></tr><tr style="height:33px;"><td width="187" style="border:1px solid #d9d9d9;"><p id="u8b751ee3" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">localhost</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="uee470b49" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">192.168.11.61</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="uaa834c6d" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">Ubuntu 20.04</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="uf89141b7" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">docker安装的prometheus</span></p></td></tr><tr style="height:33px;"><td width="187" style="border:1px solid #d9d9d9;"><p id="ue9574d4d" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">test</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u28a8ba17" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">192.168.11.62</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u18f4fad9" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">Ubuntu 20.04</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u744eab45" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">mongo版本4.2.5，Docker 版本 23.0.1</span></p></td></tr></tbody></table><h2 id="_1、环境搭建" tabindex="-1"><a class="header-anchor" href="#_1、环境搭建"><span>1、环境搭建</span></a></h2><h3 id="docker安装" tabindex="-1"><a class="header-anchor" href="#docker安装"><span>docker安装</span></a></h3><p>略</p><h3 id="docker-compose安装" tabindex="-1"><a class="header-anchor" href="#docker-compose安装"><span>docker-compose安装</span></a></h3><p>略</p><h3 id="mongodb" tabindex="-1"><a class="header-anchor" href="#mongodb"><span>mongodb</span></a></h3><p>已经在监控nginx那节课安装好了</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cd /data/mongodb</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>使用cat创建文件</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat &gt;&gt;docker-compose.yaml&lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span>version: &#39;3&#39;</span></span>
<span class="line"><span>services:</span></span>
<span class="line"><span>  mongo:</span></span>
<span class="line"><span>    image: mongo:4.2.5</span></span>
<span class="line"><span>    container_name: mongo</span></span>
<span class="line"><span>    restart: always</span></span>
<span class="line"><span>    volumes:</span></span>
<span class="line"><span>      - /data/mongo/db:/data/db</span></span>
<span class="line"><span>    ports:</span></span>
<span class="line"><span>      - 27017:27017</span></span>
<span class="line"><span>    command: [--auth]</span></span>
<span class="line"><span>    environment:</span></span>
<span class="line"><span>      MONGO_INITDB_ROOT_USERNAME: root</span></span>
<span class="line"><span>      MONGO_INITDB_ROOT_PASSWORD: 123456</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker-compose up -d</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h1 id="二、监控mongodb" tabindex="-1"><a class="header-anchor" href="#二、监控mongodb"><span>二、监控mongodb</span></a></h1><h2 id="_1、创建监控用户" tabindex="-1"><a class="header-anchor" href="#_1、创建监控用户"><span>1、创建监控用户</span></a></h2><p>登陆mongodb创建监控用户，权限为“readAnyDatabase”，如果是cluster环境，需要有权限“clusterMonitor”</p><p>登录mongodb（docker安装的mongo）</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker exec -it mongo mongo admin</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>登录mongodb（yum和apt安装的mongo）</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>mongo admin</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>创建监控用户</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>&gt; db.auth(&#39;root&#39;,&#39;123456&#39;)</span></span>
<span class="line"><span>1</span></span>
<span class="line"><span>&gt; db.createUser({ user:&#39;exporter&#39;,pwd:&#39;password&#39;,roles:[ { role:&#39;readAnyDatabase&#39;, db: &#39;admin&#39;},{ role: &quot;clusterMonitor&quot;, db: &quot;admin&quot; }]});</span></span>
<span class="line"><span>#测试 使用上面创建的用户信息进行连接。</span></span>
<span class="line"><span>&gt; db.auth(&#39;exporter&#39;, &#39;password&#39;)</span></span>
<span class="line"><span>1</span></span>
<span class="line"><span>#表示成功</span></span>
<span class="line"><span>&gt; exit</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2、二进制安装-二选一" tabindex="-1"><a class="header-anchor" href="#_2、二进制安装-二选一"><span>2、二进制安装（二选一）</span></a></h2><p>mongodb_exporter地址:<a href="https://github.com/percona/mongodb_exporter/releases" target="_blank" rel="noopener noreferrer">https://github.com/percona/mongodb_exporter/releases</a></p><p>或：<a href="https://github.com/prometheus/mysqld_exporter/releases" target="_blank" rel="noopener noreferrer">https://github.com/prometheus/mysqld_exporter/releases</a></p><h3 id="下载二进制包解压并放入-opt目录" tabindex="-1"><a class="header-anchor" href="#下载二进制包解压并放入-opt目录"><span>下载二进制包解压并放入/opt目录</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>wget https://github.com/percona/mongodb_exporter/releases/download/v0.37.0/mongodb_exporter-0.37.0.linux-amd64.tar.gz</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>tar xf mongodb_exporter-0.37.0.linux-amd64.tar.gz</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>mv mongodb_exporter-0.37.0.linux-amd64 /opt/prometheus/mongodb_exporter</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="创建用户" tabindex="-1"><a class="header-anchor" href="#创建用户"><span>创建用户</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>useradd -M -s /usr/sbin/nologin prometheus</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="更改exporter文件夹权限" tabindex="-1"><a class="header-anchor" href="#更改exporter文件夹权限"><span>更改exporter文件夹权限</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>chown prometheus:prometheus -R /opt/prometheus</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="创建-systemd-服务" tabindex="-1"><a class="header-anchor" href="#创建-systemd-服务"><span>创建 systemd 服务</span></a></h3><p>mongodb_exporter.service</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat &lt;&lt;EOF &gt;/usr/lib/systemd/system/mongodb_exporter.service</span></span>
<span class="line"><span>[Unit]</span></span>
<span class="line"><span>Description=mongodb_exporter</span></span>
<span class="line"><span>Documentation=https://github.com/percona/mongodb_exporter</span></span>
<span class="line"><span>After=network.target</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Service]</span></span>
<span class="line"><span>Type=simple</span></span>
<span class="line"><span>User=prometheus</span></span>
<span class="line"><span>Environment=&quot;MONGODB_URI=mongodb://exporter:password@localhost:27017/admin&quot;</span></span>
<span class="line"><span>ExecStart=/opt/prometheus/mongodb_exporter/mongodb_exporter --log.level=error --collect-all --compatible-mode</span></span>
<span class="line"><span>Restart=on-failure</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Install]</span></span>
<span class="line"><span>WantedBy=multi-user.target</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="启动-mongodb-exporter" tabindex="-1"><a class="header-anchor" href="#启动-mongodb-exporter"><span>启动 mongodb_exporter</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl daemon-reload</span></span>
<span class="line"><span></span></span>
<span class="line"><span>systemctl start mongodb_exporter.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="加入到开机自启动" tabindex="-1"><a class="header-anchor" href="#加入到开机自启动"><span>加入到开机自启动</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl enable mongodb_exporter.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="检查" tabindex="-1"><a class="header-anchor" href="#检查"><span>检查</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl status mongodb_exporter.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>启动不了检查日志</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>journalctl -u mongodb_exporter.service -f</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_3、docker安装-二选一" tabindex="-1"><a class="header-anchor" href="#_3、docker安装-二选一"><span>3、docker安装（二选一）</span></a></h2><h3 id="docker直接运行" tabindex="-1"><a class="header-anchor" href="#docker直接运行"><span>docker直接运行</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker run -d --restart=always -p 9216:9216 -p 17001:17001 --restart=always --name=mongodb-exporter  bitnami/mongodb-exporter:latest --collect-all --compatible-mode --mongodb.uri=mongodb://exporter:password@192.168.11.62:27017/admin?ssl=false</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="docker-compose方式" tabindex="-1"><a class="header-anchor" href="#docker-compose方式"><span>docker-compose方式</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat &gt;docker-compose.yaml &lt;&lt;EOF</span></span>
<span class="line"><span>version: &#39;3.3&#39;</span></span>
<span class="line"><span>services:</span></span>
<span class="line"><span>  mongodb_exporter:</span></span>
<span class="line"><span>    image: bitnami/mongodb-exporter:latest</span></span>
<span class="line"><span>    container_name: mongodb_exporter</span></span>
<span class="line"><span>    restart: always</span></span>
<span class="line"><span>    environment:</span></span>
<span class="line"><span>      MONGODB_URI: &quot;mongodb://exporter:password@192.168.11.62:27017/admin?ssl=false&quot;</span></span>
<span class="line"><span>    command:</span></span>
<span class="line"><span>      - &#39;--collect-all&#39;</span></span>
<span class="line"><span>      - &#39;--compatible-mode&#39;</span></span>
<span class="line"><span>    ports:</span></span>
<span class="line"><span>      - &quot;9216:9216&quot;</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker-compose up -d</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>检查</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker ps</span></span>
<span class="line"><span>或：</span></span>
<span class="line"><span>docker logs -f mongodb_exporter</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4、参数解释" tabindex="-1"><a class="header-anchor" href="#_4、参数解释"><span>4、参数解释</span></a></h2><table id="c1ed3f8c" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:750px;"><tbody><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u253214dd" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">Flag</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u09b43b9b" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">含义</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u166a19a7" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">案例</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u6ae00182" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">-h, --help</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u7c685869" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">显示上下文相关的帮助</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="ucde0d127" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--[no-]compatible-mode</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u50136c71" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">启用旧的 mongodb-exporter 兼容指标</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u86159ddf" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--[no-]discovering-mode</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u3a0b3bd0" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">启用自动发现集合</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u8b056ab8" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--mongodb.collstats-colls</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u924a9534" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">逗号分隔的 databases.collections 列表以获取 $collStats</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uf28b6501" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--mongodb.collstats-colls=db1,db2.col2</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u2e7b8c34" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--mongodb.indexstats-colls</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u4a9f054e" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">逗号分隔的 databases.collections 列表以获取 $indexStats</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uab1272df" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--mongodb.indexstats-colls=db1.col1,db2.col2</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u873ff5fa" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--[no-]mongodb.direct-connect</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u29da6f8c" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">是否应该进行直接连接。如果指定了多个主机或使用了 SRV URI，则直接连接无效</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="ua42f6de7" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--[no-]mongodb.global-conn-pool</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u499d8041" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">使用全局连接池而不是为每个 http 请求创建新池</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u4ec0a989" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--mongodb.uri</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u2b2b6dfa" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">MongoDB 连接 URI ($MONGODB_URI)</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ue55fda5f" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--mongodb.uri=mongodb://user:pass@127.0.0.1:27017/admin?ssl=true</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u75f37cc5" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--web.listen-address</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uee63362b" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">用于侦听 Web 界面和遥测的地址</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uf22ea372" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--web.listen-address=&quot;:9216&quot;</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="ud01a5aee" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--web.telemetry-path</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u62617091" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">指标公开路径</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u25fbaf87" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--web.telemetry-path=&quot;/metrics&quot;</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u372e696d" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--web.config</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u9136ff29" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">具有用于基本身份验证的 Prometheus TLS 配置的文件的路径</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u4587d5a2" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--web.config=STRING</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="ub9fde574" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--log.level</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ua4ee067b" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">仅记录具有给定严重性或更高严重性的消息。有效级别：[调试、信息、警告、错误、致命]</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u950da624" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--log.level=&quot;error&quot;</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u3aa38e73" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--collector.diagnosticdata</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u546c77de" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">启用从 getDiagnosticData 收集指标</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u993fbff1" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--collector.replicasetstatus</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u1d255197" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">启用从 replSetGetStatus 收集指标</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u24fd7d41" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--collector.dbstats</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uaf74369a" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">启用从 dbStats 收集指标</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="uf44bb0b1" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--collector.topmetrics</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u715aeece" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">启用从 top admin command 收集指标</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="ub71a7a1d" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--collector.indexstats</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u621a266d" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">启用从 $indexStats 收集指标</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u45ab6230" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--collector.collstats</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uca0a5893" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">启用从 $collStats 收集指标</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u63f4bef7" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--collect-all</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u7902b261" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">启用所有收集器。与指定所有 --collector. 相同</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u02bb0cda" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--collector.collstats-limit=0</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u86308e09" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">如果有超过 个集合，请禁用 collstats、dbstats、topmetrics 和 indexstats 收集器。0=无限制</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="uc8bba58b" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--metrics.overridedescendingindex</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ucf5e74da" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">启用降序索引名称覆盖以将 -1 替换为 _DESC</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u3b442750" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">--version</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u6cf87e4c" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">显示版本并退出</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr></tbody></table><h2 id="_5、metrics地址" tabindex="-1"><a class="header-anchor" href="#_5、metrics地址"><span>5、metrics地址</span></a></h2><p>注：安装好Exporter后会暴露一个<code>http://ip:端口/metrics</code>的HTTP服务</p><table id="f8490d7a" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:750px;"><tbody><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="uf5623543" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">名称</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ua2933ad9" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">地址</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u0594ed8c" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">备注</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u067919fc" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">mongodb_exporter</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u0b19d2b7" class="ne-p" style="margin:0;padding:0;min-height:24px;"><a href="http://192.168.11.62:9216/metrics" data-href="http://192.168.11.62:9216/metrics" target="_blank" class="ne-link"><span class="ne-text">http://192.168.11.62:9216/metrics</span></a></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr></tbody></table><h2 id="_6、prometheus配置" tabindex="-1"><a class="header-anchor" href="#_6、prometheus配置"><span>6、Prometheus配置</span></a></h2><p>配置prometheus去采集（拉取）mongodb_exporter的监控样本数据</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cd /data/docker-prometheus </span></span>
<span class="line"><span></span></span>
<span class="line"><span>#在scrape_configs(搜刮配置):下面增加如下配置：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>cat &gt;&gt; prometheus/prometheus.yml &lt;&lt; &quot;EOF&quot;</span></span>
<span class="line"><span>  - job_name: &#39;mongodb_exporter&#39;</span></span>
<span class="line"><span>    static_configs:</span></span>
<span class="line"><span>    - targets: [&#39;192.168.11.62:9216&#39;]</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        instance: test服务器</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重新加载配置</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>curl -X POST http://localhost:9090/-/reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="检查-1" tabindex="-1"><a class="header-anchor" href="#检查-1"><span>检查</span></a></h3><figure><img src="`+i+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="_7、常用的监控指标" tabindex="-1"><a class="header-anchor" href="#_7、常用的监控指标"><span>7、常用的监控指标</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>mongodb_ss_connections{conn_type=&quot;available&quot;} 可用的连接总数</span></span>
<span class="line"><span></span></span>
<span class="line"><span>mongodb_ss_mem_virtual</span></span>
<span class="line"><span>mongodb_ss_mem_resident</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span># 关于 server status</span></span>
<span class="line"><span>mongodb_up                                              # 服务器是否在线</span></span>
<span class="line"><span>mongodb_ss_ok{cl_id=&quot;&quot;, cl_role=&quot;mongod&quot;, rs_state=&quot;0&quot;} # 服务器是否正常运行，取值为 1、0 。标签中记录了 Cluster、ReplicaSet 的信息</span></span>
<span class="line"><span>mongodb_ss_uptime                                       # 服务器的运行时长，单位为秒</span></span>
<span class="line"><span>mongodb_ss_connections{conn_type=&quot;current&quot;}             # 客户端连接数</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 关于主机</span></span>
<span class="line"><span>mongodb_sys_cpu_num_cpus                                # 主机的 CPU 核数</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 关于 collection</span></span>
<span class="line"><span>mongodb_collstats_storageStats_count{database=&quot;xx&quot;, collection=&quot;xx&quot;}  # collection 全部文档的数量</span></span>
<span class="line"><span>mongodb_collstats_storageStats_size                     # collection 全部文档的体积，单位 bytes</span></span>
<span class="line"><span>mongodb_collstats_storageStats_storageSize              # collection 全部文档占用的磁盘空间，默认会压缩</span></span>
<span class="line"><span>delta(mongodb_collstats_latencyStats_reads_ops[1m])     # collection 读操作的数量（每分钟）</span></span>
<span class="line"><span>delta(mongodb_collstats_latencyStats_reads_latency[1m]) # collection 读操作的延迟（每分钟），单位为微秒</span></span>
<span class="line"><span>mongodb_collstats_latencyStats_write_ops</span></span>
<span class="line"><span>mongodb_collstats_latencyStats_write_latency</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 关于 index</span></span>
<span class="line"><span>mongodb_collstats_storageStats_nindexes                 # collection 的 index 数量</span></span>
<span class="line"><span>mongodb_collstats_storageStats_totalIndexSize           # collection 的 index 占用的磁盘空间</span></span>
<span class="line"><span>delta(mongodb_indexstats_accesses_ops[1m])   # index 被访问次数</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 关于操作</span></span>
<span class="line"><span>delta(mongodb_ss_opcounters[1m])                        # 执行各种操作的数量</span></span>
<span class="line"><span>delta(mongodb_ss_opLatencies_latency[1m])               # 执行各种操作的延迟，单位为微秒</span></span>
<span class="line"><span>delta(mongodb_ss_metrics_document[1m])                  # 各种文档的变化数量</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 关于锁</span></span>
<span class="line"><span>delta(mongodb_ss_locks_acquireCount{lock_mode=&quot;w&quot;}[1m]) # 新加锁的数量。R 表示共享锁，W 表示独占锁，r 表示意向共享锁，w 表示意向独占锁</span></span>
<span class="line"><span>mongodb_ss_globalLock_currentQueue{count_type=&quot;total&quot;}  # 被锁阻塞的操作数</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8、触发器配置" tabindex="-1"><a class="header-anchor" href="#_8、触发器配置"><span>8、触发器配置</span></a></h2><p>Prometheus配置</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span># 报警(触发器)配置</span></span>
<span class="line"><span>rule_files:</span></span>
<span class="line"><span>  - &quot;alert.yml&quot;  </span></span>
<span class="line"><span>  - &quot;rules/*.yml&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="mongodb触发器-告警规则" tabindex="-1"><a class="header-anchor" href="#mongodb触发器-告警规则"><span>mongodb触发器（告警规则）</span></a></h3><p>因mongo单点，所以未配置复制触发器</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat &gt;&gt; prometheus/rules/mongodb.yml &lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span>groups:</span></span>
<span class="line"><span>- name: PerconaMongodbExporter</span></span>
<span class="line"><span>  rules:</span></span>
<span class="line"><span>    - alert: MongodbDown</span></span>
<span class="line"><span>      expr: &#39;mongodb_up == 0&#39;</span></span>
<span class="line"><span>      for: 0m</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        severity: critical</span></span>
<span class="line"><span>      annotations:</span></span>
<span class="line"><span>        summary: &quot;MongoDB Down 容器: $labels.instance&quot;</span></span>
<span class="line"><span>        description: &quot;MongoDB 容器 is down, 当前值:{{ $value }}&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    - alert: MongodbNumberCursorsOpen</span></span>
<span class="line"><span>      expr: &#39;mongodb_ss_metrics_cursor_open{csr_type=&quot;total&quot;} &gt; 10 * 1000&#39;</span></span>
<span class="line"><span>      for: 2m</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        severity: warning</span></span>
<span class="line"><span>      annotations:</span></span>
<span class="line"><span>        summary: &quot;MongoDB 数字有标打开告警 容器: $labels.instance&quot;</span></span>
<span class="line"><span>        description: &quot;MongoDB 为客户端打开的游标过多 &gt; 10k, 当前值:{{ $value }}&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    - alert: MongodbCursorsTimeouts</span></span>
<span class="line"><span>      expr: &#39;increase(mongodb_ss_metrics_cursor_timedOut[1m]) &gt; 100&#39;</span></span>
<span class="line"><span>      for: 2m</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        severity: warning</span></span>
<span class="line"><span>      annotations:</span></span>
<span class="line"><span>        summary: &quot;MongoDB 游标超时 容器: $labels.instance&quot;</span></span>
<span class="line"><span>        description: &quot;太多游标超时, 当前值:{{ $value }}&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    - alert: MongodbTooManyConnections</span></span>
<span class="line"><span>      expr: &#39;avg by(instance) (rate(mongodb_ss_connections{conn_type=&quot;current&quot;}[1m])) / avg by(instance) (sum (mongodb_ss_connections) by (instance)) * 100 &gt; 80&#39;</span></span>
<span class="line"><span>      for: 2m</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        severity: warning</span></span>
<span class="line"><span>      annotations:</span></span>
<span class="line"><span>        summary: &quot;MongoDB 太多连接 容器: $labels.instance&quot;</span></span>
<span class="line"><span>        description: &quot;MongoDB 连接数 &gt; 80%, 当前值:{{ $value }}&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>    - alert: MongodbVirtualMemoryUsage</span></span>
<span class="line"><span>      expr: &#39;(sum(mongodb_ss_mem_virtual) BY (instance) / sum(mongodb_ss_mem_resident) BY (instance)) &gt; 3&#39;</span></span>
<span class="line"><span>      for: 2m</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        severity: warning</span></span>
<span class="line"><span>      annotations:</span></span>
<span class="line"><span>        summary: &quot;MongoDB虚拟内存使用告警 容器: $labels.instance&quot;</span></span>
<span class="line"><span>        description: &quot;虚拟内存使用过高, 当前值:{{ $value }}&quot;</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>检查：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>vim prometheus/alert.yml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="检查配置" tabindex="-1"><a class="header-anchor" href="#检查配置"><span>检查配置</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker exec -it prometheus promtool check config /etc/prometheus/prometheus.yml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="重新加载配置" tabindex="-1"><a class="header-anchor" href="#重新加载配置"><span>重新加载配置</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>curl -X POST http://localhost:9090/-/reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="检查-2" tabindex="-1"><a class="header-anchor" href="#检查-2"><span>检查</span></a></h3><p><a href="http://192.168.11.61:9090/alerts?search=" target="_blank" rel="noopener noreferrer">http://192.168.11.61:9090/alerts?search=</a></p><p>或：</p><p><a href="http://192.168.11.61:9090/rules" target="_blank" rel="noopener noreferrer">http://192.168.11.61:9090/rules</a></p><h2 id="_8、dashboard" tabindex="-1"><a class="header-anchor" href="#_8、dashboard"><span>8、dashboard</span></a></h2><p>grafana展示prometheus从mongodb_exporter收集到的的数据</p><p><a href="https://github.com/percona/grafana-dashboards/tree/main/dashboards/MongoDB" target="_blank" rel="noopener noreferrer">https://github.com/percona/grafana-dashboards/tree/main/dashboards/MongoDB</a></p><h1 id="三、我的微信" tabindex="-1"><a class="header-anchor" href="#三、我的微信"><span>三、我的微信</span></a></h1><p>如果安装碰到问题，可以随时加我微信，谢谢</p><figure><img src="`+d+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',88),p=[t];function r(o,c){return n(),e("div",null,p)}const m=s(l,[["render",r],["__file","2.8.监控mongodb.html.vue"]]),g=JSON.parse('{"path":"/note/Prometheus/2.8.%E7%9B%91%E6%8E%A7mongodb.html","title":"2.8.监控mongodb","lang":"zh-CN","frontmatter":{"title":"2.8.监控mongodb","order":13,"icon":"lightbulb","description":"一、环境 1、环境搭建 docker安装 略 docker-compose安装 略 mongodb 已经在监控nginx那节课安装好了 使用cat创建文件 运行 二、监控mongodb 1、创建监控用户 登陆mongodb创建监控用户，权限为“readAnyDatabase”，如果是cluster环境，需要有权限“clusterMonitor” 登录m...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/bj/note/Prometheus/2.8.%E7%9B%91%E6%8E%A7mongodb.html"}],["meta",{"property":"og:site_name","content":"风华"}],["meta",{"property":"og:title","content":"2.8.监控mongodb"}],["meta",{"property":"og:description","content":"一、环境 1、环境搭建 docker安装 略 docker-compose安装 略 mongodb 已经在监控nginx那节课安装好了 使用cat创建文件 运行 二、监控mongodb 1、创建监控用户 登陆mongodb创建监控用户，权限为“readAnyDatabase”，如果是cluster环境，需要有权限“clusterMonitor” 登录m..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"风华"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"2.8.监控mongodb\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"风华\\",\\"url\\":\\"/portfolio\\"}]}"]]},"headers":[{"level":2,"title":"1、环境搭建","slug":"_1、环境搭建","link":"#_1、环境搭建","children":[{"level":3,"title":"docker安装","slug":"docker安装","link":"#docker安装","children":[]},{"level":3,"title":"docker-compose安装","slug":"docker-compose安装","link":"#docker-compose安装","children":[]},{"level":3,"title":"mongodb","slug":"mongodb","link":"#mongodb","children":[]}]},{"level":2,"title":"1、创建监控用户","slug":"_1、创建监控用户","link":"#_1、创建监控用户","children":[]},{"level":2,"title":"2、二进制安装（二选一）","slug":"_2、二进制安装-二选一","link":"#_2、二进制安装-二选一","children":[{"level":3,"title":"下载二进制包解压并放入/opt目录","slug":"下载二进制包解压并放入-opt目录","link":"#下载二进制包解压并放入-opt目录","children":[]},{"level":3,"title":"创建用户","slug":"创建用户","link":"#创建用户","children":[]},{"level":3,"title":"更改exporter文件夹权限","slug":"更改exporter文件夹权限","link":"#更改exporter文件夹权限","children":[]},{"level":3,"title":"创建 systemd 服务","slug":"创建-systemd-服务","link":"#创建-systemd-服务","children":[]},{"level":3,"title":"启动 mongodb_exporter","slug":"启动-mongodb-exporter","link":"#启动-mongodb-exporter","children":[]},{"level":3,"title":"加入到开机自启动","slug":"加入到开机自启动","link":"#加入到开机自启动","children":[]},{"level":3,"title":"检查","slug":"检查","link":"#检查","children":[]}]},{"level":2,"title":"3、docker安装（二选一）","slug":"_3、docker安装-二选一","link":"#_3、docker安装-二选一","children":[{"level":3,"title":"docker直接运行","slug":"docker直接运行","link":"#docker直接运行","children":[]},{"level":3,"title":"docker-compose方式","slug":"docker-compose方式","link":"#docker-compose方式","children":[]}]},{"level":2,"title":"4、参数解释","slug":"_4、参数解释","link":"#_4、参数解释","children":[]},{"level":2,"title":"5、metrics地址","slug":"_5、metrics地址","link":"#_5、metrics地址","children":[]},{"level":2,"title":"6、Prometheus配置","slug":"_6、prometheus配置","link":"#_6、prometheus配置","children":[{"level":3,"title":"检查","slug":"检查-1","link":"#检查-1","children":[]}]},{"level":2,"title":"7、常用的监控指标","slug":"_7、常用的监控指标","link":"#_7、常用的监控指标","children":[]},{"level":2,"title":"8、触发器配置","slug":"_8、触发器配置","link":"#_8、触发器配置","children":[{"level":3,"title":"mongodb触发器（告警规则）","slug":"mongodb触发器-告警规则","link":"#mongodb触发器-告警规则","children":[]},{"level":3,"title":"检查配置","slug":"检查配置","link":"#检查配置","children":[]},{"level":3,"title":"重新加载配置","slug":"重新加载配置","link":"#重新加载配置","children":[]},{"level":3,"title":"检查","slug":"检查-2","link":"#检查-2","children":[]}]},{"level":2,"title":"8、dashboard","slug":"_8、dashboard","link":"#_8、dashboard","children":[]}],"git":{},"readingTime":{"minutes":13.4,"words":4020},"filePathRelative":"note/Prometheus/2.8.监控mongodb.md","autoDesc":true}');export{m as comp,g as data};
