import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as n,o as e,d as a}from"./app-mt04-1UL.js";const i="/assets/2023-10-28_201551_2597310.5519991009169548-DBJUh6j9.png",l="/assets/2023-10-28_201551_6139180.7869238724734053-BY8P3Bsq.png",d="/assets/2023-10-28_201551_4824290.19805321142273025-D5A5E-rj.png",p={},t=a(`<h1 id="一、环境" tabindex="-1"><a class="header-anchor" href="#一、环境"><span>一、环境</span></a></h1><table id="6a7420ae" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:748px;"><tbody><tr style="height:33px;"><td width="187" style="border:1px solid #d9d9d9;"><p id="uaabb368c" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">主机名</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u028943dd" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">IP地址</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="uf34f49ca" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">系统</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="uf1476f9e" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">说明</span></p></td></tr><tr style="height:33px;"><td width="187" style="border:1px solid #d9d9d9;"><p id="uac07cbac" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">localhost</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u95535699" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">192.168.11.61</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u04922e3e" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">Ubuntu 20.04</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="ubf58573a" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">docker方式安装的prometheus。docker版本23.0.1</span></p></td></tr><tr style="height:33px;"><td width="187" style="border:1px solid #d9d9d9;"><p id="u39a0ddfe" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">test</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u6244c071" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">192.168.11.62</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u529f31ba" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">Ubuntu 20.04</span></p></td><td width="187" style="border:1px solid #d9d9d9;"><p id="u8d19d8e8" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">docker版本23.0.1，安装node_exporter对这台服务器进行监控</span></p></td></tr></tbody></table><p>真实环境会有很多需要监控的主机，我新链接克隆了一台主机ip地址修改为192.168.11.62来做测试</p><p>后面的课程都以docker安装的prometheus进行讲解</p><h2 id="_1、准备环境" tabindex="-1"><a class="header-anchor" href="#_1、准备环境"><span>1、准备环境</span></a></h2><h3 id="主机更名" tabindex="-1"><a class="header-anchor" href="#主机更名"><span>主机更名</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>hostnamectl set-hostname test</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="安装docker" tabindex="-1"><a class="header-anchor" href="#安装docker"><span>安装Docker</span></a></h3><p>镜像加速</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>sudo mkdir -p /etc/docker</span></span>
<span class="line"><span>sudo tee /etc/docker/daemon.json &lt;&lt;-&#39;EOF&#39;</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  &quot;registry-mirrors&quot;: [&quot;http://hub-mirror.c.163.com&quot;]</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>安装docker</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>export DOWNLOAD_URL=&quot;http://mirrors.163.com/docker-ce&quot;</span></span>
<span class="line"><span>curl -fsSL https://get.docker.com/ | sh</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>检查</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker -v</span></span>
<span class="line"><span>或：</span></span>
<span class="line"><span>systemctl status docker</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="安装docker-compose" tabindex="-1"><a class="header-anchor" href="#安装docker-compose"><span>安装Docker-compose</span></a></h3><p>安装命令</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#方式一（2选1）curl命令是一行，如果出现换行就不对</span></span>
<span class="line"><span>curl -L https://get.daocloud.io/docker/compose/releases/download/1.29.2/docker-compose-\`uname -s\`-\`uname -m\` &gt; /usr/local/bin/docker-compose</span></span>
<span class="line"><span>sudo chmod +x /usr/local/bin/docker-compose</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#方式二（2选1）curl命令是一行，如果出现换行就不对</span></span>
<span class="line"><span>curl -L https://github.com/docker/compose/releases/download/1.29.2/docker-compose-Linux-x86_64 &gt; /usr/local/bin/docker-compose</span></span>
<span class="line"><span>sudo chmod +x /usr/local/bin/docker-compose</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>检查</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker-compose -v</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h1 id="二、node-exporter" tabindex="-1"><a class="header-anchor" href="#二、node-exporter"><span>二、node_exporter</span></a></h1><h2 id="_1、二进制安装-二选一" tabindex="-1"><a class="header-anchor" href="#_1、二进制安装-二选一"><span>1、二进制安装（二选一）</span></a></h2><p>官网下载地址：<a href="https://prometheus.io/download/" target="_blank" rel="noopener noreferrer">https://prometheus.io/download/</a></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>wget https://github.com/prometheus/node_exporter/releases/download/v1.5.0/node_exporter-1.5.0.linux-amd64.tar.gz</span></span>
<span class="line"><span></span></span>
<span class="line"><span>tar xvf node_exporter-1.5.0.linux-amd64.tar.gz</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ls -l</span></span>
<span class="line"><span></span></span>
<span class="line"><span>mv node_exporter-1.5.0.linux-amd64 /opt/prometheus/node_exporter</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建用户</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>useradd -M -s /usr/sbin/nologin prometheus</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>更改<code>node_exporter</code>文件夹权限：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>chown prometheus:prometheus -R /opt/prometheus/node_exporter</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>创建 systemd 服务</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat &gt; /etc/systemd/system/node_exporter.service &lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span>[Unit]</span></span>
<span class="line"><span>Description=node_exporter</span></span>
<span class="line"><span>Documentation=https://prometheus.io/</span></span>
<span class="line"><span>After=network.target</span></span>
<span class="line"><span>[Service]</span></span>
<span class="line"><span>User=prometheus</span></span>
<span class="line"><span>Group=prometheus</span></span>
<span class="line"><span>ExecStart=/opt/prometheus/node_exporter/node_exporter</span></span>
<span class="line"><span>Restart=on-failure</span></span>
<span class="line"><span>[Install]</span></span>
<span class="line"><span>WantedBy=multi-user.target</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动 node_exporter</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl daemon-reload</span></span>
<span class="line"><span>systemctl start node_exporter.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>加入到开机自启动</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl enable node_exporter.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>检查</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl status node_exporter.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>检查日志</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>journalctl -u node_exporter.service -f</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="修改prometheus配置" tabindex="-1"><a class="header-anchor" href="#修改prometheus配置"><span>修改prometheus配置</span></a></h3><p>prometheus服务器操作</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>nano /opt/prometheus/prometheus/prometheus.yml</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 再scrape_configs这行下面添加如下配置：</span></span>
<span class="line"><span>  #node-exporter配置</span></span>
<span class="line"><span>  - job_name: &#39;node-exporter&#39;</span></span>
<span class="line"><span>    scrape_interval: 15s</span></span>
<span class="line"><span>    static_configs:</span></span>
<span class="line"><span>    - targets: [&#39;192.168.11.62:9100&#39;]</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        instance: test服务器</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重载prometheus</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>curl -X POST http://localhost:9090/-/reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="_2、docker安装-二选一" tabindex="-1"><a class="header-anchor" href="#_2、docker安装-二选一"><span>2、docker安装（二选一）</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>mkdir /data/node_exporter -p</span></span>
<span class="line"><span></span></span>
<span class="line"><span>cd /data/node_exporter</span></span>
<span class="line"><span></span></span>
<span class="line"><span>cat &gt; docker-compose.yaml &lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span>version: &#39;3.3&#39;</span></span>
<span class="line"><span>services:</span></span>
<span class="line"><span>  node_exporter:</span></span>
<span class="line"><span>    image: prom/node-exporter:v1.5.0</span></span>
<span class="line"><span>    container_name: node-exporter</span></span>
<span class="line"><span>    restart: always</span></span>
<span class="line"><span>    volumes:</span></span>
<span class="line"><span>      - /proc:/host/proc:ro</span></span>
<span class="line"><span>      - /sys:/host/sys:ro</span></span>
<span class="line"><span>      - /:/rootfs:ro</span></span>
<span class="line"><span>    command: </span></span>
<span class="line"><span>      - &#39;--path.procfs=/host/proc&#39; </span></span>
<span class="line"><span>      - &#39;--path.sysfs=/host/sys&#39;</span></span>
<span class="line"><span>      - &#39;--collector.filesystem.ignored-mount-points=^/(sys|proc|dev|host|etc|rootfs/var/lib/docker)($$|/)&#39;</span></span>
<span class="line"><span>    ports:</span></span>
<span class="line"><span>      - &#39;9100:9100&#39;</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>检查</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat docker-compose.yaml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>启动</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker-compose up -d</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>检查</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker ps</span></span>
<span class="line"><span>或：</span></span>
<span class="line"><span>docker logs -f node-exporter</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改prometheus配置-1" tabindex="-1"><a class="header-anchor" href="#修改prometheus配置-1"><span>修改prometheus配置</span></a></h3><p>prometheus服务器操作</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>nano /data/docker-prometheus/prometheus/prometheus.yml</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 再scrape_configs这行下面添加如下配置：</span></span>
<span class="line"><span>  #node-exporter配置</span></span>
<span class="line"><span>  - job_name: &#39;node-exporter&#39;</span></span>
<span class="line"><span>    scrape_interval: 15s</span></span>
<span class="line"><span>    static_configs:</span></span>
<span class="line"><span>    - targets: [&#39;192.168.11.62:9100&#39;]</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        instance: test服务器</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重载prometheus配置</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>curl -X POST http://localhost:9090/-/reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>web访问地址</p><table id="6856fe20" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:750px;"><tbody><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u98d2e871" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">应用</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u4e79b5f8" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">访问地址</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ua72df511" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">备注</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="ua2689571" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">node-exporter</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uf5e6e562" class="ne-p" style="margin:0;padding:0;min-height:24px;"><a href="http://192.168.11.61:9100/metrics" data-href="http://192.168.11.61:9100/metrics" target="_blank" class="ne-link"><span class="ne-text">http://192.168.11.61:9100/metrics</span></a></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uf909833c" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">无用户和密码</span></p></td></tr></tbody></table><p>Prometheus web上检查</p><p><a href="http://192.168.11.61:9090/targets?search=" target="_blank" rel="noopener noreferrer">http://192.168.11.61:9090/targets?search=</a></p><h2 id="_3、常用的监控指标" tabindex="-1"><a class="header-anchor" href="#_3、常用的监控指标"><span>3、常用的监控指标</span></a></h2><p>查看：<a href="http://192.168.11.61:9090/graph" target="_blank" rel="noopener noreferrer">http://192.168.11.61:9090/graph</a></p><h3 id="cpu采集" tabindex="-1"><a class="header-anchor" href="#cpu采集"><span>cpu采集</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node_cpu_seconds_total</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><table id="dacf148b" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:750px;"><tbody><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u457f4f24" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">名称</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uee217ded" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">含义</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u0a36e43b" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">node_load1</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ua80ad67d" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">一分钟内cpu负载</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u2f297227" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">node_load5</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ua5d56ec4" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">5分钟内cpu负载</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u5108fe1e" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">node_load15</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u7f2432bf" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">15分钟内cpu负载</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr></tbody></table><h3 id="内存采集" tabindex="-1"><a class="header-anchor" href="#内存采集"><span>内存采集</span></a></h3><p>/proc/meminfo文件</p><p>node_memory_</p><table id="df4cdd60" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:750px;"><tbody><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u633f3c80" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">名称</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u65338ede" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">含义</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u317deb86" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">备注</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u43d589e6" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">node_memory_MemTotal_bytes</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u328dd4a0" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">内存总大小</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u7e880724" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">单位字节，/1024/1024=MB，/1024/1024/1024=GB</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u9b4e111a" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">node_memory_MemAvailable_bytes</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ub83cf50b" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">空闲可使用的内存大小（=free + buffer + cache）</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u8865aa33" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">node_memory_MemFree_bytes</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ube605fc6" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">空闲物理内存大小</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u06a2d375" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">node_memory_SwapFree_bytes</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u39608786" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">swap内存空闲大小</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u579471cf" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">node_memory_SwapTotal_bytes</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uee854694" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">swap内存总大小</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr></tbody></table><h3 id="磁盘采集" tabindex="-1"><a class="header-anchor" href="#磁盘采集"><span>磁盘采集</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node_disk_</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="文件系统采集" tabindex="-1"><a class="header-anchor" href="#文件系统采集"><span>文件系统采集</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node_filesystem_</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><table id="8b1c61da" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:750px;"><tbody><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="uc1c5cb42" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">名称</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u482d6589" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">含义</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u6e8c8053" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">node_filesystem_avail_bytes</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u3d8c408d" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">空闲磁盘大小，单位字节</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uab2c4027" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">/1024/1024=MB，/1024/1024/1024=GB</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="ua1133ac0" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">node_filesystem_size_bytes</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u54d7439a" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">磁盘总大小</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="ucc57a99d" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">node_filesystem_files_free</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u252a806b" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">空闲inode大小，单位个</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="uaa19793e" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">node_filesystem_files</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ua3a01aa6" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">inode总大小，单位个</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr></tbody></table><h3 id="网络采集" tabindex="-1"><a class="header-anchor" href="#网络采集"><span>网络采集</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node_network_</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><table id="1a0569f9" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:750px;"><tbody><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u882a6c46" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">名称</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uc8a65d60" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">含义</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="uf4726755" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">node_network_transmit_bytes_total</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ub80706b3" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">网络流出流量，单位字节（Byte）</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u5af5ce3b" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">/1024/1024=Mb/s</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u759e32b1" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">node_network_receive_bytes_total</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u8b7ba1ea" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">网络流入流量，单位字节（Byte）</span></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr></tbody></table><h3 id="文件描述符" tabindex="-1"><a class="header-anchor" href="#文件描述符"><span>文件描述符</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>node_filefd_allocated: 已分配的文件描述符数。通过cat /proc/sys/fs/file-nr查看</span></span>
<span class="line"><span>node_filefd_maximum:   系统支持的最大文件描述符数,通过/proc/sys/fs/file-max或/proc/sys/fs/file-nr</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="进程文件描述符" tabindex="-1"><a class="header-anchor" href="#进程文件描述符"><span>进程文件描述符</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>process_max_fds: 进程可打开的最大文件描述符数。</span></span>
<span class="line"><span>process_open_fds: 进程当前打开的文件描述符数。通过lsof -p &lt;PID&gt; | wc -l计算</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4、触发器设置" tabindex="-1"><a class="header-anchor" href="#_4、触发器设置"><span>4、触发器设置</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cd /data/docker-prometheus/</span></span>
<span class="line"><span></span></span>
<span class="line"><span>cat &gt;&gt; prometheus/alert.yml &lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span>- name: node-exporter</span></span>
<span class="line"><span>  rules:</span></span>
<span class="line"><span>  - alert: HostOutOfMemory</span></span>
<span class="line"><span>    expr: node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes * 100 &lt; 10</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;主机内存不足,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;内存可用率&lt;10%，当前值：{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: HostMemoryUnderMemoryPressure</span></span>
<span class="line"><span>    expr: rate(node_vmstat_pgmajfault[1m]) &gt; 1000</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;内存压力不足,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;节点内存压力大。 重大页面错误率高，当前值为：{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: HostUnusualNetworkThroughputIn</span></span>
<span class="line"><span>    expr: sum by (instance) (rate(node_network_receive_bytes_total[2m])) / 1024 / 1024 &gt; 100</span></span>
<span class="line"><span>    for: 5m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;异常流入网络吞吐量,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;网络流入流量 &gt; 100 MB/s，当前值：{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: HostUnusualNetworkThroughputOut</span></span>
<span class="line"><span>    expr: sum by (instance) (rate(node_network_transmit_bytes_total[2m])) / 1024 / 1024 &gt; 100</span></span>
<span class="line"><span>    for: 5m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;异常流出网络吞吐量，实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;网络流出流量 &gt; 100 MB/s，当前值为：{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: HostUnusualDiskReadRate</span></span>
<span class="line"><span>    expr: sum by (instance) (rate(node_disk_read_bytes_total[2m])) / 1024 / 1024 &gt; 50</span></span>
<span class="line"><span>    for: 5m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;异常磁盘读取,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;磁盘读取&gt; 50 MB/s，当前值：{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: HostUnusualDiskWriteRate</span></span>
<span class="line"><span>    expr: sum by (instance) (rate(node_disk_written_bytes_total[2m])) / 1024 / 1024 &gt; 50</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;异常磁盘写入,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;磁盘写入&gt; 50 MB/s，当前值：{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: HostOutOfDiskSpace</span></span>
<span class="line"><span>    expr: (node_filesystem_avail_bytes * 100) / node_filesystem_size_bytes &lt; 10 and ON (instance, device, mountpoint) node_filesystem_readonly == 0</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;磁盘空间不足告警,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;剩余磁盘空间&lt; 10% ，当前值：{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: HostDiskWillFillIn24Hours</span></span>
<span class="line"><span>    expr: (node_filesystem_avail_bytes * 100) / node_filesystem_size_bytes &lt; 10 and ON (instance, device, mountpoint) predict_linear(node_filesystem_avail_bytes{fstype!~&quot;tmpfs&quot;}[1h], 24 * 3600) &lt; 0 and ON (instance, device, mountpoint) node_filesystem_readonly == 0</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;磁盘空间将在24小时内耗尽,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;以当前写入速率预计磁盘空间将在 24 小时内耗尽，当前值：{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: HostOutOfInodes</span></span>
<span class="line"><span>    expr: node_filesystem_files_free{mountpoint =&quot;/&quot;} / node_filesystem_files{mountpoint=&quot;/&quot;} * 100 &lt; 10 and ON (instance, device, mountpoint) node_filesystem_readonly{mountpoint=&quot;/&quot;} == 0</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;磁盘Inodes不足,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;剩余磁盘 inodes &lt; 10%，当前值： {{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: HostUnusualDiskReadLatency</span></span>
<span class="line"><span>    expr: rate(node_disk_read_time_seconds_total[1m]) / rate(node_disk_reads_completed_total[1m]) &gt; 0.1 and rate(node_disk_reads_completed_total[1m]) &gt; 0</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;异常磁盘读取延迟,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;磁盘读取延迟 &gt; 100ms，当前值：{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: HostUnusualDiskWriteLatency</span></span>
<span class="line"><span>    expr: rate(node_disk_write_time_seconds_total[1m]) / rate(node_disk_writes_completed_total[1m]) &gt; 0.1 and rate(node_disk_writes_completed_total[1m]) &gt; 0</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;异常磁盘写入延迟,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;磁盘写入延迟 &gt; 100ms，当前值：{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: high_load </span></span>
<span class="line"><span>    expr: node_load1 &gt; 4</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: page</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;CPU1分钟负载过高,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;CPU1分钟负载&gt;4，已经持续2分钟。当前值为：{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: HostCpuIsUnderUtilized</span></span>
<span class="line"><span>    expr: 100 - (avg by(instance) (rate(node_cpu_seconds_total{mode=&quot;idle&quot;}[2m])) * 100) &gt; 80</span></span>
<span class="line"><span>    for: 1m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;cpu负载高,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;cpu负载&gt; 80%，当前值：{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: HostCpuStealNoisyNeighbor</span></span>
<span class="line"><span>    expr: avg by(instance) (rate(node_cpu_seconds_total{mode=&quot;steal&quot;}[5m])) * 100 &gt; 10</span></span>
<span class="line"><span>    for: 0m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;CPU窃取率异常,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;CPU 窃取率 &gt; 10%。 嘈杂的邻居正在扼杀 VM 性能，或者 Spot 实例可能失去信用，当前值：{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: HostSwapIsFillingUp</span></span>
<span class="line"><span>    expr: (1 - (node_memory_SwapFree_bytes / node_memory_SwapTotal_bytes)) * 100 &gt; 80</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;磁盘swap空间使用率异常,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;磁盘swap空间使用率&gt;80%&quot;</span></span>
<span class="line"><span>  - alert: HostNetworkReceiveErrors</span></span>
<span class="line"><span>    expr: rate(node_network_receive_errs_total[2m]) / rate(node_network_receive_packets_total[2m]) &gt; 0.01</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;异常网络接收错误,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;网卡{{ $labels.device }}在过去2分钟接收{{ $value }}个错误&quot;</span></span>
<span class="line"><span>  - alert: HostNetworkTransmitErrors</span></span>
<span class="line"><span>    expr: rate(node_network_transmit_errs_total[2m]) / rate(node_network_transmit_packets_total[2m]) &gt; 0.01</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;异常网络传输错误,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;网卡{{ $labels.device }}在过去2分钟传输{{ $value }}个错误&quot;</span></span>
<span class="line"><span>  - alert: HostNetworkInterfaceSaturated</span></span>
<span class="line"><span>    expr: (rate(node_network_receive_bytes_total{device!~&quot;^tap.*&quot;}[1m]) + rate(node_network_transmit_bytes_total{device!~&quot;^tap.*&quot;}[1m])) / node_network_speed_bytes{device!~&quot;^tap.*&quot;} &gt; 0.8 &lt; 10000</span></span>
<span class="line"><span>    for: 1m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;异常网络接口饱和,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;网卡{{ $labels.device }}正在超载，当前值{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: HostConntrackLimit</span></span>
<span class="line"><span>    expr: node_nf_conntrack_entries / node_nf_conntrack_entries_limit &gt; 0.8</span></span>
<span class="line"><span>    for: 5m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;异常连接数,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;连接数过大，当前连接数：{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: HostClockSkew</span></span>
<span class="line"><span>    expr: (node_timex_offset_seconds &gt; 0.05 and deriv(node_timex_offset_seconds[5m]) &gt;= 0) or (node_timex_offset_seconds &lt; -0.05 and deriv(node_timex_offset_seconds[5m]) &lt;= 0)</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;异常时钟偏差,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;检测到时钟偏差，时钟不同步。值为：{{ $value }}&quot;</span></span>
<span class="line"><span>  - alert: HostClockNotSynchronising</span></span>
<span class="line"><span>    expr: min_over_time(node_timex_sync_status[1m]) == 0 and node_timex_maxerror_seconds &gt;= 16</span></span>
<span class="line"><span>    for: 2m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;时钟不同步,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;时钟不同步&quot;</span></span>
<span class="line"><span>  - alert: NodeFileDescriptorLimit</span></span>
<span class="line"><span>    expr: node_filefd_allocated / node_filefd_maximum * 100 &gt; 80</span></span>
<span class="line"><span>    for: 1m</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: warning</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;预计内核将很快耗尽文件描述符限制&quot;</span></span>
<span class="line"><span>      description: &quot;{{ $labels.instance }}｝已分配的文件描述符数超过了限制的80%，当前值为：{{ $value }}&quot;</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>检查：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat prometheus/alert.yml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>检查配置</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>docker exec -it prometheus promtool check config /etc/prometheus/prometheus.yml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>重新加载配置</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>curl -X POST http://localhost:9090/-/reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>检查</p><figure><img src="`+i+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>检查</p><p><a href="http://192.168.11.61:9090/rules" target="_blank" rel="noopener noreferrer">http://192.168.11.61:9090/rules</a></p><h2 id="_5、grafana展示node-exporter的数据" tabindex="-1"><a class="header-anchor" href="#_5、grafana展示node-exporter的数据"><span>5、grafana展示node-exporter的数据</span></a></h2><p>因为我们在安装prometheus时，已经在grafana上添加prometheus的数据源，并倒入过id为<code>1860</code>的模版，所以就不需要到倒入了，直接查看，查看方式如下图：</p><p><a href="http://192.168.11.61:3000" target="_blank" rel="noopener noreferrer">http://192.168.11.61:3000</a></p><p>用户名：admin</p><p>密码：password</p><figure><img src="'+l+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><a href="https://grafana.com/grafana/dashboards/8919" target="_blank" rel="noopener noreferrer">https://grafana.com/grafana/dashboards/8919</a></p><p>需要修改下：</p><figure><img src="'+d+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>然后json model把</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>$instance:.+  全部修改为  $instance</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div>',103),r=[t];function c(o,h){return e(),n("div",null,r)}const b=s(p,[["render",c],["__file","2.2.监控linux服务器.html.vue"]]),v=JSON.parse('{"path":"/note/Prometheus/2.2.%E7%9B%91%E6%8E%A7linux%E6%9C%8D%E5%8A%A1%E5%99%A8.html","title":"2.2.监控linux服务器","lang":"zh-CN","frontmatter":{"title":"2.2.监控linux服务器","order":8,"icon":"lightbulb","description":"一、环境 真实环境会有很多需要监控的主机，我新链接克隆了一台主机ip地址修改为192.168.11.62来做测试 后面的课程都以docker安装的prometheus进行讲解 1、准备环境 主机更名 安装Docker 镜像加速 安装docker 检查 安装Docker-compose 安装命令 检查 二、node_exporter 1、二进制安装（二选...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/note/Prometheus/2.2.%E7%9B%91%E6%8E%A7linux%E6%9C%8D%E5%8A%A1%E5%99%A8.html"}],["meta",{"property":"og:site_name","content":"风华"}],["meta",{"property":"og:title","content":"2.2.监控linux服务器"}],["meta",{"property":"og:description","content":"一、环境 真实环境会有很多需要监控的主机，我新链接克隆了一台主机ip地址修改为192.168.11.62来做测试 后面的课程都以docker安装的prometheus进行讲解 1、准备环境 主机更名 安装Docker 镜像加速 安装docker 检查 安装Docker-compose 安装命令 检查 二、node_exporter 1、二进制安装（二选..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"风华"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"2.2.监控linux服务器\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"风华\\",\\"url\\":\\"/portfolio\\"}]}"]]},"headers":[{"level":2,"title":"1、准备环境","slug":"_1、准备环境","link":"#_1、准备环境","children":[{"level":3,"title":"主机更名","slug":"主机更名","link":"#主机更名","children":[]},{"level":3,"title":"安装Docker","slug":"安装docker","link":"#安装docker","children":[]},{"level":3,"title":"安装Docker-compose","slug":"安装docker-compose","link":"#安装docker-compose","children":[]}]},{"level":2,"title":"1、二进制安装（二选一）","slug":"_1、二进制安装-二选一","link":"#_1、二进制安装-二选一","children":[{"level":3,"title":"修改prometheus配置","slug":"修改prometheus配置","link":"#修改prometheus配置","children":[]}]},{"level":2,"title":"2、docker安装（二选一）","slug":"_2、docker安装-二选一","link":"#_2、docker安装-二选一","children":[{"level":3,"title":"修改prometheus配置","slug":"修改prometheus配置-1","link":"#修改prometheus配置-1","children":[]}]},{"level":2,"title":"3、常用的监控指标","slug":"_3、常用的监控指标","link":"#_3、常用的监控指标","children":[{"level":3,"title":"cpu采集","slug":"cpu采集","link":"#cpu采集","children":[]},{"level":3,"title":"内存采集","slug":"内存采集","link":"#内存采集","children":[]},{"level":3,"title":"磁盘采集","slug":"磁盘采集","link":"#磁盘采集","children":[]},{"level":3,"title":"文件系统采集","slug":"文件系统采集","link":"#文件系统采集","children":[]},{"level":3,"title":"网络采集","slug":"网络采集","link":"#网络采集","children":[]},{"level":3,"title":"文件描述符","slug":"文件描述符","link":"#文件描述符","children":[]},{"level":3,"title":"进程文件描述符","slug":"进程文件描述符","link":"#进程文件描述符","children":[]}]},{"level":2,"title":"4、触发器设置","slug":"_4、触发器设置","link":"#_4、触发器设置","children":[]},{"level":2,"title":"5、grafana展示node-exporter的数据","slug":"_5、grafana展示node-exporter的数据","link":"#_5、grafana展示node-exporter的数据","children":[]}],"git":{},"readingTime":{"minutes":13.79,"words":4136},"filePathRelative":"note/Prometheus/2.2.监控linux服务器.md","autoDesc":true}');export{b as comp,v as data};
