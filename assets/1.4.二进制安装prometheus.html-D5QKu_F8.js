import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as e,o as a,d as n}from"./app-CdRwZrpj.js";const i="/assets/2023-10-28_200332_8293950.6932017139762733-DCX5t6_V.png",l="/assets/2023-10-28_200332_7832330.4955405234909861-JWTIwjfW.png",t="/assets/2023-10-28_200334_2187880.4728995365950214-Bey1ocTO.png",p="/assets/2023-10-28_200332_8317170.924571987388615-BXmCduFb.png",d="/assets/2023-10-28_200332_9546340.636925268892447-WGE4I4PG.png",r="/assets/2023-10-28_200332_9134280.49904311679180946-vHL1cNlA.png",c="/assets/2023-10-28_200333_2921510.8273977743306833-FfrFlWuE.png",h="/assets/2023-10-28_200334_2095250.7251115344804587-ViWDwlSu.png",o="/assets/2023-10-28_200332_9802280.8001638057249886-BBvE869S.png",m="/assets/2023-10-28_200333_0710120.4714438867008205-eMMFf0se.png",u="/assets/2023-10-28_200333_1276820.8194988753505289-BYbxV3nD.png",g={},b=n(`<table id="6451c828" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:750px;"><tbody><tr style="height:33px;"><td width="150" style="border:1px solid #d9d9d9;"><p id="ub45ef9bf" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">主机名</span></p></td><td width="150" style="border:1px solid #d9d9d9;"><p id="ueea9493e" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">IP地址</span></p></td><td width="150" style="border:1px solid #d9d9d9;"><p id="ub95ab8de" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">配置</span></p></td><td width="150" style="border:1px solid #d9d9d9;"><p id="u7bd6db28" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">系统</span></p></td><td width="150" style="border:1px solid #d9d9d9;"><p id="ue13081d9" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">说明</span></p></td></tr><tr style="height:33px;"><td width="150" style="border:1px solid #d9d9d9;"><p id="u0d3102ff" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">localhost</span></p></td><td width="150" style="border:1px solid #d9d9d9;"><p id="u71c473c0" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">192.168.11.61</span></p></td><td width="150" style="border:1px solid #d9d9d9;"><p id="u5a8132c7" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">2核4g</span></p></td><td width="150" style="border:1px solid #d9d9d9;"><p id="u7f31ed74" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">Ubuntu 20.04</span></p></td><td width="150" style="border:1px solid #d9d9d9;"><p id="ud254bd76" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">Prometheus版本：2.37.6 LTS，grafana版本：9.4.3，alertmanager版本：0.25，node-exporter版本：1.5.0</span></p></td></tr></tbody></table><h2 id="_1、环境准备" tabindex="-1"><a class="header-anchor" href="#_1、环境准备"><span>1、环境准备</span></a></h2><h3 id="克隆虚拟机" tabindex="-1"><a class="header-anchor" href="#克隆虚拟机"><span>克隆虚拟机</span></a></h3><p>通过链接克隆一台新的虚拟机，并把ip更为192.168.11.61</p><h1 id="二、从官网手动安装-和通过gitee下载安装二选一" tabindex="-1"><a class="header-anchor" href="#二、从官网手动安装-和通过gitee下载安装二选一"><span>二、从官网手动安装（和通过gitee下载安装二选一）</span></a></h1><ul><li><p>Prometheus 采集、存储数据</p></li><li><p>Grafana 用于图表展示</p></li><li><p>alertmanager 用于接收 Prometheus 发送的告警信息</p></li><li><p>node-exporter 用于收集操作系统和硬件信息的metrics</p></li></ul><h2 id="_1、安装prometheus" tabindex="-1"><a class="header-anchor" href="#_1、安装prometheus"><span>1、安装Prometheus</span></a></h2><p><a href="https://prometheus.io/download/" target="_blank" rel="noopener noreferrer">官网下载地址</a>,获取最新下载URL.</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#切换到root用户</span></span>
<span class="line"><span>sudo -i</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#下载prometheus二进制压缩包</span></span>
<span class="line"><span>wget https://github.com/prometheus/prometheus/releases/download/v2.37.6/prometheus-2.37.6.linux-amd64.tar.gz</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#解压</span></span>
<span class="line"><span>tar xf prometheus-2.37.6.linux-amd64.tar.gz</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#查看解压后的文件名</span></span>
<span class="line"><span>ls -l</span></span>
<span class="line"><span></span></span>
<span class="line"><span>mkdir /opt/prometheus -p</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#移动解压后的文件名到/opt/，并改名prometheus</span></span>
<span class="line"><span>mv prometheus-2.37.6.linux-amd64/ /opt/prometheus/prometheus</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建一个专门的<code>prometheus</code>用户：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>useradd -M -s /usr/sbin/nologin prometheus</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>更改<code>prometheus</code>用户的文件夹权限：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>chown prometheus:prometheus -R /opt/prometheus</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>创建 systemd 服务</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat &gt; /etc/systemd/system/prometheus.service &lt;&lt; &quot;EOF&quot;</span></span>
<span class="line"><span>[Unit]</span></span>
<span class="line"><span>Description=Prometheus Server</span></span>
<span class="line"><span>Documentation=https://prometheus.io/docs/introduction/overview/</span></span>
<span class="line"><span>After=network-online.target</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Service]</span></span>
<span class="line"><span>Type=simple</span></span>
<span class="line"><span>User=prometheus</span></span>
<span class="line"><span>Group=prometheus</span></span>
<span class="line"><span>Restart=on-failure</span></span>
<span class="line"><span>ExecStart=/opt/prometheus/prometheus/prometheus \\</span></span>
<span class="line"><span>  --config.file=/opt/prometheus/prometheus/prometheus.yml \\</span></span>
<span class="line"><span>  --storage.tsdb.path=/opt/prometheus/prometheus/data \\</span></span>
<span class="line"><span>  --storage.tsdb.retention.time=60d \\</span></span>
<span class="line"><span>  --web.enable-lifecycle</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Install]</span></span>
<span class="line"><span>WantedBy=multi-user.target</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置参数解释:</p><p>通过<code>/opt/prometheus/prometheus -h</code>查看帮助详情</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>--config.file=/opt/prometheus/prometheus/prometheus.yml                 #主配置文件</span></span>
<span class="line"><span>--storage.tsdb.path=/opt/prometheus/prometheus/data 	                #数据库存储目录</span></span>
<span class="line"><span>--web.console.libraries=/opt/prometheus/prometheus/console_libraries    #指定控制台库目录路径</span></span>
<span class="line"><span>--web.console.templates=/opt/prometheus/prometheus/consoles 	        #指定控制台模版目录路径</span></span>
<span class="line"><span>--storage.tsdb.retention=60d                                            #指明数据保留天数，默认15天</span></span>
<span class="line"><span>--web.enable-lifecycle                                                  #热加载</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动 Prometheus</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl daemon-reload</span></span>
<span class="line"><span>systemctl start prometheus.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>加入到开机自启动</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl enable prometheus.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>检查</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl status prometheus.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>查看 Prometheus 的日志以进行故障排除：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>journalctl -u prometheus.service -f</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>访问地址</p><table id="2c1d332d" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:750px;"><tbody><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="ub34aeb6f" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">应用</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u5810f219" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">访问地址</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u4a4ae5bb" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">备注</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u76a5ef4d" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">prometheus</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="ucf397c98" class="ne-p" style="margin:0;padding:0;min-height:24px;"><a href="http://192.168.11.61:9090" data-href="http://192.168.11.61:9090" target="_blank" class="ne-link"><span class="ne-text">http://192.168.11.61:9090</span></a></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uf07c11c2" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">无用户和密码</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u5326f499" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">监控指标</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u6fdac746" class="ne-p" style="margin:0;padding:0;min-height:24px;"><a href="http://10.0.0.60:9090/metrics" data-href="http://10.0.0.60:9090/metrics" target="_blank" class="ne-link"><span class="ne-text">http://192.168.11.61:9090/metrics</span></a></p></td><td width="250" style="border:1px solid #d9d9d9;"></td></tr></tbody></table><h2 id="_2、安装alertmanager" tabindex="-1"><a class="header-anchor" href="#_2、安装alertmanager"><span>2、安装alertmanager</span></a></h2><p>下载alertmanager</p><p><a href="https://prometheus.io/download/" target="_blank" rel="noopener noreferrer">官网下载地址</a>,获取最新下载URL.</p><ul><li>注 在root用户下执行</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>下载alertmanager二进制压缩包</span></span>
<span class="line"><span>wget https://github.com/prometheus/alertmanager/releases/download/v0.25.0/alertmanager-0.25.0.linux-amd64.tar.gz</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#解压</span></span>
<span class="line"><span>tar xf alertmanager-0.25.0.linux-amd64.tar.gz</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#查看解压后的文件名</span></span>
<span class="line"><span>ls -l</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#移动解压后的文件名到/opt/，并改名为alertmanager</span></span>
<span class="line"><span>mv alertmanager-0.25.0.linux-amd64 /opt/prometheus/alertmanager</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>更改<code>alertmanager</code>文件夹权限：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>chown prometheus:prometheus -R /opt/prometheus/alertmanager</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>创建 systemd 服务</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat &gt;/etc/systemd/system/alertmanager.service &lt;&lt; &quot;EOF&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Unit]</span></span>
<span class="line"><span>Description=Alert Manager</span></span>
<span class="line"><span>Wants=network-online.target</span></span>
<span class="line"><span>After=network-online.target</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Service]</span></span>
<span class="line"><span>Type=simple</span></span>
<span class="line"><span>User=prometheus</span></span>
<span class="line"><span>Group=prometheus</span></span>
<span class="line"><span>ExecStart=/opt/prometheus/alertmanager/alertmanager \\</span></span>
<span class="line"><span>  --config.file=/opt/prometheus/alertmanager/alertmanager.yml \\</span></span>
<span class="line"><span>  --storage.path=/opt/prometheus/alertmanager/data</span></span>
<span class="line"><span></span></span>
<span class="line"><span>Restart=always</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[Install]</span></span>
<span class="line"><span>WantedBy=multi-user.target</span></span>
<span class="line"><span></span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动 alertmanager</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl daemon-reload</span></span>
<span class="line"><span>systemctl start alertmanager.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>加入到开机自启动</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl enable alertmanager.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>检查</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl status alertmanager.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="修改prometheus配置" tabindex="-1"><a class="header-anchor" href="#修改prometheus配置"><span>修改prometheus配置</span></a></h3><p>加入alertmanager</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>vim /opt/prometheus/prometheus/prometheus.yml</span></span>
<span class="line"><span></span></span>
<span class="line"><span>alerting:</span></span>
<span class="line"><span>  alertmanagers:</span></span>
<span class="line"><span>  - static_configs:</span></span>
<span class="line"><span>    - targets:</span></span>
<span class="line"><span>      #根据实际填写alertmanager的地址</span></span>
<span class="line"><span>      - localhost:9093</span></span>
<span class="line"><span></span></span>
<span class="line"><span>rule_files:</span></span>
<span class="line"><span>  #根据实际名修改文件名</span></span>
<span class="line"><span>  - &quot;alert.yml&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 搜刮配置</span></span>
<span class="line"><span>scrape_configs:</span></span>
<span class="line"><span>  - job_name: &#39;alertmanager&#39;</span></span>
<span class="line"><span>    scrape_interval: 15s</span></span>
<span class="line"><span>    static_configs:</span></span>
<span class="line"><span>    - targets: [&#39;alertmanager:9093&#39;]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>增加触发器配置文件</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat &gt; /opt/prometheus/prometheus/alert.yml &lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span>groups:</span></span>
<span class="line"><span>- name: Prometheus alert</span></span>
<span class="line"><span>  rules:</span></span>
<span class="line"><span>  # 对任何实例超过30秒无法联系的情况发出警报</span></span>
<span class="line"><span>  - alert: 服务告警</span></span>
<span class="line"><span>    expr: up == 0</span></span>
<span class="line"><span>    for: 30s</span></span>
<span class="line"><span>    labels:</span></span>
<span class="line"><span>      severity: critical</span></span>
<span class="line"><span>    annotations:</span></span>
<span class="line"><span>      summary: &quot;服务异常,实例:{{ $labels.instance }}&quot;</span></span>
<span class="line"><span>      description: &quot;{{ $labels.job }} 服务已关闭&quot;</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>检查配置</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cd /opt/prometheus/prometheus/</span></span>
<span class="line"><span>./promtool check config prometheus.yml</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>重启prometheus或重新加载配置文件（二选一）</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>#重启</span></span>
<span class="line"><span>systemctl restart prometheus</span></span>
<span class="line"><span>或：</span></span>
<span class="line"><span>#重载，需要--web.enable-lifecycle配置</span></span>
<span class="line"><span>curl -X POST http://localhost:9090/-/reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>访问地址</p><table id="300d382f" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:750px;"><tbody><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u19179bf5" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">应用</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u94a49206" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">访问地址</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u5edaadd4" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">备注</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u3cbba204" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">alertmanager</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uab9d7ff6" class="ne-p" style="margin:0;padding:0;min-height:24px;"><a href="http://192.168.11.61:9093" data-href="http://192.168.11.61:9093" target="_blank" class="ne-link"><span class="ne-text">http://192.168.11.61:9093</span></a></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u977c3765" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">无用户和密码</span></p></td></tr></tbody></table><p>检查</p><figure><img src="`+i+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="_3、安装grafana" tabindex="-1"><a class="header-anchor" href="#_3、安装grafana"><span>3、安装grafana</span></a></h2><p>官网下载地址：<a href="https://grafana.com/grafana/download" target="_blank" rel="noopener noreferrer">https://grafana.com/grafana/download</a></p><h3 id="二进制安装" tabindex="-1"><a class="header-anchor" href="#二进制安装"><span>二进制安装</span></a></h3><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cd ~</span></span>
<span class="line"><span></span></span>
<span class="line"><span>wget https://dl.grafana.com/enterprise/release/grafana-enterprise-9.4.3.linux-amd64.tar.gz</span></span>
<span class="line"><span></span></span>
<span class="line"><span>tar -zxvf grafana-enterprise-9.4.3.linux-amd64.tar.gz</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ls -l</span></span>
<span class="line"><span></span></span>
<span class="line"><span>mv grafana-9.4.3/ /opt/prometheus/grafana</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>更改<code>grafana</code>文件夹权限：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>chown prometheus:prometheus -R /opt/prometheus</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>创建 systemd 服务</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat &gt;/etc/systemd/system/grafana-server.service&lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span>[Unit]</span></span>
<span class="line"><span>Description=Grafana server</span></span>
<span class="line"><span>Documentation=http://docs.grafana.org</span></span>
<span class="line"><span>[Service]</span></span>
<span class="line"><span>Type=simple</span></span>
<span class="line"><span>User=prometheus</span></span>
<span class="line"><span>Group=prometheus</span></span>
<span class="line"><span>Restart=on-failure</span></span>
<span class="line"><span>ExecStart=/opt/prometheus/grafana/bin/grafana-server \\</span></span>
<span class="line"><span>  --config=/opt/prometheus/grafana/conf/defaults.ini \\</span></span>
<span class="line"><span>  --homepath=/opt/prometheus/grafana</span></span>
<span class="line"><span>[Install]</span></span>
<span class="line"><span>WantedBy=multi-user.target</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动 alertmanager</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl daemon-reload</span></span>
<span class="line"><span>systemctl start grafana-server.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>加入到开机自启动</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl enable grafana-server.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>检查</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl status grafana-server.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>检查日志</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>journalctl -u grafana-server.service -f</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>web访问地址</p><table id="ac2c0c73" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:750px;"><tbody><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="uc77ea836" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">应用</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uf5d81c09" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">访问地址</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u7bd55059" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">备注</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u782c31c3" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">grafana</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u26e0de02" class="ne-p" style="margin:0;padding:0;min-height:24px;"><a href="http://192.168.11.61:3000" data-href="http://192.168.11.61:3000" target="_blank" class="ne-link"><span class="ne-text">http://192.168.11.61:3000</span></a></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u5ecae0e5" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">默认：admin/admin</span></p></td></tr></tbody></table><h2 id="_4、安装node-exporter" tabindex="-1"><a class="header-anchor" href="#_4、安装node-exporter"><span>4、安装node_exporter</span></a></h2><p>官网下载地址：<a href="https://prometheus.io/download/" target="_blank" rel="noopener noreferrer">https://prometheus.io/download/</a></p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>wget https://github.com/prometheus/node_exporter/releases/download/v1.5.0/node_exporter-1.5.0.linux-amd64.tar.gz</span></span>
<span class="line"><span></span></span>
<span class="line"><span>tar xvf node_exporter-1.5.0.linux-amd64.tar.gz</span></span>
<span class="line"><span></span></span>
<span class="line"><span>ls -l</span></span>
<span class="line"><span></span></span>
<span class="line"><span>mv node_exporter-1.5.0.linux-amd64 /opt/prometheus/node_exporter</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>更改<code>node_exporter</code>文件夹权限：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>chown prometheus:prometheus -R /opt/prometheus/node_exporter</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>创建 systemd 服务</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat &gt; /etc/systemd/system/node_exporter.service &lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span>[Unit]</span></span>
<span class="line"><span>Description=node_exporter</span></span>
<span class="line"><span>Documentation=https://prometheus.io/</span></span>
<span class="line"><span>After=network.target</span></span>
<span class="line"><span>[Service]</span></span>
<span class="line"><span>User=prometheus</span></span>
<span class="line"><span>Group=prometheus</span></span>
<span class="line"><span>ExecStart=/opt/prometheus/node_exporter/node_exporter</span></span>
<span class="line"><span>Restart=on-failure</span></span>
<span class="line"><span>[Install]</span></span>
<span class="line"><span>WantedBy=multi-user.target</span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动 node_exporter</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl daemon-reload</span></span>
<span class="line"><span>systemctl start node_exporter.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>加入到开机自启动</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl enable node_exporter.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>检查</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl status node_exporter.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>检查日志</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>journalctl -u node_exporter.service -f</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>web访问地址</p><table id="6856fe20" class="ne-table" style="table-layout:fixed;border-collapse:collapse;border:1px solid #d9d9d9;width:750px;"><tbody><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u3f432888" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">应用</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="uf104919e" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">访问地址</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u05e86e95" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">备注</span></p></td></tr><tr style="height:33px;"><td width="250" style="border:1px solid #d9d9d9;"><p id="u22a5c36c" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">node-exporter</span></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u149218ae" class="ne-p" style="margin:0;padding:0;min-height:24px;"><a href="http://192.168.11.61:9100/metrics" data-href="http://192.168.11.61:9100/metrics" target="_blank" class="ne-link"><span class="ne-text">http://192.168.11.61:9100/metrics</span></a></p></td><td width="250" style="border:1px solid #d9d9d9;"><p id="u969e9755" class="ne-p" style="margin:0;padding:0;min-height:24px;"><span class="ne-text">无用户和密码</span></p></td></tr></tbody></table><h3 id="修改prometheus配置-1" tabindex="-1"><a class="header-anchor" href="#修改prometheus配置-1"><span>修改prometheus配置</span></a></h3><p>prometheus服务器操作</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cat &gt;&gt; /opt/prometheus/prometheus/prometheus.yml &lt;&lt;&quot;EOF&quot;</span></span>
<span class="line"><span></span></span>
<span class="line"><span># 再scrape_configs这行下面添加如下配置：</span></span>
<span class="line"><span>  #node-exporter配置</span></span>
<span class="line"><span>  - job_name: &#39;node-exporter&#39;</span></span>
<span class="line"><span>    scrape_interval: 15s</span></span>
<span class="line"><span>    static_configs:</span></span>
<span class="line"><span>    - targets: [&#39;localhost:9100&#39;]</span></span>
<span class="line"><span>      labels:</span></span>
<span class="line"><span>        instance: Prometheus服务器 </span></span>
<span class="line"><span>EOF</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重载prometheus</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>curl -X POST http://localhost:9090/-/reload</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Prometheus web上检查</p><p><a href="http://192.168.11.61:9090/" target="_blank" rel="noopener noreferrer">http://192.168.11.61:9090/</a></p><figure><img src="`+l+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h1 id="三、通过gitee下载安装-和从官网手动安装二选一" tabindex="-1"><a class="header-anchor" href="#三、通过gitee下载安装-和从官网手动安装二选一"><span>三、通过gitee下载安装(和从官网手动安装二选一)</span></a></h1><p>官网提供的下载地址都放在github上，国内下载很慢。我把他们都下载好了放在了我的gitee代码仓库</p><h2 id="通过git-clone下载" tabindex="-1"><a class="header-anchor" href="#通过git-clone下载"><span>通过git clone下载</span></a></h2><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>cd /opt</span></span>
<span class="line"><span></span></span>
<span class="line"><span>git clone https://gitee.com/linge365/prometheus.git</span></span>
<span class="line"><span></span></span>
<span class="line"><span>cd prometheus</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#移动systemd 服务到/etc/systemd/system/目录下</span></span>
<span class="line"><span>mv *.service /etc/systemd/system/</span></span>
<span class="line"><span></span></span>
<span class="line"><span>#检查</span></span>
<span class="line"><span>ls -l /etc/systemd/system/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建一个专门的<code>prometheus</code>用户：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>useradd -M -s /usr/sbin/nologin prometheus</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>更改<code>prometheus</code>用户的文件夹权限：</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>chown prometheus:prometheus -R /opt/prometheus</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>启动</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl daemon-reload</span></span>
<span class="line"><span>systemctl start prometheus.service</span></span>
<span class="line"><span>systemctl start grafana-server.service</span></span>
<span class="line"><span>systemctl start node_exporter.service</span></span>
<span class="line"><span>systemctl start alertmanager.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>设置开机自启</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl enable prometheus.service</span></span>
<span class="line"><span>systemctl enable grafana-server.service</span></span>
<span class="line"><span>systemctl enable node_exporter.service</span></span>
<span class="line"><span>systemctl enable alertmanager.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>检查</p><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span>systemctl status node_exporter.service</span></span>
<span class="line"><span>systemctl status prometheus.service</span></span>
<span class="line"><span>systemctl status grafana-server.service</span></span>
<span class="line"><span>systemctl status alertmanager.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="四、使用grafana展示prometheus的图形" tabindex="-1"><a class="header-anchor" href="#四、使用grafana展示prometheus的图形"><span>四、使用grafana展示prometheus的图形</span></a></h1><h2 id="_1、登陆grafana" tabindex="-1"><a class="header-anchor" href="#_1、登陆grafana"><span>1、登陆grafana</span></a></h2><p><a href="http://192.168.11.61:3000" target="_blank" rel="noopener noreferrer">http://192.168.11.61:3000</a></p><p>用户名：admin</p><p>密码： admin</p><p>第一次登陆，需要修改密码，填入新的密码后，再submit（提交）如下图：</p><figure><img src="`+t+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="_2、创建-prometheus-数据源" tabindex="-1"><a class="header-anchor" href="#_2、创建-prometheus-数据源"><span>2、创建 Prometheus 数据源</span></a></h2><p>在 Grafana 中创建 Prometheus 数据源：</p><ol><li><p>单击边栏中的“齿轮”，打开“配置”菜单。</p></li><li><p>单击“数据源”。</p></li><li><p>单击“添加数据源”。</p></li><li><p>选择“Prometheus”作为类型。</p></li><li><p>设置适当的 Prometheus 服务器 URL（例如，<code>http://localhost:9090</code>）</p></li><li><p>单击“保存并测试”以保存新的数据源。</p></li></ol><p>如下图：</p><figure><img src="'+p+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>点击Prometheus</p><figure><img src="'+d+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>url填入：<code>http://localhost:9090</code> 注：localhost表示本机</p><figure><img src="'+r+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="_3、创建仪表盘" tabindex="-1"><a class="header-anchor" href="#_3、创建仪表盘"><span>3、创建仪表盘</span></a></h2><h3 id="手动创建仪表盘" tabindex="-1"><a class="header-anchor" href="#手动创建仪表盘"><span>手动创建仪表盘</span></a></h3><p>略</p><h3 id="从-grafana-com-导入仪表板" tabindex="-1"><a class="header-anchor" href="#从-grafana-com-导入仪表板"><span>从 Grafana.com 导入仪表板</span></a></h3><p><a href="https://grafana.com/grafana/dashboards/" target="_blank" rel="noopener noreferrer">https://grafana.com/grafana/dashboards/</a></p><p>打开grafana的dashboards官网，在搜索栏输入node exporter回车，点击下载量大的dashboards如下图：</p><figure><img src="'+c+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>在拷贝id</p><figure><img src="'+h+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>打开grafana web控制台--点击dashbord图标--在点import导入--粘贴之前复制的id--在点load加载</p><figure><img src="'+o+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>name填写“服务器监控”（根据实际修改），选择“prometheus”--在点import导入</p><figure><img src="'+m+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>导入dashbord完成后，如下图：</p><figure><img src="'+u+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',144),v=[b];function k(f,y){return a(),e("div",null,v)}const w=s(g,[["render",k],["__file","1.4.二进制安装prometheus.html.vue"]]),E=JSON.parse('{"path":"/note/Prometheus/1.4.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85prometheus.html","title":"1.4.二进制安装prometheus","lang":"zh-CN","frontmatter":{"title":"1.4.二进制安装prometheus","order":4,"icon":"lightbulb","description":"1、环境准备 克隆虚拟机 通过链接克隆一台新的虚拟机，并把ip更为192.168.11.61 二、从官网手动安装（和通过gitee下载安装二选一） Prometheus 采集、存储数据 Grafana 用于图表展示 alertmanager 用于接收 Prometheus 发送的告警信息 node-exporter 用于收集操作系统和硬件信息的metr...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/note/Prometheus/1.4.%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85prometheus.html"}],["meta",{"property":"og:site_name","content":"风华"}],["meta",{"property":"og:title","content":"1.4.二进制安装prometheus"}],["meta",{"property":"og:description","content":"1、环境准备 克隆虚拟机 通过链接克隆一台新的虚拟机，并把ip更为192.168.11.61 二、从官网手动安装（和通过gitee下载安装二选一） Prometheus 采集、存储数据 Grafana 用于图表展示 alertmanager 用于接收 Prometheus 发送的告警信息 node-exporter 用于收集操作系统和硬件信息的metr..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"风华"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"1.4.二进制安装prometheus\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"风华\\",\\"url\\":\\"/portfolio\\"}]}"]]},"headers":[{"level":2,"title":"1、环境准备","slug":"_1、环境准备","link":"#_1、环境准备","children":[{"level":3,"title":"克隆虚拟机","slug":"克隆虚拟机","link":"#克隆虚拟机","children":[]}]},{"level":2,"title":"1、安装Prometheus","slug":"_1、安装prometheus","link":"#_1、安装prometheus","children":[]},{"level":2,"title":"2、安装alertmanager","slug":"_2、安装alertmanager","link":"#_2、安装alertmanager","children":[{"level":3,"title":"修改prometheus配置","slug":"修改prometheus配置","link":"#修改prometheus配置","children":[]}]},{"level":2,"title":"3、安装grafana","slug":"_3、安装grafana","link":"#_3、安装grafana","children":[{"level":3,"title":"二进制安装","slug":"二进制安装","link":"#二进制安装","children":[]}]},{"level":2,"title":"4、安装node_exporter","slug":"_4、安装node-exporter","link":"#_4、安装node-exporter","children":[{"level":3,"title":"修改prometheus配置","slug":"修改prometheus配置-1","link":"#修改prometheus配置-1","children":[]}]},{"level":2,"title":"通过git clone下载","slug":"通过git-clone下载","link":"#通过git-clone下载","children":[]},{"level":2,"title":"1、登陆grafana","slug":"_1、登陆grafana","link":"#_1、登陆grafana","children":[]},{"level":2,"title":"2、创建 Prometheus 数据源","slug":"_2、创建-prometheus-数据源","link":"#_2、创建-prometheus-数据源","children":[]},{"level":2,"title":"3、创建仪表盘","slug":"_3、创建仪表盘","link":"#_3、创建仪表盘","children":[{"level":3,"title":"手动创建仪表盘","slug":"手动创建仪表盘","link":"#手动创建仪表盘","children":[]},{"level":3,"title":"从 Grafana.com 导入仪表板","slug":"从-grafana-com-导入仪表板","link":"#从-grafana-com-导入仪表板","children":[]}]}],"git":{},"readingTime":{"minutes":9.72,"words":2915},"filePathRelative":"note/Prometheus/1.4.二进制安装prometheus.md","autoDesc":true}');export{w as comp,E as data};
