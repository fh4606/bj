import{_ as s}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as i,o as a,d as n}from"./app-CdRwZrpj.js";const l="/assets/image-20200127141358742-1580191807589-780x384-BeiBVnSI.png",h="/assets/%E9%95%9C%E5%83%8F%E5%88%B6%E4%BD%9C%E5%88%86%E5%B1%82%E7%BB%93%E6%9E%84-780x326-DYCh0OiT.jpg",k="/assets/image-20230810170711842-D_OJIgTe.png",t="/assets/image-20230815162227869-BibFqaSF.png",e="/assets/image-20230816150729197-DIG8Dxj1.png",p="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAdsAAAB1CAYAAAAGG0seAAAPFUlEQVR4nO3df2xT9f7H8dfpxvgRvwKKwRDku8UYOhOiCUajETfYiJiAdBdnRggRSLT1fid0gZsR/yCI/wz96mrkG9olhmgMDpdLDzGQRWFskqgQ8NcutvOaSDCZAURUIkO29Xz/GC1d13br1rOuu89H0mzt+ZzzeQ8WXnzO53POMSzLspTG9evX023GBBH9a7Qsa9D38V8BALlRmOsCMDaJIRv/StwOAMgNwjaPJQvYaKgWFhaqsLBQDocj9gIA5AZhm6fiwzUSicS+nzp1qqZNm5br8gAAcQjbPJQYtJFIRFOmTNG0adMYwQLABETY5plkQVtUVKTp06fnujQAQAqEbR5JFrTTp09XUVFRrksDAKRRePXq1bQNpkyZMk6lYCTiw7aoqIigBYA8UBiJRHJdA0YgcVRbUFDAqWMAyBOOmTNnKt1rPB06dGhc+xuN7u5uvfrqq3riiSc0Y8YMzZs3T8uXL9e2bdsUCoVi7R555JGs9x0fuDNmzMj68SXp0qVL2rlzp1555RX98ssvtvSRr/bu3ZvrEgDkqQmxdLW3t1fr16/XiRMncl1KWjt37tTSpUvV29ur1157TT/88IPC4bC2bNkiSVq5cqVefvllWZalb7/9Nmv9Jl5HO3XqVNtWHe/fv18///yzuru7tX//flv6AID/NDlfIHXt2jW5XC4tW7ZM27dvz3U5SfX39+u5557TnDlzdPbsWRUWDv5jW7lypVauXKlt27bpmWee0bp167JeQ3zY2jVP29XVpe+++y72/uzZs+rq6tLChQszPlZLS4uOHj2a0T4lJSUpfwfcbrdqa2u1aNGijI7Z0NCgH3/8Ubt27dLcuXMz2hcAsiWnI9tLly6poqJCNTU1EzZoJWnz5s2aP3++fD7fkKCNd/fdd2ccMJkqKCiwbVTb3Nw8os9Gorq6WoFAYMhr165dkqSampoh29L9DtTU1GjPnj26cOHCiGuor6/XlStXVFNTox07dmS0r31MeQyPzIRPw75yGYYx8Cr3KTxoF8+tbYYhT+LOyYR9Kk88Tuxwt45lxB8s7FN5pv2YHhlGuXzJOhrcMOnPfavrcpUPOUhYvvJb9QzdDuSPnI1sz58/r6eeeko7d+5UdXV1rsoYVmdnpz7++ONhTwsvXLhQ58+fj72fOnVqVvpPPIVs1+rwkydPqru7W5JiC696enrU3d2tU6dO6eGHH85KP4cOHVJJSYmWLl2adPuFCxe0Y8eOlPsn25Y4au3s7NSePXu0ePFivfDCC5KkOXPmaMeOHaqpqUnZt93CvnKV1nVIcmtF4uemSyGrXc7oe0+xLL9LUli+VqdCliXnQGOVl5bLF2qX15m8H9NjqCogqawxsQL5yktV5wzKslyJe8lTWidn0FK7a2T9SGH5fAFJZaP6uWP9GlVKVq7puVlru+tmu1J5ii35E0sH8kBOwvabb77RmjVr5Pf7VVlZmYsSRqypqUnPP//8sCt/u7q6bK/Fsqy0I+vR6u/vVzAYjL3fuHGjLMuKLQgyTVOLFy9WQUHBmPo5fvy4zpw5o0AgMGzbkbSRBk4vR8UHdeL+ixYtUiAQUENDg5qbm8f9tHIsUEMueUrjR2hhtZodcnsHglaSnF6v3IZPPq9LXqdTXn9c2jm98rrr5GsNy+scmoKmx1CVgrKCrTJ8iRt9qlOjQsnSKnxOYbnljW5yrpCrrE7hsKRUYWv6VOd0y92ResSZ+ueWokGroKVgqyFfwrbWQJkaQ9GCXPI2lqm01ZTfRdoi/4x72J44cULr1q3TgQMH9Oijj4539xk7c+aMNm3alOsyYuw4hXzs2DFduXIl9j7x3sqXL19WW1ubli9fPqZ+mpubNWvWLLW0tGR0NqOlpUWnT5/W7t27U7aJzs1WVlbq6NGjg0I40eLFi/Xmm29KUtpjZpPT2y7LKymcmIBJW8tZ1pEi6MI6F5acK5InoMtvyZIks3XINrM1ILfXSp6dN8PV5/PK5XVK4VaZHW5521PVaMpTFVZjyKtwIHXYpv+5XfLffHDGkHLNVgXKXArF/z9jhUtlda0y/S4Rt8g34x62a9eu1eXLl7Vs2bKM912wYMG4jCDjdXV1ZbwoJ+qxxx7TZ599lpU6ok/zyXbY9vT06PDhw8O2O3LkiB5//PFRX9tbX1+vysrKWKg3NTVJUuw0b9TcuXMHjUo7Ozt19OjRlCPd6Ofx873xQd7U1KTZs2dP4KkKp1a4ylTn88nr8g4EoelTXYfk9iZpbvpU1+FWMGUIphLWuXCZnCt8Kjfq1CFJKlNj7DSxU972kFReKqNOktwKWv6UoWZ6qhRuDMnvDMuTaSnAf6BxD9sPPvggr0a2hmHojz/+0B133JHRfhcvXlQ4PPEXdBw+fFjXr18ftt21a9d05MgRrVmzJuM+GhoaYoEXDdnVq1fr008/HbLKODpCTZRupJpuFXM+cHrbFQwbKh1IOcndqMYyDV3cZHpkVIXVGGof5ciuQ3U+1635X9Mjo9SjYssvl0x5DJ+cIUvWwEZ5DEOtwSRzpKZHVeFGhfxOJakSQBLjHrZLlizRRx99lDdztsXFxers7FRZWfpFIIm+/vpr3XfffVmrwzAMSVIkEsna6Pby5cs6duzYkM//+uuvpO3b2tpUUVGhWbNmjbiPhoYGSRoShnPnzlV1dbWqq6vldrs1a9Ys7d69e1C7hoYG3XvvvUNGpcePH1dra2vSU8CpQjlxlfhoLiOyk8tvyfJH35nyGGVy+m9tNz3GQMBZ/pRTqCPh9npv7e/yqrGsVK2mX85zPgXc3ptBK0ku+YNuGYlzpGGfyqvCagyNrY5RK3Pmpl9gjHKyQOqBBx5QW1tbXqxGXr58uT788MOMw/arr77SkiVLsl5PNsP20KFDSna7zn379iVt39fXJ9M0tWHDhhEdv76+XrNnzx521BkIBNTS0qL6+vpYgDY1NSUd4XZ2dsYWOKU6VryJfxo5iYT5StNjyOcMyfKPJWacKnaOfRwabjXVoQ51lBqqi99QashsDKk99dLlzDidKusIK37aOtxqqsPpJWyRl3J26c+CBQvU3t6up59+WlevXp1Qi5Diud1uPfjgg9q2bZtKSkpGtM+ff/6pffv26b333stqLYZhJA3H0Th//rxOnjyZdNuqVaskSQcOHBiy7fPPP1dlZaXmz5+f9vgNDQ166KGHRhxy0VFuVHQut7Ozc8hodaQrlfOTKU9VQO7grUt9fAG3vFbK63w0sKA39fxqlGuFW1VVHq2Ito2b/3WGXSqri66Ajq/Dr+glQ6YrpPbogqf4eg2fnNG537BP5aWmXGkvGRoBp1det6Eqz4qbl0CZ8tV1yJ35ZDUwIeT0phZ33XWXjh07pubm5tjpxommuLhYGzZs0NatW1OeXk20ZcsWLVq0KCvXpkZPH0e/3rhxY8zHlDToUp9Ep06d0qlTp1JuN83h73awffv2rIwm4+/PXFtbq5KSErnd7gn7+zIqg25aMXApzOB50oCq4m42kfTGFyPh8ssK6tax4kPa6VV7yCWz9FYd4cZQTq9pdflDagxXpflzAfKHYUWXuaYwksUzY9Xb26tNmzZp3rx543YpRib6+vr07LPP6qefftLBgwd1zz33JG135coVbd68Wb/++qv279+ftQc5xD+/NhKJjPm4lmXJ4xn9GlLDMOT3+4dvmMRwp3UTb2oRf2OKeIk3roi+z0RlZWVG/yHYu3evXnzxxYz6AABpgoStNBAA77//vtavXz8u/WUqEono7bff1ltvvaVVq1Zp6dKlKi8vl2VZ+vLLL3X69Gm9++67eumll+TxeGIj0WxIfGB8UVHRkGthMxUMBvXJJ5+ov78/o/0KCgr05JNPavXq1WPqPx8RtgBGa8KEbb64ePGi3nnnHTU3N+v777+XJN1///1au3atNm7cqDvvvNOWfhNHt7fffntWAx3DI2wBjBZhmycSR7cOh0O33XZbrssCAIzAhHieLYYXvzjG4XCov79fPT09uS4LADAChG2eiQ/cGzduZG11MgDAPjl/eDxGLn6ONnpji56eHvX394/6nsUAAPsRtnkmWeD29vbKsixNmzbNtgfLAwBGjwVSeSrxofKRSCT2cPmioiJbnnsLABgd/kXOU4mX/TgcDlmWpb6+PvX29sowDBUWFqqgoCD24lIhAMgNwjaPxd/KMX6UKykWvH19fYM+AwCMP8I2z8WPVqOhKynlVwDA+CNsJ4nEU8TR4I3/nMAFgNwgbCeZdPOyzNkCQG4MG7ZffPHFeNQBAMCkNeylPwAAYGy4AwIAADYjbAEAsBlhCwCAzQhbAABsRtgCAGAzwhYAAJsRtgAA2IywBQDAZoQtAAA2I2wBALAZYQsAgM0IWwAAbJb9sP3XG6owanVwmGYH/26o4vVQ+kbBWhnL3tAwrQAAmNCyGLYHVWsYMhZtU1uaVqHXK2QYhtbsTdPoX2+owjBk/O3/slceAAA5kp2wDdbKMNq0zLL03WvLUjQK6Y1lhmq1R5b1T/1PqlavV8jYLO2xLP3zxaxUBwBATg378PgRqdqj6FNxU5/yLdXWNktbh2v1j2Oy/jHcsQAAyB8skAIAwGaELQAANiNsAQCwGWELAIDNCFsAAGxG2AIAYDPCFgAAmxG2AADYzLCs6O0oAACAHRjZAgBgM8IWAACbEbYAANiMsAUAwGYO1kcBAGAvR/jfv+e6BgAAJjXH/wY6c10DAACTmuPcT1dzXQMAAJOao/ie/8p1DQAATGoO15P/nesaAACY1IxIJGIZhpHrOgAAmLS4zhYAAJsRtgAA2IywBQDAZoQtAAA2I2wBALAZYQsAgM0IWwAAbEbYAgBgM8IWAACbObh7FAAA9mJkCwCAzQhbAABsRtgCAGAzwhYAAJsRtgAA2Kzw999/T9tg5syZ41QKAACTEyNbAABsRtgCAGAzwhYAAJsRtgAA2IywBQDAZoQtAAA2c3i93lzXAADApOaQJAIXAAD7xE4jE7gAANjD4fP5cl0DAACTmkOSCFwAAOxj/Pbbb1a6BtwbGQCAseHSHwAAbEbYAgBgM8IWAACbEbYAANiMsAUAwGaELQAANiNsAQCwGWELAIDNCFsAAGxG2AIAYDPCFgAAmxG2AADYjLAFAMBmhC0AADYjbAEAsNn/AyL2BONmtoyGAAAAAElFTkSuQmCC",d="/assets/image-20230826111408266-BlCcl0Jf.png",r="/assets/image-20230827171250784-DRl7RSxD.png",g="/assets/image-20230816154853732-aRUyE_XX.png",y="/assets/image-20230816154912941-ivkf77mm.png",F="/assets/image-20230816155146747-DPphmNJ3.png",c="/assets/image-20230816155237542-dckfJYH6.png",C="/assets/image-20230816161317343-nR65xThK.png",o={},v=n('<h2 id="_1、什么是dockerfile" tabindex="-1"><a class="header-anchor" href="#_1、什么是dockerfile"><span>1、什么是dockerfile</span></a></h2><p>DockerFile 是一种被Docker程序解释的脚本，DockerFile是由一条条的命令组成的，每条命令对应linux下面的一条命令，Docker程序将这些DockerFile指令再翻译成真正的linux命令，其有自己的书写方式和支持的命令，Docker程序读取DockerFile并根据指令生成Docker镜像，相比手动制作镜像的方式，DockerFile更能直观的展示镜像是怎么产生的，有了DockerFile，当后期有额外的需求时，只要在之前的DockerFile添加或者修改响应的命令即可重新生成新的Docke镜像，避免了重复手动制作镜像的麻烦,类似与shell脚本一样,可以方便高效的制作镜像</p><h4 id="dockerfile-镜像制作和使用流程" tabindex="-1"><a class="header-anchor" href="#dockerfile-镜像制作和使用流程"><span><strong>Dockerfile 镜像制作和使用流程</strong></span></a></h4><figure><img src="'+l+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="dockerfile文件的制作镜像的分层结构" tabindex="-1"><a class="header-anchor" href="#dockerfile文件的制作镜像的分层结构"><span><strong>Dockerfile文件的制作镜像的分层结构</strong></span></a></h4><figure><img src="'+h+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="_2、dockerfile指令解读" tabindex="-1"><a class="header-anchor" href="#_2、dockerfile指令解读"><span>2、dockerfile指令解读</span></a></h2><figure><img src="'+k+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#### 2.1.FROM</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">功能为指定基础镜像，并且必须是第一条指令。</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 如果不以任何镜像为基础，那么写法为：FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> scratch。</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 同</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 时意味着接下来所写的指令将作为镜像的第一层开始</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#### 2.2.MAINTAINER</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">镜像创建维护者信息</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#### 2.3.RUN</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">功能为运行指定的命令</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">注意：多行命令不要写多个RUN，原因是Dockerfile中每一个指令都会建立一层.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 多少个RUN就构建了多</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 少层镜像，会造成镜像的臃肿、多层，不仅仅增加了构件部署的时间，还容易出错。</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> RUN书写时的换行符是</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#### 2.4.CMD</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">功能为容器启动时要运行的命令</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">注意：补充细节：这里边包括参数的一定要用双引号，就是</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">&quot;,不能是单引号。千万不能写成单引号。 原因是参数传递后，docker解析的是一个JSON array</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">#### 2.5.RUN和CMD的区别</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">不要把RUN和CMD搞混了。 RUN是构件容器时就运行的命令以及提交运行结果 CMD是容器启动时执行的命 令，在构件时并不运行，构件时紧紧指定了这个命令到底是个什么样子</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">#### 2.6.LABEL</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">功能是为镜像指定标签，为镜像写一些注释信息</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">但是并不建议这样写，最好就写成一行，如太长需要换行的话则使用\\符号 如下：</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">注意：LABEL会继承基础镜像种的LABEL，如遇到key相同，则值覆盖</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">#### 2.7.EXPOSE</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">功能为暴漏容器运行时的监听端口给外部 但是EXPOSE并不会vim 使容器访问主机的端口 如果想使得容器与主 机的端口有映射关系，必须在容器启动的时候加上 -P参数</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">注意：如果在端口号后面加/tcp，默认为tcp协议，如果需要UDP端口需要添加/udp</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">#### 2.8.ENV</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">功能为设置环境变量</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">#### 2.9.ADD</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">一个复制命令，把文件复制到镜象中。 如果把虚拟机与容器想象成两台linux服务器的话，那么这个命令就类似 于scp，只是scp需要加用户名和密码的权限验证，而ADD不用。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">注意：尽量不要把写成一个文件夹，如果是一个文件夹了，复制整个目录的内容,包括文件系统元数据</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">#### 2.10.WORKDIR</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">设置工作目录，对RUN,CMD,ENTRYPOINT,,ADD生效。如果不存在则会创建，也可以设置多次</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">#### 2.11.VOLUME</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">可实现挂载功能，可以将内部文件夹挂载到外部</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">#### 2.12.ENTRYPOINT</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">该命令与CMD类似，用于执行命令使用，还可以与CMD命令一起拼合使用</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">它与CMD的区别：  相同点：只能写一条，如果写多条，那么只有最后一条生效</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">不同点：CMD在创建容器时，在后面添加其他的CMD指令，CMD会被覆盖，但是ENTRYPOINT不会被覆盖，如果两个同时使用，CMD会变成ENTRYPOINT的参数</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">#### 2.13.ONBUILD</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">当构建一个被继承 Dcokerfile 这个时候就会触发运行ONBUILD命令。</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">#### 2.14.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">类似ADD命令，将文件拷贝到镜像中</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-使用dockerfile构建自己的镜像" tabindex="-1"><a class="header-anchor" href="#_3-使用dockerfile构建自己的镜像"><span>3.使用DockerFile构建自己的镜像</span></a></h2><p>Docker Hub中99%镜像都是从这个基础镜像过来的FROM scratch，然后配置需要的软件和配置来进行构建</p><h3 id="_3-1-创建一个自己的centos镜像" tabindex="-1"><a class="header-anchor" href="#_3-1-创建一个自己的centos镜像"><span>3.1.创建一个自己的centos镜像</span></a></h3><p>官方镜像属于极限压缩版缺少一些命令，我们构建一个自己的镜像添加一些命令，比如vim命令和ifconfig命令</p><h4 id="_3-1-1-创建工作目录" tabindex="-1"><a class="header-anchor" href="#_3-1-1-创建工作目录"><span>3.1.1.创建工作目录</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]# mkdir dockerfile</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]# cd dockerfile/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]#</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-2-创建dockerfile文件" tabindex="-1"><a class="header-anchor" href="#_3-1-2-创建dockerfile文件"><span>3.1.2.创建dockerfile文件</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]# touch dockerfile-centos</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_3-1-3-编辑dockerfile文件" tabindex="-1"><a class="header-anchor" href="#_3-1-3-编辑dockerfile文件"><span>3.1.3.编辑dockerfile文件</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]# vim dockerfile-centos</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> centos:7</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">MAINTAINER</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> zxw</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">zxw@xxjsjl.c</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">n</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#环境变量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> MYPATH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $MYPATH</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#添加执行过程命令等</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> vim</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> net-tools</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#暴露端口</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">EXPOSE</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 80</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#启动时运行的命令</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> echo</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $MYPATH</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;-------end-------&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /bin/bash</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-4-构建镜像" tabindex="-1"><a class="header-anchor" href="#_3-1-4-构建镜像"><span>3.1.4.构建镜像</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]# docker build -f dockerfile-centos -t mycentos:0.1 </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[+] Building 40.5s (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">8/8</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) FINISHED                                                            docker:default</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load .dockerignore                                                                      0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> context:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 2B</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                        0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load build definition from dockerfile-centos                                            0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dockerfile:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 435B</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                   0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> docker.io/library/centos:7                                           16.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">CACHED</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [1/4] FROM docker.io/library/centos:7@sha256:9d4bcbbb213dfd745b58be38b13b996ebb5ac315fe757  0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [2/4] WORKDIR /usr/local                                                                           0.1s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [3/4] RUN yum install -y vim                                                                      21.1s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [4/4] RUN yum install -y net-tools                                                                 1.9s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">exporting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                 1.2s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> exporting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> layers</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                1.2s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> writing</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sha256:13f3ef13eced3e0de61356fea7ee7ec097d1af1caa85c980994c08762e3d4c9b</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">           0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> naming</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> docker.io/library/mycentos:0.1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                        0.0s</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]# docker images</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">REPOSITORY</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            TAG</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">       IMAGE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ID</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">       CREATED</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          SIZE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mycentos</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">              0.1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">       13f3ef13eced</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   23</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> seconds</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ago</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   666MB</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-5-使用自己的镜像创建一个容器-并检查添加的命令是否存在" tabindex="-1"><a class="header-anchor" href="#_3-1-5-使用自己的镜像创建一个容器-并检查添加的命令是否存在"><span>3.1.5.使用自己的镜像创建一个容器，并检查添加的命令是否存在</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]# docker run -d -it --name mycentos mycentos:0.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">e88e58afbc0f58f9886876ba3f910bd2f35a842851d532243f711c2cef6166b4</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]# docker ps</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CONTAINER</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ID</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   IMAGE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          COMMAND</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                  CREATED</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         PORTS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     NAMES</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">e88e58afbc0f</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   mycentos:0.1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &quot;/bin/sh -c /bin/bash&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   4</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> seconds</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ago</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   Up</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> seconds</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   80/tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    mycentos</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]# docker exec -it mycentos bash</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#vi并tab发现存在vim命令</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@e88e58afbc0f local]# vi</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">vi</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        view</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      vigr</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      vim</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">       vimdiff</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   vimtutor</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  vipw</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#使用ifconfig查看网卡ip地址信息</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@e88e58afbc0f local]# ifconfig</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">eth0:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> flags=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">4163</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">UP,BROADCAST,RUNNING,MULTICAS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">T</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  mtu</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1500</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        inet</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 172.17.0.2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  netmask</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 255.255.0.0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  broadcast</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 172.17.255.255</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        ether</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 02:42:ac:11:00:02</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  txqueuelen</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  (Ethernet)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        RX</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> packets</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  bytes</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2306</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (2.2 </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">KiB</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        RX</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> errors</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  dropped</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  overruns</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  frame</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        TX</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> packets</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  bytes</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (0.0 </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">B</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        TX</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> errors</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  dropped</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> overruns</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  carrier</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  collisions</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lo:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> flags=</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">73</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">UP,LOOPBACK,RUNNIN</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">G</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  mtu</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 65536</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        inet</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 127.0.0.1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  netmask</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 255.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        loop</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  txqueuelen</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1000</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  (Local </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">Loopback</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        RX</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> packets</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  bytes</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (0.0 </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">B</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        RX</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> errors</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  dropped</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  overruns</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  frame</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        TX</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> packets</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  bytes</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (0.0 </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">B</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">        TX</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> errors</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  dropped</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> overruns</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  carrier</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  collisions</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@e88e58afbc0f local]#</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-6-查看镜像的构建历史" tabindex="-1"><a class="header-anchor" href="#_3-1-6-查看镜像的构建历史"><span>3.1.6.查看镜像的构建历史</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]# docker history mycentos:0.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">IMAGE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          CREATED</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          CREATED</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> BY</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                      SIZE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      COMMENT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">13f3ef13eced</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   29</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> minutes</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ago</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/bin/sh&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;-c&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;/bin/bash&quot;]</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                0B</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        buildkit.dockerfile.v0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">missing</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      29 minutes ago   CMD [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/bin/sh&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;-c&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;echo </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">-------end------…   0B        buildkit.dockerfile.v0</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&lt;missing&gt;      29 minutes ago   CMD [&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/bin/sh</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot; &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-c</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot; &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">echo </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$MYPATH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;]             0B        buildkit.dockerfile.v0</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&lt;missing&gt;      29 minutes ago   EXPOSE map[80/tcp:{}]                           0B        buildkit.dockerfile.v0</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&lt;missing&gt;      29 minutes ago   RUN /bin/sh -c yum install -y net-tools # bu…   189MB     buildkit.dockerfile.v0</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&lt;missing&gt;      29 minutes ago   RUN /bin/sh -c yum install -y vim # buildkit    274MB     buildkit.dockerfile.v0</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&lt;missing&gt;      29 minutes ago   WORKDIR /usr/local                              0B        buildkit.dockerfile.v0</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&lt;missing&gt;      29 minutes ago   ENV MYPATH=/usr/local                           0B        buildkit.dockerfile.v0</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&lt;missing&gt;      29 minutes ago   MAINTAINER zxw&lt;zxw@xxjsjl.cn&gt;                   0B        buildkit.dockerfile.v0</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&lt;missing&gt;      23 months ago    /bin/sh -c #(nop)  CMD [&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/bin/bash</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;]            0B</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&lt;missing&gt;      23 months ago    /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&lt;missing&gt;      23 months ago    /bin/sh -c #(nop) ADD file:b3ebbe8bd304723d4…   204MB</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们平时拿到的镜像，可以研究它是怎么做的</p><h3 id="_3-2-cmd和entrypoint区别" tabindex="-1"><a class="header-anchor" href="#_3-2-cmd和entrypoint区别"><span>3.2.CMD和ENTRYPOINT区别</span></a></h3><blockquote><p>id=&quot;h4-cmd&quot;&gt;CMD</p><p>功能为容器启动时要运行的命令,只有最后一条会生效</p><p>注意：补充细节：这里边包括参数的一定要用双引号，就是&quot;,不能是单引号。千万不能写成单引号。 原因是参数传递后，docker解析的是一个JSON array</p><h4 id="entrypoint" tabindex="-1"><a class="header-anchor" href="#entrypoint"><span>ENTRYPOINT</span></a></h4><p>该命令与CMD类似，用于执行命令使用，还可以与CMD命令一起拼合使用</p><p>它与CMD的区别： 相同点：只能写一条，如果写多条，那么只有最后一条生效</p><p>不同点：CMD在创建容器时，在后面添加其他的CMD指令，CMD会被覆盖，但是ENTRYPOINT不会被覆盖，如果两个同时使用，CMD会变成ENTRYPOINT的参数</p></blockquote><h4 id="_3-2-1-测试cmd" tabindex="-1"><a class="header-anchor" href="#_3-2-1-测试cmd"><span>3.2.1.测试cmd</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]# vim dockerfile-cmd-test</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> centos:7</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;-a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]# docker build -f dockerfile-cmd-test -t cmd-test:0.1 </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[+] Building 0.8s (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">5/5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) FINISHED                                                                                                                       docker:default</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load build definition from dockerfile-cmd-test                                                                                                    0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dockerfile:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 136B</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                             0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load .dockerignore                                                                                                                                0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> context:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 2B</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                  0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> docker.io/library/centos:7                                                                                                      0.3s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">CACHED</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [1/1] FROM docker.io/library/centos:7@sha256:9d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426a630e0987                                         0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">exporting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                           0.5s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> exporting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> layers</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                          0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> writing</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sha256:06f2cc65ea4ade90802e89678c89aca197bf6ffc2c56c531355fd659627f6493</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                     0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> naming</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> docker.io/library/cmd-test:0.1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]# docker run -it cmd-test:0.1    </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#命令ls -a生效</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  ..</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  .dockerenv</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  anaconda-post.log</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  bin</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  dev</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  etc</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  home</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  lib</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  lib64</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  media</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  mnt</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  opt</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  proc</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  run</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  sbin</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  srv</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  sys</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  tmp</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  usr</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  var</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]# docker history cmd-test:0.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">IMAGE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          CREATED</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         CREATED</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> BY</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                      SIZE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      COMMENT</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">06f2cc65ea4a</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   23</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> months</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ago</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ls&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;-a&quot;]</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                 0B</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        buildkit.dockerfile.v0</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">missing</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      23 months ago   /bin/sh -c </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#(nop)  CMD [&quot;/bin/bash&quot;]            0B</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">missing</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      23 months ago   /bin/sh -c </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#(nop)  LABEL org.label-schema.sc…   0B</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">missing</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">      23 months ago   /bin/sh -c </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#(nop) ADD file:b3ebbe8bd304723d4…   204MB</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>想追加一个命令 -l ls -al，cmd的清理 -l会被替换cmd[&quot;ls&quot;,&quot;-a&quot;] 命令，-l不是命令所以报错。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]# docker run -it cmd-test:0.1 -l</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">docker:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Error</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> response</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> from</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> daemon:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> failed</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> task</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> for</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> container:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> failed</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> shim</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> task:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> OCI</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> runtime</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> failed:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> runc</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> failed:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> unable</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> container</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> process:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> exec:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;-l&quot;:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> executable</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> file</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> found</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $PATH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> unknown.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>如果想要执行，需要写完整命令</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]# docker run -it cmd-test:0.1 ls -al</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">total</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 12</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     6</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:04</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     6</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:04</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ..</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-rwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:04</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .dockerenv</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-rw-r--r--.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 12114</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> anaconda-post.log</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lrwxrwxrwx.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     7</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> usr/bin</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   5</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   360</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:04</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dev</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    66</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:04</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> etc</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     6</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 11</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2018</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> home</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lrwxrwxrwx.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     7</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> lib</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> usr/lib</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lrwxrwxrwx.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     9</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> lib64</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> usr/lib64</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     6</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 11</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2018</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> media</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     6</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 11</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2018</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mnt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     6</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 11</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2018</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> opt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dr-xr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 267</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:04</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> proc</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dr-xr-x---.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   114</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  11</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   148</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> run</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lrwxrwxrwx.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     8</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sbin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> usr/sbin</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     6</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 11</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2018</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> srv</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dr-xr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  13</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 06:17</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sys</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxrwxrwt.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   7</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   132</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tmp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  13</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   155</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> usr</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   238</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> var</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-2-2-测试entrypoint" tabindex="-1"><a class="header-anchor" href="#_3-2-2-测试entrypoint"><span>3.2.2.测试ENTRYPOINT</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]# vim dockerfile-entrypoint-test</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]# cat dockerfile-entrypoint-test</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> centos:7</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ENTRYPOINT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;ls&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;-a&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]# docker build -f dockerfile-entrypoint-test -t entrypoint:0.1 </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[+] Building 15.4s (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">5/5</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) FINISHED                                                                                                                      docker:default</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load build definition from dockerfile-entrypoint-test                                                                                             0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dockerfile:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 151B</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                             0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load .dockerignore                                                                                                                                0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> context:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 2B</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                  0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> docker.io/library/centos:7                                                                                                     15.3s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">CACHED</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [1/1] FROM docker.io/library/centos:7@sha256:9d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426a630e0987                                         0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">exporting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                           0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> exporting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> layers</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                          0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> writing</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sha256:5184c7d459a0111136914d90d94e7121f7fce3c2746b17b74fc2f1e808a37da8</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                     0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> naming</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> docker.io/library/entrypoint:0.1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                0.0s</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]# docker run entrypoint:0.1</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">..</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">.dockerenv</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">anaconda-post.log</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">bin</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dev</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">etc</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">home</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lib</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lib64</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">media</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">mnt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">opt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">proc</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">root</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">run</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sbin</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">srv</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">sys</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tmp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">usr</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">var</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost dockerfile]# docker run entrypoint:0.1 -l    </span><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#可以直接追加命令</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">total</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 12</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     6</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:09</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     6</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:09</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ..</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-rwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:09</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> .dockerenv</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">-rw-r--r--.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 12114</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> anaconda-post.log</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lrwxrwxrwx.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     7</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> usr/bin</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   5</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   340</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:09</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dev</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">    66</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:09</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> etc</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     6</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 11</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2018</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> home</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lrwxrwxrwx.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     7</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> lib</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> usr/lib</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lrwxrwxrwx.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     9</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> lib64</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> usr/lib64</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     6</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 11</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2018</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> media</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     6</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 11</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2018</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mnt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     6</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 11</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2018</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> opt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dr-xr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 265</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:09</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> proc</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dr-xr-x---.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   114</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  11</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   148</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> run</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">lrwxrwxrwx.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     8</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sbin</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> -</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> usr/sbin</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     6</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Apr</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 11</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2018</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> srv</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dr-xr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  13</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 14</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 06:17</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sys</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxrwxrwt.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   7</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   132</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> tmp</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  13</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   155</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> usr</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">drwxr-xr-x.</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  18</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   238</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Nov</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 13</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  2020</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> var</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-3-构建一个tomcat镜像" tabindex="-1"><a class="header-anchor" href="#_3-3-构建一个tomcat镜像"><span>3.3.构建一个Tomcat镜像</span></a></h3><h5 id="_3-3-1-准备镜像文件-tomcat压缩包-jdk的压缩包" tabindex="-1"><a class="header-anchor" href="#_3-3-1-准备镜像文件-tomcat压缩包-jdk的压缩包"><span>3.3.1.准备镜像文件 Tomcat压缩包，jdk的压缩包</span></a></h5><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost tomcat]# ls</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">apache-tomcat-9.0.78.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  jdk-8u201-linux-x64.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    readme.txt</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-3-2-编写dockerfile文件-官方命名-dockerfile-构建的时候会自动寻找这个文件-就不要-f指定" tabindex="-1"><a class="header-anchor" href="#_3-3-2-编写dockerfile文件-官方命名-dockerfile-构建的时候会自动寻找这个文件-就不要-f指定"><span>3.3.2.编写dockerfile文件，官方命名：<code>Dockerfile</code> 构建的时候会自动寻找这个文件，就不要-f指定</span></a></h5><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> centos8:0.1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">MAINTAINER</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> zxw</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">zxw@xxjsjl.c</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">n</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 把宿主机当前上下文的readme.txt拷贝到容器/usr/local/路径下</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> readme.txt</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/cincontainer.txt</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 把java和tomcat添加到容器中（会自动解压）</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ADD</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> jdk-8u201-linux-x64.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ADD</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> apache-tomcat-9.0.78.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 安装vim编辑器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> vim</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 设置启动访问的初始位置，即工作目录，登录落脚点</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> MYPATH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WORKDIR</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $MYPATH</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 配置java和tomcat的环境变量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> JAVA_HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/jdk1.8.0_201</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> CLASSPATH</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $JAVA_HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/lib/dt.jar:</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$JAVA_HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/lib/tools.jar</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> CATALINE_HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/apache-tomcat-9.0.78</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> CATALINE_BASE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/apache-tomcat-9.0.78</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> PATH</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $PATH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$JAVA_HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/bin:</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$CATALINE_HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/lib:</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$CATALINE_HOME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/bin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">EXPOSE</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 8080</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;"># 容器启动后要执行的命令</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/apache-tomcat-9.0.78/bin/startup.sh</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tail</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -F</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/apache-tomcat-9.0.78/bin/logs/catalina.out</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-3-3-构建镜像" tabindex="-1"><a class="header-anchor" href="#_3-3-3-构建镜像"><span>3.3.3.构建镜像</span></a></h5><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost tomcat]# docker build -t mytomcat </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[+] Building 56.1s (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">11/11</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) FINISHED                                                                                                                    docker:default</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load build definition from Dockerfile                       0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dockerfile:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 732B</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                       0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load .dockerignore                                          0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> context:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 2B</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                            0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> docker.io/library/centos:7                15.3s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">CACHED</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [1/6] FROM docker.io/library/centos:7@sha256:9d4bcbbb213dfd745b58be38b13b996ebb5ac315fe75711bd618426a630e0987                 0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load build context                                          3.7s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> context:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 161.75MB</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                      3.7s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [2/6]  readme.txt /usr/local/readme.txt                            0.3s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [3/6] ADD jdk-8u11-linux-x64.tar.gz /usr/local/                        8.1s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [4/6] ADD apache-tomcat-9.0.22.tar.gz /usr/local/                      0.1s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [5/6] RUN yum -y install vim                                           27.3s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [6/6] WORKDIR /usr/local                                               0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">exporting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                     1.2s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> exporting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> layers</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                     1.2s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> writing</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sha256:1b36d60ec8b7fec6519ea1e630451c0c97d66b1f058a34a357ef8ffb537ae798</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                 0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> naming</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> docker.io/library/mytomcat</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-3-4-使用镜像快速创建容器" tabindex="-1"><a class="header-anchor" href="#_3-3-4-使用镜像快速创建容器"><span>3.3.4.使用镜像快速创建容器</span></a></h5><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost tomcat]# docker run -d -p 8080:8080 mytomcat:0.1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost tomcat]# docker ps</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CONTAINER</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ID</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   IMAGE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          COMMAND</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                  CREATED</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         PORTS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                       NAMES</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">32240222b32d</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   mytomcat:0.1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &quot;/bin/sh -c &#39;/usr/lo…&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   3</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> minutes</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ago</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   Up</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> minutes</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   0.0.0.0:8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">8080/tcp,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> :::8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">8080/tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   recursing_agnesi</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-3-5-简单测试访问" tabindex="-1"><a class="header-anchor" href="#_3-3-5-简单测试访问"><span>3.3.5.简单测试访问</span></a></h5><figure><img src="`+t+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h5 id="_3-3-6-创建容器并挂载本地目录-发布一个简单页面" tabindex="-1"><a class="header-anchor" href="#_3-3-6-创建容器并挂载本地目录-发布一个简单页面"><span>3.3.6.创建容器并挂载本地目录，发布一个简单页面</span></a></h5><p>（1）创建容器，命名tomcat01，并挂载相关目录</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]# docker run -d -it -p 8080:8080 --name tomcat01 -v /usr/local/tomcat/webapps:/usr/local/apache-tomcat-9.0.78/webapps -v /usr/local/tomcat/tomcatlogs:/usr/local/apache-tomcat-9.0.78/logs mytomcat:0.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">c37b47bf75e8cb0aa7abd8c089527d00acc041fcecd8b0b85d5e759fb4e098ac</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]# docker ps</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CONTAINER</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ID</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   IMAGE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          COMMAND</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                  CREATED</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         PORTS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                       NAMES</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">c37b47bf75e8</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   mytomcat:0.1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &quot;/bin/sh -c &#39;/usr/lo…&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   8</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> seconds</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ago</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   Up</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 5</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> seconds</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   0.0.0.0:8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">8080/tcp,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> :::8080</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">8080/tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   tomcat01</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）添加test目录，及测试文件</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost webapps]# mkdir test</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost test]# vim index.html</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;!</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">DOCTYPE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> htm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">l</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">html </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">lang</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;en&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">head</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">meta</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> charset=&quot;UTF-8&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">meta</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http-equiv=&quot;X-UA-Compatible&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> content=&quot;IE=edge&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">meta</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> name=&quot;viewport&quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> content=&quot;width=device-width, initial-scale=1.0&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">title</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">index</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> page</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/titl</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">e</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/head</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">body</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">h1</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">my</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> index</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> page</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/h</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">1&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/body</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">/html</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（3）重启容器测试访问</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost test]# docker restart tomcat01</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="`+e+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_3-4-构建一个基于rpm安装的mysql镜像" tabindex="-1"><a class="header-anchor" href="#_3-4-构建一个基于rpm安装的mysql镜像"><span>3.4.构建一个基于rpm安装的mysql镜像</span></a></h3><blockquote><p>通过rmp包二进制安装构建mysql镜像，基础镜像是有centos7</p></blockquote><h5 id="_3-4-1-创建目录及所需文件" tabindex="-1"><a class="header-anchor" href="#_3-4-1-创建目录及所需文件"><span>3.4.1.创建目录及所需文件</span></a></h5><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]# mkdir mysql</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h5 id="_3-4-2编写dockerfile文件" tabindex="-1"><a class="header-anchor" href="#_3-4-2编写dockerfile文件"><span>3.4.2编写dockerfile文件</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost mysql]# vim Dockerfie</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> centos:centos7.9.2009</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">MAINTAINER</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> zxw</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">zxw@xxjsjl.c</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">n</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">VOLUME</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;mysql_1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;mysql_2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> wget</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --import</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://repo.mysql.com/RPM-GPG-KEY-mysql-2022</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mysql-community-server</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">EXPOSE</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 3306</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/usr/sbin/init&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-4-3-构建mysql镜像" tabindex="-1"><a class="header-anchor" href="#_3-4-3-构建mysql镜像"><span>3.4.3.构建mysql镜像</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost mysql]# docker build -t mysql57:1.0 </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[+] Building 4.5s (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">7/7</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) FINISHED                                                                                                                                                                     docker:default</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load build definition from Dockerfile                                                                                                                                                           0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dockerfile:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 440B</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                                                           0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load .dockerignore                                                                                                                                                                              0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> context:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 2B</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                                                                0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> docker.io/library/centos:centos7.9.2009                                                                                                                                       0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [1/3] FROM docker.io/library/centos:centos7.9.2009                                                                                                                                                         0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">CACHED</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [2/3] RUN yum install -y wget &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://dev.mysql.com/get/mysql57-community-release-el7-11.noarch.rpm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">rpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --import</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://repo.mysql.com/RPM-GPG-KEY-mysql-2022</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                 0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">CACHED</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [3/3] RUN yum -y install mysql-community-server                                                                                                                                                     0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">exporting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                                                                         4.4s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> exporting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> layers</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                                                                        4.4s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> writing</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sha256:726c077a2aebfb9c1816b4444e3d2b9d19365d29e69d4bcaaa29791d0abb4a0e</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                   0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> naming</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> docker.io/library/mysql57:1.0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                                                 0.0s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-4-4-创建一个容器" tabindex="-1"><a class="header-anchor" href="#_3-4-4-创建一个容器"><span>3.4.4.创建一个容器</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost mysql]# docker run -itd --name mysql01 </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">--privileged</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">true</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  mysql57:1.0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/sbin/init</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">965bb59093a03f4ed6d47d0e2c9da68eaae7a9b95feca3aca367a72d01892a24</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost mysql]# docker exec -it mysql01 systemctl status mysqld</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">●</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mysqld.service</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> MySQL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   Loaded:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> loaded</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (/usr/lib/systemd/system/mysqld.service; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">vendor</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> preset:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> disabled</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   Active:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> activating</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (start) since Thu 2023-08-24 08:55:52 UTC; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">5s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ago</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">     Docs:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> man:mysqld</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">           http://dev.mysql.com/doc/refman/en/using-systemd.html</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  Process:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 113</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ExecStart=/usr/sbin/mysqld</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --daemonize</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --pid-file=/var/run/mysqld/mysqld.pid</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $MYSQLD_OPTS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (code=exited, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">status=0/SUCCESS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  Process:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 54</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ExecStartPre=/usr/bin/mysqld_pre_systemd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (code=exited, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">status=0/SUCCESS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   CGroup:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /docker/965bb59093a03f4ed6d47d0e2c9da68eaae7a9b95feca3aca367a72d01892a24/system.slice/mysqld.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">           └─115</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/sbin/mysqld</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --daemonize</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --pid-file=/var/run/mysqld/mysqld.pid</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 24</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:55:52</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 965bb59093a0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> systemd[1]:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Starting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> MySQL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Server...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 24</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:55:56</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 965bb59093a0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> systemd[1]:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> New</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> main</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> PID</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 115</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> does</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> belong</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> service,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> PID</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> file</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> owned</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> by</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Refusing.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 24</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:55:56</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 965bb59093a0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> systemd[1]:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> New</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> main</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> PID</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 115</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> does</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> belong</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> service,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> and</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> PID</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> file</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> is</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> not</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> owned</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> by</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> root.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Refusing.</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#出现报错信息，原因是映射cgroup内核限制资源目录，解决方法，添加映射目录-v /sys/fs/cgroup:/sys/fs/cgroup</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost mysql]# docker run -itd --name mysql02 -v /sys/fs/cgroup:/sys/fs/cgroup </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">--privileged</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">true</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  mysql57:1.0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/sbin/init</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">bdfdc08c475058623460f7cab15d389fc13d5dd908cae687922c497ce1b9029a</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost mysql]# docker exec -it mysql02 systemctl status mysqld</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">●</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mysqld.service</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> MySQL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Server</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   Loaded:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> loaded</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (/usr/lib/systemd/system/mysqld.service; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">vendor</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> preset:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> disabled</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   Active:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> active</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (running) since Thu 2023-08-24 08:57:06 UTC; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">1s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ago</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">     Docs:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> man:mysqld</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">           http://dev.mysql.com/doc/refman/en/using-systemd.html</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  Process:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 114</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ExecStart=/usr/sbin/mysqld</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --daemonize</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --pid-file=/var/run/mysqld/mysqld.pid</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $MYSQLD_OPTS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (code=exited, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">status=0/SUCCESS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">  Process:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 54</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ExecStartPre=/usr/bin/mysqld_pre_systemd</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (code=exited, </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">status=0/SUCCESS</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Main</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> PID:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 116</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (mysqld)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   CGroup:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /docker/bdfdc08c475058623460f7cab15d389fc13d5dd908cae687922c497ce1b9029a/system.slice/mysqld.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">           └─116</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/sbin/mysqld</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --daemonize</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --pid-file=/var/run/mysqld/mysqld.pid</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 24</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:57:02</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bdfdc08c4750</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> systemd[1]:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Starting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> MySQL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Server...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 24</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 08:57:06</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> bdfdc08c4750</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> systemd[1]:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Started</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> MySQL</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Server.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-5-构建一个基于rpm安装的php8-0镜像" tabindex="-1"><a class="header-anchor" href="#_3-5-构建一个基于rpm安装的php8-0镜像"><span>3.5.构建一个基于rpm安装的php8.0镜像</span></a></h3><h5 id="_3-5-1-创建目录及所需文件" tabindex="-1"><a class="header-anchor" href="#_3-5-1-创建目录及所需文件"><span>3.5.1.创建目录及所需文件</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]# mkdir php</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h5 id="_3-5-2-编写dockerfile文件" tabindex="-1"><a class="header-anchor" href="#_3-5-2-编写dockerfile文件"><span>3.5.2.编写Dockerfile文件</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost php]# vim Dockerfie</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> centos:centos7.9.2009</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">MAINTAINER</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> zxw</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">zxw@xxjsjl.c</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">n</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">VOLUME</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;php80_1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;php80_2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> wget</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://mirrors.tuna.tsinghua.edu.cn/remi/enterprise/remi-release-7.rpm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum-utils</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php80-php-cli</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php80-php-common</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php80-php-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php80-php-embedded</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php80-php-fpm</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php80-php-gd</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php80-php-mbstring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php80-php-mysqlnd</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php80-php-pdo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php80-php-opcache</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php80-php-xml</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php80-php-soap</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -sf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /opt/remi/php80/root/usr/bin/php</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">*</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/bin</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/lib/systemd/system/php80-php-fpm.service</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/systemd/system/multi-user.target.wants/php80-php-fpm.service</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">EXPOSE</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 9000</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/usr/sbin/init&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-5-3-构建镜像" tabindex="-1"><a class="header-anchor" href="#_3-5-3-构建镜像"><span>3.5.3.构建镜像</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost php]# docker build -t php80:1.0 </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[+] Building 0.3s (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">9/9</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) FINISHED                                                                                                                                                                     docker:default</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load build definition from Dockerfile                                                                                                                                                           0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dockerfile:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 759B</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                                                           0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load .dockerignore                                                                                                                                                                              0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> context:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 2B</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                                                                0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> docker.io/library/centos:centos7.9.2009                                                                                                                                       0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [1/5] FROM docker.io/library/centos:centos7.9.2009                                                                                                                                                         0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">CACHED</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [2/5] RUN yum install -y wget &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> https://mirrors.tuna.tsinghua.edu.cn/remi/enterprise/remi-release-7.rpm</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum-utils</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                 0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">CACHED</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [3/5] RUN yum -y install php80-php-cli php80-php-common php80-php-devel php80-php-embedded php80-php-fpm php80-php-gd php80-php-mbstring php80-php-mysqlnd php80-php-pdo php80-php-opcache php80-p  0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">CACHED</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [4/5] RUN ln -sf /opt/remi/php80/root/usr/bin/php</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">*</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> /usr/local/bin                                                                                                                                   0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [5/5] RUN ln -s /usr/lib/systemd/system/php80-php-fpm.service /etc/systemd/system/multi-user.target.wants/php80-php-fpm.service                                                                            0.3s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">exporting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                                                                         0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> exporting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> layers</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                                                                        0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> writing</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sha256:df46ab6f91c2b8774e76a01686e111633fba615f10fc7c9900ab1b969e1a5d16</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                   0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> naming</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> docker.io/library/php80:1.0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                                                   0.0s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-5-4-创建一个容器" tabindex="-1"><a class="header-anchor" href="#_3-5-4-创建一个容器"><span>3.5.4.创建一个容器</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost php]# docker run -itd --name php8 </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">--privileged</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">true</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> php80:1.0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/sbin/init</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">6851d8f92ef490c94eb23a44c1a69e2ae4a665ffadd638daa631745c167d659c</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost php]# docker ps</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CONTAINER</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ID</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   IMAGE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">       COMMAND</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            CREATED</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         PORTS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      NAMES</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">6851d8f92ef4</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   php80:1.0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &quot;/usr/sbin/init&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> seconds</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ago</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   Up</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> seconds</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   9000/tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   php8</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost php]# docker exec -it php8 systemctl status php80-php-fpm</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">●</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php80-php-fpm.service</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> The</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> PHP</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> FastCGI</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Process</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Manager</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   Loaded:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> loaded</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (/usr/lib/systemd/system/php80-php-fpm.service; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">vendor</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> preset:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> disabled</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   Active:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> active</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (running) since Thu 2023-08-24 07:45:29 UTC; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">25s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ago</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Main</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> PID:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 54</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (php-fpm)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   Status:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;Processes active: 0, idle: 5, Requests: 0, slow: 0, Traffic: 0req/sec&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">   CGroup:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /docker/6851d8f92ef490c94eb23a44c1a69e2ae4a665ffadd638daa631745c167d659c/system.slice/php80-php-fpm.service</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">           ├─54</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php-fpm:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> master</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (/etc/opt/remi/php80/php-fpm.conf)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">           ├─60</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php-fpm:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pool</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> www</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">           ├─61</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php-fpm:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pool</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> www</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">           ├─62</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php-fpm:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pool</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> www</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">           ├─63</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php-fpm:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pool</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> www</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">           └─64</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php-fpm:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pool</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> www</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">           ‣</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 54</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php-fpm:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> master</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (/etc/opt/remi/php80/php-fpm.conf)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 24</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 07:45:29</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 6851d8f92ef4</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> systemd[1]:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Starting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> The</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> PHP</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> FastCGI</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Process</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Manager...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Aug</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 24</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 07:45:29</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 6851d8f92ef4</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> systemd[1]:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Started</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> The</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> PHP</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> FastCGI</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Process</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Manager.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-6-构建一个基于rpm安装的nginx镜像" tabindex="-1"><a class="header-anchor" href="#_3-6-构建一个基于rpm安装的nginx镜像"><span>3.6.构建一个基于rpm安装的nginx镜像</span></a></h3><h5 id="_3-6-1-创建目录及所需文件" tabindex="-1"><a class="header-anchor" href="#_3-6-1-创建目录及所需文件"><span>3.6.1.创建目录及所需文件</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]# mkdir nginx</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost nginx]# touch 111 </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> index.html</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-6-2-编写dockfile文件" tabindex="-1"><a class="header-anchor" href="#_3-6-2-编写dockfile文件"><span>3.6.2.编写Dockfile文件</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost nginx]# vim Dockerfie</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> centos:centos7.9.2009</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">MAINTAINER</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> zxw</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">zxw@xxjsjl.c</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">n</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">VOLUME</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;nginx_1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;nginx_2&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> wget</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/yum.repos.d/epel.repo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http://mirrors.aliyun.com/repo/epel-7.repo</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;daemon off;&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/nginx/nginx.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">EXPOSE</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 80</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 443</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/usr/sbin/nginx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-6-3-构建镜像" tabindex="-1"><a class="header-anchor" href="#_3-6-3-构建镜像"><span>3.6.3.构建镜像</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost nginx]# docker build -t mynginx </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[+] Building 26.8s (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">11/11</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) FINISHED              docker:default</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load build definition from Dockerfile           0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dockerfile:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 428B</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                           0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load .dockerignore                              0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> context:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 2B</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> docker.io/library/centos:centos7.9.2009            0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">CACHED</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [1/6] FROM docker.io/library/centos:centos7.9.2009                        0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load build context                               0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> context:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 101B</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                               0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [2/6] RUN yum install -y wget                                10.9s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [3/6] RUN wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo             0.3s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [4/6] RUN yum install -y nginx                               14.1s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [5/6] RUN echo </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;daemon off;&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> /etc/nginx/nginx.conf        0.3s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [6/6] ADD index.html /usr/share/nginx/html/index.html         0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">exporting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                            1.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> exporting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> layers</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                            1.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> writing</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sha256:41c69e2c47dba70d1dbb89a1929f117fd3b680ee17a79cb15878e48ed51b1346</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">             0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> naming</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> docker.io/library/mynginx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                          0.0s</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_3-6-4-运行一个容器测试访问" tabindex="-1"><a class="header-anchor" href="#_3-6-4-运行一个容器测试访问"><span>3.6.4.运行一个容器测试访问</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost nginx]# docker run -itd --name nginx -p 80:80 mynginx</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost nginx]# docker exec -it nginx nginx -v</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> version:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx/1.20.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+p+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="_4-基于源码包构建myslq、php、nginx、tomcat等镜像" tabindex="-1"><a class="header-anchor" href="#_4-基于源码包构建myslq、php、nginx、tomcat等镜像"><span>4.基于源码包构建myslq、php、nginx、tomcat等镜像</span></a></h3><h4 id="_4-1-基于源码包构建nginx镜像" tabindex="-1"><a class="header-anchor" href="#_4-1-基于源码包构建nginx镜像"><span>4.1.基于源码包构建nginx镜像</span></a></h4><h5 id="_4-1-1-编写dockerfile文件" tabindex="-1"><a class="header-anchor" href="#_4-1-1-编写dockerfile文件"><span>4.1.1.编写Dockerfile文件</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]# mkdir nginx</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost nginx]# vim Dockerfile</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">##基础镜像来源</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> centos:7</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">##编者信息  </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">MAINTAINER</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> zxw</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">zxw@xxjsjl.c</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">n</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">##安装wget工具和下载阿里云yum源</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> wget</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http://mirrors.aliyun.com/repo/Centos-7.repo</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/yum.repos.d/Centos-7.repo</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">##安装编译nginx所需要的依赖以及mack工具</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> gcc</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> gcc-c++</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> glibc</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> make</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> autoconf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> openssl-devel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pcre-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> libxslt-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> gd-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> GeoIP</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> GeoIP-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> GeoIP-data</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> make</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">##下载nginx源码包至指定目录并解压以及创建nginx启动用户</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> NG_VER=nginx-1.24.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WORKDIR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /user/local/src</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> wget</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http://nginx.org/download/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$NG_VER</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.tar.gz</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tar</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> xzvf</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> $NG_VER</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> useradd</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -M</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /sbin/nologin</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">##进入nginx解压后的目录进行编译(参数)和安装</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WORKDIR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /user/local/src/</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$NG_VER</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ./configure</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --user=nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --group=nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --prefix=/usr/local/nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-file-aio</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_ssl_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_realip_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_addition_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_xslt_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_image_filter_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_geoip_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_sub_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_dav_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_flv_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_mp4_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_gunzip_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_gzip_static_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_auth_request_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_random_index_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_secure_link_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_degradation_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_stub_status_module</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">##/usr/local/nginx/sbin 被添加到 PATH 中，意味着系统可以在该路径中找到并执行 nginx 命令</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ENV</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> PATH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/nginx/sbin:</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$PATH</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">##暴露端口</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">EXPOSE</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 80</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 443</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">##启动nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ENTRYPOINT</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;nginx&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">##告诉容器在启动时以前台方式运行 Nginx，并执行</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;-g&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;daemon off;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-1-2-构建镜像" tabindex="-1"><a class="header-anchor" href="#_4-1-2-构建镜像"><span>4.1.2.构建镜像</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost nginx]# docker build -t nginx1.24.0:0.1 </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[+] Building 33.9s (</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">14/14</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) FINISHED                                                                                                                         docker:default</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load build definition from Dockerfile                                                                                                                  0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> dockerfile:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 1.31kB</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load .dockerignore                                                                                                                                     0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> transferring</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> context:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 2B</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                       0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [internal] load metadata </span><span style="--shiki-light:#D73A49;--shiki-dark:#C678DD;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> docker.io/library/centos:7                                                                                                           0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [ </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">1/10]</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> docker.io/library/centos:7</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                           0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">CACHED</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [ </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">2/10]</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                            0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">CACHED</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [ </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">3/10]</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> wget</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http://mirrors.aliyun.com/repo/Centos-7.repo</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/yum.repos.d/Centos-7.repo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                            0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">CACHED</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [ </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">4/10]</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> gcc</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> gcc-c++</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> glibc</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> make</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> autoconf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> openssl-devel</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pcre-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> libxslt-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> gd-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> GeoIP</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> GeoIP-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Ge</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">CACHED</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [ </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">5/10]</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> make</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                            0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">CACHED</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [ </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">6/10]</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> WORKDIR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /user/local/src</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                            0.0s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [ </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">7/10]</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> wget</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http://nginx.org/download/nginx-1.24.0.tar.gz</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">tar</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> xzvf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx-1.24.0.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                    2.4s</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [ </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">8/10]</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> useradd</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -M</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /sbin/nologin</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                     0.4s</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [ </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">9/10]</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> WORKDIR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /user/local/src/nginx-1.24.0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                      0.0s</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; [10/10] RUN ./configure </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">--user</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">nginx</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> --group</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">nginx</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;"> --prefix</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/usr/local/nginx</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> --with-file-aio</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_ssl_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_realip_module</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --with-http_addit</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  28.6s</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">exporting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                                2.3s</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> exporting</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> layers</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                                               2.3s</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> writing</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> image</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sha256:516d3a979c77ff748964df10db5f1b850cd6b9927fa4286fdce19882040690aa</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                          0.0s</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">&gt; =</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> naming</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> docker.io/library/nginx1.24.0:0.1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                                                                                                    0.0s</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost nginx]# docker images</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">REPOSITORY</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    TAG</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">       IMAGE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ID</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">       CREATED</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         SIZE</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nginx1.24.0</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   0.1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">       516d3a979c77</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   3</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> minutes</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ago</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   1.08GB</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-1-3-启动容器测试" tabindex="-1"><a class="header-anchor" href="#_4-1-3-启动容器测试"><span>4.1.3.启动容器测试</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost nginx]# docker run -itd -p 80:80 --name nginx nginx1.24.0:0.1 </span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">f3be054228501f568ccef647d262b1d67dcb1fec75d62236d05614346a74ca8e</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost nginx]# docker ps</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CONTAINER</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ID</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   IMAGE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">             COMMAND</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                  CREATED</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          PORTS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">                                        NAMES</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">f3be05422850</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   nginx1.24.0:0.1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &quot;nginx -g &#39;daemon of…&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> seconds</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ago</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    Up</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> second</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">     0.0.0.0:80</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">80/tcp,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> :::80</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">80/tcp,</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 443/tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   nginx</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+d+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="_4-2-基于源码包构建php8-0镜像" tabindex="-1"><a class="header-anchor" href="#_4-2-基于源码包构建php8-0镜像"><span>4.2.基于源码包构建php8.0镜像</span></a></h4><blockquote><p>提前准备源码包：oniguruma-6.9.4.tar.gz、php-8.0.0.tar.gz</p></blockquote><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost php]# ls</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Centos-8.repo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  Dockerfile</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  oniguruma-6.9.4.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  php-8.0.0.tar.gz</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-2-1-编写dockerfile文件" tabindex="-1"><a class="header-anchor" href="#_4-2-1-编写dockerfile文件"><span>4.2.1.编写Dockerfile文件</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost php]#vim Dockerfile</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#this docker file</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">#VERSION 1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> centos:latest</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">MAINTAINER</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  zxw@xxjsjl.cn</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 清除yum源</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/yum.repos.d/</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Centos-8.repo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/yum.repos.d/Centos-8.repo</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> wget</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> make</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> wget</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> http://mirrors.aliyun.com/repo/epel-archive-8.repo</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/yum.repos.d/epel-archive-8.repo</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> epel-release</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">##安装编译oniguruma的依赖、配置编译安装oniguruma</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> autoconf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> automake</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> libtool</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ADD</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> oniguruma-6.9.4.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/src/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WORKDIR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/src/oniguruma-6.9.4</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ./autogen.sh</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">./configure</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --prefix=/usr</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> make</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">##安装编译安装php8.0的依赖</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> gcc</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> gcc-c++</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> libxml2-devel</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">openssl-devel </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">curl-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> libjpeg-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> libpng-devel</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">libicu-devel </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">freetype-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> openldap-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> openldap</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">openldap-devel </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">libxml2-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> openssl</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> openssl-devel</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">sqlite-devel </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">libcurl-devel.x86_64</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> libpng.x86_64</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">libpng-devel.x86_64 </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">freetype-devel</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> libicu-devel.x86_64</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">glibc-headers </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">libzip-devel</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">##安装编译php8.0以及相关模块</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ADD</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php-8.0.0.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/src</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WORKDIR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/src/php-8.0.0</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ./configure</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --prefix=/usr/local/php</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --with-config-file-path=/usr/local/php/etc</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --with-mysqli=shared,mysqlnd</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --with-pdo-mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --enable-opcache</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --enable-gd</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --with-iconv</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">   \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --with-zip</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --enable-inline-optimization</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --disable-debug</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --disable-rpath</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --enable-shared</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --enable-xml</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --enable-bcmath</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --enable-shmop</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --enable-sysvsem</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --enable-mbregex</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --enable-mbstring</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --enable-ftp</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --enable-pcntl</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --enable-sockets</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --with-xmlrpc</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --enable-soap</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --without-pear</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --with-gettext</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --enable-session</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --with-curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --with-jpeg</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --with-freetype</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --enable-fpm</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --with-fpm-user=nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --with-fpm-group=nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --without-gdbm</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --enable-fast-install</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">  \\</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">     --disable-fileinfo</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> make</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 创建php启动用户</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> groupadd</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">useradd</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /sbin/nologin</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -M</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 配置php解析器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> cp</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php.ini-production</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/php/etc/php.ini</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 配置php进程管理器文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> cp</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/php/etc/php-fpm.conf.default</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/php/etc/php-fpm.conf</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 配置PHP-FPM的一个配置文件，用于配置PHP-FPM进程池中的单个进程管理器</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> cp</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/php/etc/php-fpm.d/www.conf.default</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/php/etc/php-fpm.d/www.conf</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 将 PHP-FPM 的启动脚本拷贝到系统的启动目录，以便在系统启动时自动启动 PHP-FPM</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> cp</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sapi/fpm/init.d.php-fpm</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/rc.d/init.d/php-fpm</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 通过设置权限为 744</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> chmod</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 744</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/rc.d/init.d/php-fpm</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 命令 “/etc/init.d/php-fpm start” 用于启动 PHP-FPM 服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/init.d/php-fpm</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> start</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 将 PHP-FPM 添加到系统的服务管理器中。该命令会在系统的服务配置目录中创建一个启动配置文件，以便在系统启动时自动启动 PHP-FPM 服务。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> chkconfig</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --add</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php-fpm</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 将 PHP-FPM 服务设置为开机自启动。执行这个命令后，系统会将 PHP-FPM 服务添加到开机自启动的服务列表中，并在每次系统启动时自动启动该服务。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> chkconfig</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php-fpm</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> on</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 将指定的路径添加到系统的环境变量中</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;PATH=/usr/local/php/bin:/usr/local/php/lib:</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\$</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">PATH&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/etc/profile</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 用于将 “export PATH” 添加到系统的环境变量配置文件 “/etc/profile” 中。使用 “export PATH” 声明，确保环境变量 PATH 在当前环境中可用。添加这个声明后，系统将以指定的路径为基准来搜索可执行文件，从而使得系统可以在终端中运行你所添加的可执行文件。</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  &quot;export PATH&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/etc/profile</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/src/</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WORKDIR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/php</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">EXPOSE</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 9000</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 用于手动启动 PHP-FPM 的命令</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/php/sbin/php-fpm</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/usr/sbin/init&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="_4-2-2-构建镜像" tabindex="-1"><a class="header-anchor" href="#_4-2-2-构建镜像"><span>4.2.2.构建镜像</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost php]# docker build -t php80:1.0 </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><figure><img src="`+r+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h5 id="_4-2-3-启动容器测试服务运行情况" tabindex="-1"><a class="header-anchor" href="#_4-2-3-启动容器测试服务运行情况"><span>4.2.3.启动容器测试服务运行情况</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost php]# docker run -itd --name php2 </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">--privileged</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">true</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> php80:1.0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/sbin/init</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">789a5c964eb172e2840e3bcb11afbb9c5da10f60c34b12a4d7572ea5b8e9979e</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost php]# docker ps</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CONTAINER</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ID</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   IMAGE</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">           COMMAND</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">            CREATED</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          STATUS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">         PORTS</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">      NAMES</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">789a5c964eb1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   php80:1.0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">       &quot;/usr/sbin/init&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">   2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> seconds</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ago</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    Up</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> second</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    9000/tcp</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   php2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">bb658bf094a3</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   centos:latest</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   &quot;/bin/bash&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">        33</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> minutes</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ago</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   Up</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 3</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> minutes</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">              centos</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost php]# docker exec -it php2 ps -ef</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">UID</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          PID</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    PPID</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  C</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> STIME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> TTY</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">          TIME</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> CMD</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">           1</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">       0</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 09:55</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/sbin/init</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">          31</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">       1</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 09:55</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/lib/systemd/systemd-journald</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">          35</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">       1</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  4</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 09:55</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/lib/systemd/systemd-udevd</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">dbus</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">          59</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">       1</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 09:55</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/bin/dbus-daemon</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --system</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --address=systemd:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --nofork</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --nopidfile</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --systemd-activation</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --syslog-only</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">          63</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">       1</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 09:55</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php-fpm:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> master</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> process</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> (/usr/local/php/etc/php-fpm.conf)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">         64</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">      63</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 09:55</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php-fpm:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pool</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> www</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">         65</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">      63</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 09:55</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ?</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">        00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> php-fpm:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pool</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> www</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">root</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">         155</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">       0</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> 09:55</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> pts/1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">    00:00:00</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ps</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -ef</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_4-3-基于源码包构建mysql8-0-33镜像" tabindex="-1"><a class="header-anchor" href="#_4-3-基于源码包构建mysql8-0-33镜像"><span>4.3.基于源码包构建mysql8.0.33镜像</span></a></h4><blockquote><p>提前准备相应文件</p></blockquote><h5 id="_4-3-1-编写dockerfile文件" tabindex="-1"><a class="header-anchor" href="#_4-3-1-编写dockerfile文件"><span>4.3.1.编写dockerfile文件</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost]# mkdir mysql</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost mysql]#ls</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">boost_1_77_0.tar.bz2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   cmake-3.9.2.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">   Dockerfile</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  mysql-boost-8.0.33.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost mysql]#vim Dockerfile</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">FROM</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> centos:7</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">MAINTAINER</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">  zxw@xxjsjl.cn</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## Centos_Os_Version=CentOS Linux release 7.9.2009 (Core)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 配置yum及导入相关文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> rm</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -rf</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/yum.repos.d/</span><span style="--shiki-light:#005CC5;--shiki-dark:#E5C07B;">*</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ADD</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> cmake-3.9.2.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/src/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">ADD</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mysql-boost-8.0.33.tar.gz</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/src</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> boost_1_77_0.tar.bz2</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/src/boost/boost_1_77_0.tar.bz2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> installed_packages.txt</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /root/installed_packages.txt</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> Centos-7.repo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/yum.repos.d/Centos-7.repo</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> epel-7.repo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/yum.repos.d/epel-7.repo</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 安装依赖</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> yum</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> $(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">cat</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> installed_packages.txt</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">devtoolset-11-gcc</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> devtoolset-11-gcc-c++</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> devtoolset-11-binutils</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 编译安装cmake-3.9.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WORKDIR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/src/cmake-3.9.2</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ./configure</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> make</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> ln</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/bin/cmake</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/bin/</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 编译及安装mysql-8.0.33</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WORKDIR</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/src/mysql-8.0.33</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> cmake</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -DCMAKE_INSTALL_PREFIX=/usr/local/mysql/</span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-DMYSQL_UNIX_ADDR=/tmp/mysql.sock </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-DMYSQL_DATADIR=/usr/local/mysql/data/ </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-DDEFAULT_CHARSET=utf8 </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-DDEFAULT_COLLATION=utf8_general_ci </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-DWITH_EXTRA_CHARSETS=all </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-DWITH_MYISAM_STORAGE_ENGINE=1 </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-DWITH_INNOBASE_STORAGE_ENGINE=1 </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-DWITH_MEMORY_STORAGE_ENGINE=1 </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-DWITH_READLINE=1 </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-DWITH_INNODB_MEMCACHED=1 </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-DWITH_DEBUG=OFF </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\0</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">-DWITH_ZLIB</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">bundled</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> \\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-DENABLED_LOCAL_INFILE=1 </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-DENABLED_PROFILING=ON </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-DMYSQL_MAINTAINER_MODE=OFF </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-DMYSQL_TCP_PORT=3306 </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-DFORCE_INSOURCE_BUILD=1 </span><span style="--shiki-light:#005CC5;--shiki-dark:#56B6C2;">\\</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">-WITH_BOOST=/usr/local/src/boost/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> make</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 4</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> install</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 配置mysql启动用户及设置权限</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> groupadd</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mysql</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">useradd</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -g</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /sbin/nologin</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -M</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mysql</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mkdir</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/mysql/data/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> chown</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mysql.mysql</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/mysql</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> chown</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> -R</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mysql.mysql</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/mysql/data</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 配置my.cnf文件</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;[mysqld]&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/etc/my.cnf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;bind-address=0.0.0.0&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/etc/my.cnf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;port=3306&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/etc/my.cnf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;basedir=/usr/local/mysql&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/etc/my.cnf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;datadir=/usr/local/mysql/data&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/etc/my.cnf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;default-authentication-plugin=mysql_native_password&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/etc/my.cnf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;character-set-server=utf8mb4&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/etc/my.cnf</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;collation-server=utf8mb4_0900_ai_ci&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/etc/my.cnf</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## # 初始化数据库</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /usr/local/mysql/bin/mysqld</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;">  --initialize</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --user=mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --basedir=/usr/local/mysql</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> --datadir=/usr/local/mysql/data</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 复制启动文件及设置开机启动</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> cp</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> support-files/mysql.server</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/rc.d/init.d/mysqld</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> chkconfig</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mysqld</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> on</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 添加环境变量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;PATH=/usr/local/mysql/bin:/usr/local/mysql/lib:</span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">$PATH</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/etc/profile</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> echo</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> &quot;export PATH&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;"> &gt;&gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">/etc/profile</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> source</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /etc/profile</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#7F848E;--shiki-light-font-style:inherit;--shiki-dark-font-style:italic;">## 添加环境变量</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">RUN</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> service</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> mysqld</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">CMD</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">&quot;/usr/sbin/init&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]::</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6、发布镜像dockerhub或阿里云" tabindex="-1"><a class="header-anchor" href="#_6、发布镜像dockerhub或阿里云"><span>6、发布镜像DockerHub或阿里云</span></a></h2><h3 id="_6-1-把镜像发布到dockerhub" tabindex="-1"><a class="header-anchor" href="#_6-1-把镜像发布到dockerhub"><span>6.1.把镜像发布到DockerHub</span></a></h3><h4 id="_6-1-1-dockerhub地址-注册一个账号" tabindex="-1"><a class="header-anchor" href="#_6-1-1-dockerhub地址-注册一个账号"><span>6.1.1.DockerHub地址，注册一个账号</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">https://hub.docker.com/</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="_6-2-2-登录自己的dockerhub" tabindex="-1"><a class="header-anchor" href="#_6-2-2-登录自己的dockerhub"><span>6.2.2.登录自己的DockerHub</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]# docker login -u  [账号]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Password:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">https://docs.docker.com/engine/reference/commandline/login#credentials-store</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Login</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Succeeded</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-2-3-提交自己的镜像" tabindex="-1"><a class="header-anchor" href="#_6-2-3-提交自己的镜像"><span>6.2.3.提交自己的镜像</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]# docker push [作者名字]/[镜像名称]:[版本号]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>#push镜像有问题？增加tag标签。</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]# docker tag [作者名字]/[镜像名称]:[版本号]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="_6-2-把镜像发布到阿里云镜像服务" tabindex="-1"><a class="header-anchor" href="#_6-2-把镜像发布到阿里云镜像服务"><span>6.2.把镜像发布到阿里云镜像服务</span></a></h3><h4 id="_6-2-1-登录到阿里云" tabindex="-1"><a class="header-anchor" href="#_6-2-1-登录到阿里云"><span>6.2.1.登录到阿里云</span></a></h4><h4 id="_6-2-2-找到容器镜像服务并设置" tabindex="-1"><a class="header-anchor" href="#_6-2-2-找到容器镜像服务并设置"><span>6.2.2.找到容器镜像服务并设置</span></a></h4><p>（1）创建命名空间</p><figure><img src="`+g+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>（2）创建镜像仓库 <img src="'+y+'" alt="" loading="lazy"></p><p>(3)相关页面信息</p><p>#基础信息</p><figure><img src="'+F+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>#发布操作</p><figure><img src="'+c+`" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="_6-2-3-将本地镜像发布至阿里云仓库" tabindex="-1"><a class="header-anchor" href="#_6-2-3-将本地镜像发布至阿里云仓库"><span>6.2.3.将本地镜像发布至阿里云仓库</span></a></h4><p>（1）登录到阿里云仓库</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]# docker login </span><span style="--shiki-light:#24292E;--shiki-dark:#E06C75;">--username</span><span style="--shiki-light:#D73A49;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;">起风了4606</span><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;"> registry.cn-hangzhou.aliyuncs.com</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Password:</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">WARNING!</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Your</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> password</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> will</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> be</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> stored</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> unencrypted</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> in</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> /root/.docker/config.json.</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Configure</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> a</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> credential</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> helper</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> remove</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> this</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> warning.</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> See</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">Login</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Succeeded</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]#</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>（2）生成镜像tag并push</p><p>#生成tag</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]# docker tag 209d8c830416 registry.cn-hangzhou.aliyuncs.com/local_zxw_0616/mytomcat:0.1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>#push镜像</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#24292e;--shiki-dark:#abb2bf;--shiki-light-bg:#fff;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes github-light one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">[root@localhost </span><span style="--shiki-light:#D73A49;--shiki-dark:#ABB2BF;">~</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;">]# docker push registry.cn-hangzhou.aliyuncs.com/local_zxw_0616/mytomcat:0.1</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">The</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> push</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> refers</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> repository</span><span style="--shiki-light:#24292E;--shiki-dark:#ABB2BF;"> [registry.cn-hangzhou.aliyuncs.com/local_zxw_0616/mytomcat]</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">5f70bf18a086:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Pushed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">66d32dae2002:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Pushed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">09aa69d518ed:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Pushed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">3eb0769d6105:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Pushed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">3e459d597ee0:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Pushed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">93157c47d58e:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Pushed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">74ddd0ec08fa:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> Pushed</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#61AFEF;">0.1:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> digest:</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> sha256:3af1281eccdab7e1ff8039712cb97465e9b55cb5dd0b6de1eec943c65a9bc4f1</span><span style="--shiki-light:#032F62;--shiki-dark:#98C379;"> size:</span><span style="--shiki-light:#005CC5;--shiki-dark:#D19A66;"> 1787</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><figure><img src="`+C+'" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>',137),A=[v];function B(m,u){return a(),i("div",null,A)}const D=s(o,[["render",B],["__file","05.html.vue"]]),f=JSON.parse('{"path":"/note/docker/05.html","title":"05-Dockerfile构建镜像","lang":"zh-CN","frontmatter":{"title":"05-Dockerfile构建镜像","order":5,"icon":"lightbulb","description":"1、什么是dockerfile DockerFile 是一种被Docker程序解释的脚本，DockerFile是由一条条的命令组成的，每条命令对应linux下面的一条命令，Docker程序将这些DockerFile指令再翻译成真正的linux命令，其有自己的书写方式和支持的命令，Docker程序读取DockerFile并根据指令生成Docker镜像，相...","head":[["meta",{"property":"og:url","content":"https://vuepress-theme-hope-docs-demo.netlify.app/note/docker/05.html"}],["meta",{"property":"og:site_name","content":"风华"}],["meta",{"property":"og:title","content":"05-Dockerfile构建镜像"}],["meta",{"property":"og:description","content":"1、什么是dockerfile DockerFile 是一种被Docker程序解释的脚本，DockerFile是由一条条的命令组成的，每条命令对应linux下面的一条命令，Docker程序将这些DockerFile指令再翻译成真正的linux命令，其有自己的书写方式和支持的命令，Docker程序读取DockerFile并根据指令生成Docker镜像，相..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"article:author","content":"风华"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"05-Dockerfile构建镜像\\",\\"image\\":[\\"\\"],\\"dateModified\\":null,\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"风华\\",\\"url\\":\\"/portfolio\\"}]}"]]},"headers":[{"level":2,"title":"1、什么是dockerfile","slug":"_1、什么是dockerfile","link":"#_1、什么是dockerfile","children":[]},{"level":2,"title":"2、dockerfile指令解读","slug":"_2、dockerfile指令解读","link":"#_2、dockerfile指令解读","children":[]},{"level":2,"title":"3.使用DockerFile构建自己的镜像","slug":"_3-使用dockerfile构建自己的镜像","link":"#_3-使用dockerfile构建自己的镜像","children":[{"level":3,"title":"3.1.创建一个自己的centos镜像","slug":"_3-1-创建一个自己的centos镜像","link":"#_3-1-创建一个自己的centos镜像","children":[]},{"level":3,"title":"3.2.CMD和ENTRYPOINT区别","slug":"_3-2-cmd和entrypoint区别","link":"#_3-2-cmd和entrypoint区别","children":[]},{"level":3,"title":"3.3.构建一个Tomcat镜像","slug":"_3-3-构建一个tomcat镜像","link":"#_3-3-构建一个tomcat镜像","children":[]},{"level":3,"title":"3.4.构建一个基于rpm安装的mysql镜像","slug":"_3-4-构建一个基于rpm安装的mysql镜像","link":"#_3-4-构建一个基于rpm安装的mysql镜像","children":[]},{"level":3,"title":"3.5.构建一个基于rpm安装的php8.0镜像","slug":"_3-5-构建一个基于rpm安装的php8-0镜像","link":"#_3-5-构建一个基于rpm安装的php8-0镜像","children":[]},{"level":3,"title":"3.6.构建一个基于rpm安装的nginx镜像","slug":"_3-6-构建一个基于rpm安装的nginx镜像","link":"#_3-6-构建一个基于rpm安装的nginx镜像","children":[]},{"level":3,"title":"4.基于源码包构建myslq、php、nginx、tomcat等镜像","slug":"_4-基于源码包构建myslq、php、nginx、tomcat等镜像","link":"#_4-基于源码包构建myslq、php、nginx、tomcat等镜像","children":[]}]},{"level":2,"title":"6、发布镜像DockerHub或阿里云","slug":"_6、发布镜像dockerhub或阿里云","link":"#_6、发布镜像dockerhub或阿里云","children":[{"level":3,"title":"6.1.把镜像发布到DockerHub","slug":"_6-1-把镜像发布到dockerhub","link":"#_6-1-把镜像发布到dockerhub","children":[]},{"level":3,"title":"6.2.把镜像发布到阿里云镜像服务","slug":"_6-2-把镜像发布到阿里云镜像服务","link":"#_6-2-把镜像发布到阿里云镜像服务","children":[]}]}],"git":{},"readingTime":{"minutes":22.31,"words":6694},"filePathRelative":"note/docker/05.md","autoDesc":true}');export{D as comp,f as data};
